<!doctype html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Padel Parc ‚Äì Montante Descendante</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Typo sportive & moderne -->
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root {
      --blue-strong: #004b9b;         /* (0,75,155) */
      --blue-dark:   #12325d;
      --blue-mid:    #4d81b9;
      --blue-soft:   #99b7d7;
      --blue-bg:     #e6edf5;
      --accent:      #e5e339;
      --accent-soft: rgba(229, 227, 57, 0.25);
      --text-light:  #f9fafb;
      --text-muted:  #b0c4dd;
      --surface-dark: #021226;
      --surface-card: #072646;
      --surface-soft: #0d3764;
      --danger: #f97373;
      --success: #22c55e;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Montserrat", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      background:
        radial-gradient(circle at 0 0, rgba(229, 227, 57, 0.30), transparent 60%),
        radial-gradient(circle at 100% 100%, rgba(77, 129, 185, 0.45), transparent 55%),
        radial-gradient(circle at 30% 20%, rgba(0, 75, 155, 0.8), transparent 65%),
        linear-gradient(135deg, #02142c, var(--blue-strong), #02142c);
      color: var(--text-light);
      padding: 14px;
    }

    .app {
      max-width: 1280px;
      margin: 0 auto;
      border-radius: 20px;
      padding: 16px 16px 18px;
      background:
        radial-gradient(circle at 0 0, rgba(0, 75, 155, 0.4), transparent 60%),
        linear-gradient(145deg, rgba(9, 32, 68, 0.98), rgba(2, 17, 40, 0.98));
      box-shadow:
        0 0 0 1px rgba(0, 75, 155, 0.35),
        0 24px 70px rgba(0, 0, 0, 0.85);
      position: relative;
      overflow: hidden;
    }

    .app::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 0% 0%, rgba(229, 227, 57, 0.45), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(0, 75, 155, 0.55), transparent 60%);
      opacity: 0.9;
      pointer-events: none;
      mix-blend-mode: screen;
    }

    .app-inner {
      position: relative;
      z-index: 1;
    }

    .hidden { display: none !important; }

    /* GLOBAL HEADER - ACCUEIL */

    .global-header {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 12px;
      text-align: center;
    }

    .global-title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .global-title {
      font-family: "Rajdhani";
      font-size: 1.5rem;
      letter-spacing: 0.24em;
      text-transform: uppercase;
    }

    .global-sub {
      font-size: 0.78rem;
      color: var(--blue-soft);
      letter-spacing: 0.16em;
      text-transform: uppercase;
    }

    /* HEADER TOURNOI (ADMIN) */

    header {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(153, 183, 215, 0.6);
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 0;
    }

    .brand-logo-frame {
      width: 90px;
      height: 60px;
      border-radius: 18px;
      padding: 5px;
      background:
        radial-gradient(circle at 0 0, rgba(230, 237, 245, 0.9), rgba(0, 75, 155, 0.95));
      box-shadow:
        0 0 18px rgba(0, 75, 155, 0.7),
        0 0 25px rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .brand-logo-frame img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 14px;
      background: #020617;
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .brand-title {
      font-family: "Rajdhani", system-ui;
      font-weight: 700;
      font-size: 1.1rem;
      letter-spacing: 0.22em;
      text-transform: uppercase;
    }

    .brand-sub {
      font-size: 0.75rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--blue-soft);
    }

    .header-center {
      flex: 1;
      min-width: 180px;
      text-align: center;
    }

    .tournament-name {
      font-family: "Rajdhani", system-ui;
      font-size: clamp(1.4rem, 2.4vw, 2rem);
      font-weight: 700;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--accent);
      text-shadow: 0 0 18px rgba(229, 227, 57, 0.9);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tournament-meta {
      margin-top: 2px;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .header-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
      min-width: 0;
    }

    .roulement-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background:
        radial-gradient(circle at 0% 50%, rgba(229, 227, 57, 0.5), rgba(4, 20, 39, 0.95));
      border: 1px solid rgba(229, 227, 57, 0.95);
      font-size: 0.78rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #111827;
    }

    .roulement-chip span.number {
      font-family: "Rajdhani";
      font-size: 1.1rem;
    }

    .btn-icon {
      border-radius: 999px;
      border: 1px solid rgba(153, 183, 215, 0.7);
      background:
        radial-gradient(circle at 0 0, rgba(230, 237, 245, 0.22), rgba(10, 42, 82, 0.98));
      color: var(--text-light);
      padding: 6px 10px;
      font-size: 0.75rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease, border-color 0.1s ease, background 0.15s ease;
    }

    .btn-icon:hover {
      transform: translateY(-1px);
      box-shadow: 0 0 18px rgba(229, 227, 57, 0.8);
      border-color: var(--accent);
    }

    .btn-icon.secondary {
      border-color: rgba(148, 163, 184, 0.9);
      background:
        radial-gradient(circle at 0 0, rgba(15, 23, 42, 0.96), rgba(7, 33, 70, 0.98));
      font-size: 0.74rem;
    }

    .btn-icon svg {
      width: 14px;
      height: 14px;
    }

    /* LAYOUT TOURNOI */

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.4fr);
      gap: 12px;
      margin-top: 4px;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
      .header-right {
        align-items: flex-start;
      }
    }

    /* CARTES */

    .card {
      position: relative;
      background:
        radial-gradient(circle at 0 0, rgba(77, 129, 185, 0.4), transparent 55%),
        radial-gradient(circle at 0 100%, var(--accent-soft), transparent 60%),
        radial-gradient(circle at 100% 100%, rgba(0, 75, 155, 0.45), transparent 60%),
        linear-gradient(145deg, var(--surface-card), var(--surface-soft));
      border-radius: 16px;
      padding: 12px;
      border: 1px solid rgba(153, 183, 215, 0.7);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.75);
      overflow: hidden;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 8px;
    }

    .card-title {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .card-title h2 {
      font-family: "Rajdhani";
      font-size: 1rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
    }

    .card-title span {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .pill {
      font-size: 0.7rem;
      padding: 3px 8px;
      border-radius: 999px;
      background:
        radial-gradient(circle at 0 0, rgba(229, 227, 57, 0.32), rgba(15, 23, 42, 0.96));
      border: 1px solid rgba(229, 227, 57, 0.9);
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    /* CONFIG BAR TOURNOI */

    .config-bar {
      display: grid;
      grid-template-columns: minmax(0, 2.2fr) repeat(2, minmax(0, 1.1fr));
      gap: 6px;
      margin-bottom: 8px;
      align-items: center;
    }

    @media (max-width: 720px) {
      .config-bar {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .field-group {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--blue-soft);
    }

    input[type="text"],
    select {
      background: rgba(6, 26, 55, 0.94);
      border-radius: 999px;
      border: 1px solid rgba(153, 183, 215, 0.95);
      color: var(--text-light);
      font-size: 0.8rem;
      padding: 6px 10px;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    input[type="text"]::placeholder {
      color: rgba(230, 237, 245, 0.5);
    }

    input[type="text"]:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 14px rgba(229, 227, 57, 0.85);
      background: rgba(2, 6, 23, 0.98);
    }

    input[readonly] {
      opacity: 0.85;
      cursor: default;
    }

    .btn-primary {
      border-radius: 999px;
      border: none;
      padding: 7px 14px;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      background:
        radial-gradient(circle at 0 0, #fffce3, #e5e339);
      color: #111827;
      cursor: pointer;
      box-shadow:
        0 0 16px rgba(229, 227, 57, 0.95),
        0 12px 25px rgba(0, 0, 0, 0.8);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .btn-primary:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
    }

    .btn-primary:active {
      transform: translateY(0);
      box-shadow:
        0 0 8px rgba(229, 227, 57, 0.7),
        0 6px 16px rgba(0, 0, 0, 0.75);
    }

    /* MATCHES GRID (admin) */

    .matches-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-top: 6px;
    }

    @media (max-width: 900px) {
      .matches-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .court-card {
      position: relative;
      border-radius: 14px;
      padding: 8px 9px;
      background:
        radial-gradient(circle at 0 0, rgba(230, 237, 245, 0.18), transparent 55%),
        radial-gradient(circle at 100% 100%, var(--accent-soft), transparent 60%),
        linear-gradient(135deg, rgba(7, 34, 68, 0.98), rgba(5, 31, 62, 0.98));
      border: 1px solid rgba(153, 183, 215, 0.9);
      box-shadow: inset 0 0 0 1px rgba(4, 20, 39, 0.9);
    }

    .court-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .court-name {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .court-name span.label {
      font-size: 0.65rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--blue-soft);
    }

    .court-name span.value {
      font-family: "Rajdhani";
      font-size: 1.2rem;
      font-weight: 700;
    }

    .court-tier {
      font-size: 0.7rem;
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(229, 227, 57, 0.85);
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .match-body { margin-top: 4px; }

    .team-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 4px;
      padding: 4px 6px;
      border-radius: 9px;
      background: rgba(15, 23, 42, 0.92);
      border: 1px solid rgba(51, 65, 85, 0.95);
      margin-bottom: 2px;
    }

    .team-row.winner {
      background:
        radial-gradient(circle at 0 0, rgba(34, 197, 94, 0.3), rgba(15, 23, 42, 1));
      border-color: rgba(34, 197, 94, 0.95);
      box-shadow: 0 0 18px rgba(34, 197, 94, 0.85);
    }

    .team-label {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--blue-mid), var(--blue-strong));
      font-size: 0.7rem;
      font-weight: 700;
    }

    .team-name {
      font-size: 0.8rem;
      font-weight: 600;
      flex: 1;
      margin-left: 4px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      color: var(--text-light);
    }

    .btn-win {
      border-radius: 999px;
      border: none;
      padding: 3px 7px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      cursor: pointer;
      background:
        radial-gradient(circle at 0 0, rgba(34, 197, 94, 0.3), rgba(15, 23, 42, 0.98));
      color: #bbf7d0;
      border: 1px solid rgba(34, 197, 94, 0.9);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .btn-win.inactive {
      background: rgba(15, 23, 42, 0.9);
      border-color: rgba(148, 163, 184, 0.9);
      color: var(--blue-soft);
    }

    .match-footer {
      margin-top: 4px;
      font-size: 0.7rem;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 4px;
    }

    .tag-small {
      font-size: 0.67rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: rgba(148, 163, 184, 0.9);
    }

    /* NAV ROULEMENT */

    .roulement-nav {
      margin-top: 8px;
      margin-bottom: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .btn-arrow {
      border-radius: 999px;
      border: 1px solid rgba(153, 183, 215, 0.9);
      background:
        radial-gradient(circle at 0 0, rgba(230, 237, 245, 0.25), rgba(7, 33, 70, 0.98));
      color: var(--text-light);
      width: 40px;
      height: 40px;
      font-size: 1.3rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 0 16px rgba(0, 75, 155, 0.9);
    }

    .btn-arrow:disabled {
      opacity: 0.4;
      cursor: default;
      box-shadow: none;
    }

    .roulement-nav-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--blue-soft);
    }

    /* REPOS + L√âGENDE (admin) */

    .rest-card {
      margin-top: 4px;
      border-radius: 12px;
      padding: 8px 10px;
      background:
        radial-gradient(circle at 0 0, var(--accent-soft), transparent 55%),
        rgba(8, 33, 66, 0.97);
      border: 1px solid rgba(153, 183, 215, 0.8);
    }

    .rest-title {
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--blue-soft);
      margin-bottom: 4px;
    }

    .rest-list {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      min-height: 20px;
    }

    .rest-pill {
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.98);
      border: 1px solid rgba(148, 163, 184, 0.95);
      font-size: 0.7rem;
    }

    .legend {
      margin-top: 6px;
      font-size: 0.7rem;
      color: var(--text-muted);
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
    }

    .legend-dot.win {
      background: linear-gradient(135deg, #4ade80, #22c55e);
      box-shadow: 0 0 8px rgba(34, 197, 94, 0.9);
    }

    .legend-dot.rest {
      background: linear-gradient(135deg, #1f2937, #020617);
      border: 1px solid rgba(148, 163, 184, 0.9);
    }

    /* RANKING (admin) */

    .ranking-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 4px;
      max-height: 320px;
      overflow-y: auto;
      padding-right: 2px;
    }

    .ranking-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      padding: 6px 8px;
      border-radius: 10px;
      background: rgba(7, 34, 68, 0.98);
      border: 1px solid rgba(51, 65, 85, 0.98);
    }

    .ranking-main {
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 0;
    }

    .ranking-medal {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      font-weight: 700;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.9);
    }

    .ranking-medal.gold {
      background: radial-gradient(circle at 30% 0, #fff3b0, #fbbf24);
      color: #111827;
    }

    .ranking-medal.silver {
      background: radial-gradient(circle at 30% 0, #e5e7eb, #9ca3af);
      color: #111827;
    }

    .ranking-medal.bronze {
      background: radial-gradient(circle at 30% 0, #fed7aa, #ea580c);
      color: #111827;
    }

    .ranking-medal.default {
      background: radial-gradient(circle at 30% 0, #1f2937, #020617);
      color: var(--blue-soft);
    }

    .ranking-name {
      font-size: 0.85rem;
      font-weight: 600;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }

    .ranking-sub {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .ranking-meta {
      text-align: right;
      font-size: 0.75rem;
      color: var(--blue-soft);
    }

    .ranking-meta strong {
      font-size: 0.8rem;
      color: var(--accent);
    }

    /* EMPTY */

    .empty {
      text-align: center;
      padding: 12px 4px;
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .sep-dot::before {
      content: "‚Ä¢";
      margin: 0 4px;
      opacity: 0.7;
    }

    /* HOME SCREEN */

    .home-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1.2fr);
      gap: 14px;
    }

    @media (max-width: 900px) {
      .home-layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .home-hero-title {
      font-family: "Rajdhani";
      font-size: clamp(1.8rem, 3vw, 2.2rem);
      letter-spacing: 0.2em;
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .home-hero-sub {
      font-size: 0.9rem;
      color: var(--blue-soft);
      margin-bottom: 10px;
    }

    .home-tagline {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .history-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 6px;
      max-height: 260px;
      overflow-y: auto;
      padding-right: 2px;
    }

    .history-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      padding: 6px 8px;
      border-radius: 10px;
      background: rgba(7, 34, 68, 0.98);
      border: 1px solid rgba(51, 65, 85, 0.95);
    }

    .history-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
    }

    .history-name {
      font-size: 0.85rem;
      font-weight: 600;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    .history-meta {
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    .badge-status {
      font-size: 0.7rem;
      padding: 2px 7px;
      border-radius: 999px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
    }

    .badge-en-cours {
      background: rgba(34, 197, 94, 0.15);
      border: 1px solid rgba(34, 197, 94, 0.85);
      color: #bbf7d0;
    }

    .badge-termine {
      background: rgba(59, 130, 246, 0.2);
      border: 1px solid rgba(96, 165, 250, 0.95);
      color: #dbeafe;
    }

    .history-actions {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .btn-small {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      padding: 3px 8px;
      font-size: 0.7rem;
      background: rgba(15, 23, 42, 0.96);
      color: var(--blue-soft);
      cursor: pointer;
    }

    .btn-small.danger {
      border-color: rgba(248, 113, 113, 0.9);
      color: #fecaca;
    }

    .btn-small:hover {
      filter: brightness(1.1);
    }

    /* --- VUE TV --- */

    #tv-screen { margin-top: 4px; }

    .tv-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .tv-header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .tv-logo-frame {
      width: 90px;
      height: 60px;
      border-radius: 18px;
      padding: 5px;
      background:
        radial-gradient(circle at 0 0, rgba(230, 237, 245, 0.9), rgba(0, 75, 155, 0.95));
      box-shadow:
        0 0 18px rgba(0, 75, 155, 0.7),
        0 0 25px rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .tv-logo-frame img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 14px;
      background: #020617;
    }

    .tv-header-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .tv-topline {
      font-size: 0.8rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--blue-soft);
    }

    .tv-title {
      font-family: "Rajdhani";
      font-size: clamp(1.8rem, 3vw, 2.4rem);
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--accent);
      text-shadow: 0 0 22px rgba(229, 227, 57, 1);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tv-header-right {
      display: flex;
      align-items: center;
      justify-content: flex-end;
    }

    .tv-meta-chip {
      padding: 6px 10px;
      border-radius: 999px;
      background:
        radial-gradient(circle at 0 0, rgba(229, 227, 57, 0.35), transparent 60%),
        linear-gradient(135deg, rgba(15, 23, 42, 0.96), rgba(8, 32, 66, 0.96));
      border: 1px solid rgba(229, 227, 57, 0.9);
      font-size: 0.8rem;
      color: var(--blue-bg);
    }

    .tv-subline { display: none; } /* on masque les anciens sous-titres TV */

    .tv-layout {
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.3fr);
      gap: 12px;
      margin-top: 8px;
    }

    @media (max-width: 900px) {
      .tv-layout {
        grid-template-columns: minmax(0, 1fr);
      }
      .tv-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      .tv-header-right {
        align-self: stretch;
        justify-content: flex-start;
      }
    }

    .tv-card {
      position: relative;
      border-radius: 16px;
      padding: 12px;
      background:
        radial-gradient(circle at 0 0, rgba(148, 163, 184, 0.35), transparent 55%),
        radial-gradient(circle at 100% 100%, var(--accent-soft), transparent 60%),
        linear-gradient(145deg, rgba(6, 22, 44, 0.98), rgba(8, 32, 66, 0.98));
      border: 1px solid rgba(148, 163, 184, 0.9);
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.9);
    }

    .tv-card-title {
      font-family: "Rajdhani";
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      margin-bottom: 6px;
      color: var(--accent);
    }

    .tv-card-sub { display:none; } /* suppression des sous-titres TV */

    .tv-matches-label-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .tv-matches-label {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--blue-bg);
    }

    .tv-matches-roulement {
      font-size: 0.8rem;
      color: var(--accent);
    }

    .tv-matches-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }

    @media (max-width: 900px) {
      .tv-matches-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    /* Cartes TV */

    .tv-court {
      border-radius: 14px;
      padding: 10px 10px 8px;
      border-width: 2px;
      border-style: solid;
      box-shadow:
        0 0 0 1px rgba(15, 23, 42, 0.9),
        0 8px 26px rgba(0, 0, 0, 0.8);
    }

    .tv-court-now {
      background:
        radial-gradient(circle at 0 0, rgba(59, 130, 246, 0.45), transparent 60%),
        linear-gradient(145deg, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.98));
      border-color: rgba(59, 130, 246, 1);
      color: var(--text-light);
    }

    /* NOUVEAU D√âGRAD√â 2/3 BLEU ‚Üí 1/3 JAUNE */
    .tv-court-next {
      background:
        radial-gradient(circle at 0 0, rgba(229, 227, 57, 0.45), transparent 60%),
        radial-gradient(circle at 100% 100%, rgba(0, 75, 155, 0.6), transparent 55%),
        repeating-linear-gradient(
          135deg,
          rgba(229, 227, 57, 0.16) 0,
          rgba(229, 227, 57, 0.16) 2px,
          transparent 2px,
          transparent 5px
        ),
        linear-gradient(to right, #004b9b 0%, #004b9b 66%, #e5e339 100%);
      border-color: #eab308;
      color: #0f172a;
      box-shadow:
        0 0 0 1px rgba(234, 179, 8, 0.55),
        0 10px 30px rgba(15, 23, 42, 0.8);
    }

    .tv-court-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 6px;
    }

    .tv-court-name {
      font-family: "Rajdhani";
      font-size: 1rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--blue-bg);
    }

    .tv-court-tag {
      font-size: 0.75rem;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.95);
      color: var(--blue-soft);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      background: rgba(15, 23, 42, 0.7);
    }

    .tv-teams {
      display: grid;
      grid-template-columns: minmax(0,1fr) auto minmax(0,1fr);
      gap: 6px;
      align-items: center;
      margin-bottom: 6px;
    }

    .tv-team {
      padding: 6px 8px;
      border-radius: 10px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(51, 65, 85, 0.95);
      text-align: center;
    }

    .tv-team-name {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-light);
    }

    .tv-team-vs {
      font-family: "Rajdhani";
      font-size: 0.95rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--blue-soft);
      text-align: center;
    }

    .tv-status {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-align: right;
    }

    .tv-status span.winner { color: #bbf7d0; }

    /* Sp√©cifique blocs √Ä suivre : texte lisible */

    .tv-court-next .tv-court-name,
    .tv-court-next .tv-court-tag {
      color: #0f172a;
      border-color: rgba(24, 37, 60, 0.45);
      background: rgba(255, 255, 255, 0.18);
    }

    .tv-court-next .tv-team {
      background: rgba(255, 255, 255, 0.9);
      border-color: rgba(148, 163, 184, 0.7);
    }

    .tv-court-next .tv-team-name {
      color: #0f172a;
    }

    .tv-court-next .tv-team-vs {
      color: #111827;
    }

    .tv-court-next .tv-status {
      color: #111827;
    }

    /* Repos TV */

    .tv-rest-list {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 4px;
      min-height: 22px;
    }

    .tv-rest-pill {
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(148, 163, 184, 0.95);
      font-size: 0.78rem;
    }

    /* --- CLASSEMENT TV SANS SCROLL --- */

    .tv-ranking-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 4px;
    }

    .tv-ranking-top {
      margin-bottom: 4px;
    }

    .tv-ranking-podium {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(0, 1fr));
      gap: 6px;
      align-items: flex-end;
    }

    .tv-podium-item {
      border-radius: 12px;
      padding: 6px 6px 8px;
      background: rgba(15, 23, 42, 0.98);
      border: 1px solid rgba(55, 65, 81, 0.95);
      text-align: center;
      font-size: 0.8rem;
    }

    .tv-podium-item.first {
      background:
        radial-gradient(circle at 0 0, rgba(229, 227, 57, 0.3), transparent 60%),
        linear-gradient(135deg, #fbbf24, #0f172a);
      border-color: #facc15;
      box-shadow: 0 0 18px rgba(250, 204, 21, 0.9);
      padding-top: 8px;
    }

    .tv-podium-item.second {
      background:
        radial-gradient(circle at 0 0, rgba(148, 163, 184, 0.35), transparent 60%),
        linear-gradient(135deg, #9ca3af, #020617);
      border-color: #e5e7eb;
    }

    .tv-podium-item.third {
      background:
        radial-gradient(circle at 0 0, rgba(248, 113, 113, 0.25), transparent 60%),
        linear-gradient(135deg, #ea580c, #020617);
      border-color: #fdba74;
    }

    .tv-podium-rank {
      font-size: 1.2rem;
      margin-bottom: 2px;
    }

    .tv-podium-name {
      font-size: 0.9rem;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tv-podium-points {
      font-size: 0.75rem;
      color: var(--blue-bg);
    }

    .tv-podium-record {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .tv-ranking-rest {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 4px;
      margin-top: 4px;
    }

    .tv-ranking-rest-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 4px;
      padding: 3px 6px;
      border-radius: 8px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(55, 65, 81, 0.9);
      font-size: 0.78rem;
    }

    .tv-ranking-rest-pos {
      font-size: 0.75rem;
      color: var(--blue-soft);
      min-width: 1.4em;
    }

    .tv-ranking-rest-name {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tv-ranking-rest-points {
      font-size: 0.75rem;
      color: var(--accent);
      margin-left: 4px;
    }

    .tv-back-row {
      margin-top: 10px;
      display: flex;
      justify-content: flex-end;
    }

    /* Scrollbar discret */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: rgba(15, 23, 42, 0.9); }
    ::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.7);
      border-radius: 999px;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="app-inner">

      <!-- ACCUEIL -->
      <section id="home-screen">
        <div class="global-header">
          <div class="global-title-block">
            <div class="global-title">PADEL PARC</div>
            <div class="global-sub">Tournois montante / descendante</div>
          </div>
        </div>

        <div class="home-layout">
          <!-- Cr√©ation -->
          <article class="card">
            <div class="card-header">
              <div class="card-title">
                <h2>Nouvel √©v√©nement</h2>
                <span>Cr√©e un tournoi Montante/Descendante en quelques secondes</span>
              </div>
              <span class="pill">Padel Parc</span>
            </div>

            <div style="margin-bottom:10px;">
              <div class="home-hero-title">MONTANTE DESCENDANTE</div>
              <div class="home-hero-sub">Affichage live des terrains, repos et classement.</div>
              <div class="home-tagline">
                8, 12 ou 16 √©quipes ‚Ä¢ 4 terrains ‚Ä¢ mont√©e/descente automatique √† chaque roulement.
              </div>
            </div>

            <div class="config-bar" style="margin-bottom:10px;">
              <div class="field-group">
                <label for="home-name">Nom du tournoi</label>
                <input id="home-name" type="text" placeholder="Soir√©e Padel Parc du vendredi" />
              </div>
              <div class="field-group">
                <label for="home-teams">Nombre d'√©quipes</label>
                <select id="home-teams">
                  <option value="8">8 √©quipes</option>
                  <option value="12">12 √©quipes</option>
                  <option value="16" selected>16 √©quipes</option>
                </select>
              </div>
              <div class="field-group">
                <label for="home-roulements">Roulements max</label>
                <select id="home-roulements">
                  <option value="6">6 roulements</option>
                  <option value="8">8 roulements</option>
                  <option value="10">10 roulements</option>
                  <option value="12" selected>12 roulements</option>
                  <option value="16">16 roulements</option>
                </select>
              </div>
            </div>

            <div style="display:flex; justify-content:flex-end;">
              <button class="btn-primary" id="home-start">
                üöÄ Lancer le tournoi
              </button>
            </div>
          </article>

          <!-- Historique -->
          <article class="card">
            <div class="card-header">
              <div class="card-title">
                <h2>Historique des tournois</h2>
                <span>Tournois d√©j√† lanc√©s (en cours ou termin√©s)</span>
              </div>
              <span class="pill" id="history-count">0 tournoi</span>
            </div>

            <div id="history-list" class="history-list">
              <div class="empty">
                Aucun tournoi enregistr√© pour l‚Äôinstant.<br>
                Lance ton premier √©v√©nement pour le voir appara√Ætre ici.
              </div>
            </div>
          </article>
        </div>
      </section>

      <!-- TOURNOI (ADMIN) -->
      <section id="tournament-screen" class="hidden">
        <header>
          <div class="brand">
            <div class="brand-logo-frame">
              <img src="https://lh3.googleusercontent.com/p/AF1QipNpQrOfpCxdRelQ7dF2r-elyslV__xZz5mOazHu=s1360-w1360-h1020-rw" alt="Padel Parc">
            </div>
            <div class="brand-text">
              <div class="brand-title">PADEL PARC</div>
              <div class="brand-sub">Montante descendante live</div>
            </div>
          </div>

          <div class="header-center">
            <div id="header-tournament-name" class="tournament-name">
              Nom du tournoi
            </div>
            <div class="tournament-meta">
              <span id="header-meta-teams">0 √©quipe</span>
              <span class="sep-dot"></span>
              <span id="header-meta-format">format M/D</span>
            </div>
          </div>

          <div class="header-right">
            <div class="roulement-chip">
              <span>Roulement</span>
              <span class="number" id="chip-roulement">1</span>
              <span>/ <span id="chip-roulements-max">16</span></span>
            </div>
            <div style="display:flex; gap:6px; flex-wrap:wrap; justify-content:flex-end;">
              <button class="btn-icon secondary" id="btn-back-home">
                ‚Üê Accueil
              </button>
              <button class="btn-icon secondary" id="btn-tv-view">
                üé• Vue TV
              </button>
              <button class="btn-icon" id="btn-fullscreen">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M7 3H3v4M17 3h4v4M7 21H3v-4M17 21h4v-4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
                </svg>
                <span>plein √©cran</span>
              </button>
            </div>
          </div>
        </header>

        <div class="layout">
          <!-- MATCHS -->
          <section class="card">
            <div class="card-header">
              <div class="card-title">
                <h2>Matchs & terrains</h2>
                <span id="roulement-info">Initialise le tournoi pour g√©n√©rer les rencontres.</span>
              </div>
              <span class="pill" id="pill-format">Format non d√©fini</span>
            </div>

            <div class="config-bar">
              <div class="field-group">
                <label for="input-tourney-name">Nom du tournoi</label>
                <input id="input-tourney-name" type="text" readonly />
              </div>
              <div class="field-group">
                <label for="select-team-count">Nombre d'√©quipes</label>
                <select id="select-team-count" disabled>
                  <option value="8">8 √©quipes</option>
                  <option value="12">12 √©quipes</option>
                  <option value="16">16 √©quipes</option>
                </select>
              </div>
              <div class="field-group">
                <label for="select-roulements">Roulements max</label>
                <select id="select-roulements" disabled>
                  <option value="6">6 roulements</option>
                  <option value="8">8 roulements</option>
                  <option value="10">10 roulements</option>
                  <option value="12">12 roulements</option>
                  <option value="16">16 roulements</option>
                </select>
              </div>
            </div>

            <div class="matches-grid" id="matches-grid">
              <div class="empty">
                Configure un tournoi sur la page d‚Äôaccueil pour afficher les matchs ici.
              </div>
            </div>

            <div class="roulement-nav">
              <div style="display:flex; gap:10px; align-items:center;">
                <button class="btn-arrow" id="btn-prev">‚óÄ</button>
                <button class="btn-arrow" id="btn-next">‚ñ∂</button>
              </div>
              <div class="roulement-nav-label">
                Roulement <span id="label-roulement">1</span>/<span id="label-roulements-max">16</span>
              </div>
            </div>

            <div class="rest-card">
              <div class="rest-title">√âquipes au repos</div>
              <div class="rest-list" id="rest-list"></div>

              <div class="legend">
                <div class="legend-item">
                  <span class="legend-dot win"></span>
                  <span>Vainqueur valid√©</span>
                </div>
                <div class="legend-item">
                  <span class="legend-dot rest"></span>
                  <span>√âquipe au repos sur ce roulement</span>
                </div>
                <div class="legend-item">
                  <span class="tag-small">Clique sur ‚ÄúVainqueur‚Äù pour mettre √† jour le classement</span>
                </div>
              </div>
            </div>
          </section>

          <!-- CLASSEMENT & √âQUIPES -->
          <section class="card">
            <div class="card-header">
              <div class="card-title">
                <h2>Classement & √©quipes</h2>
                <span>3 pts par victoire ‚Ä¢ classement live</span>
              </div>
              <span class="pill" id="pill-teams">0 √©quipe</span>
            </div>

            <div class="field-group" style="margin-bottom:4px;">
              <label>Liste des √©quipes (clic pour renommer)</label>
            </div>
            <div id="teams-edit" style="display:flex;flex-wrap:wrap;gap:4px;margin-bottom:8px;max-height:110px;overflow-y:auto;">
              <div class="empty" style="flex:1;">
                Les √©quipes appara√Ætront ici apr√®s le lancement du tournoi.
              </div>
            </div>

            <div class="field-group" style="margin-bottom:4px;">
              <label>Classement g√©n√©ral</label>
            </div>
            <div id="ranking" class="ranking-list">
              <div class="empty">
                D√®s que tu auras d√©clar√© quelques vainqueurs, le classement s‚Äôaffichera ici.
              </div>
            </div>

            <div style="margin-top:8px; display:flex; justify-content:flex-end;">
              <button class="btn-icon secondary" id="btn-finish">
                ‚úÖ Marquer le tournoi comme termin√©
              </button>
            </div>
          </section>
        </div>
      </section>

      <!-- VUE TV -->
      <section id="tv-screen" class="hidden">
        <div class="tv-header">
          <div class="tv-header-left">
            <div class="tv-logo-frame">
              <img src="https://lh3.googleusercontent.com/p/AF1QipNpQrOfpCxdRelQ7dF2r-elyslV__xZz5mOazHu=s1360-w1360-h1020-rw" alt="Padel Parc">
            </div>
            <div class="tv-header-text">
              <div class="tv-topline">üéæ PADEL PARC ‚Ä¢ MONTANTE / DESCENDANTE</div>
              <div class="tv-title" id="tv-tournament-name">Nom du tournoi</div>
            </div>
          </div>
          <div class="tv-header-right">
            <div class="tv-meta-chip">
              <span id="tv-meta-teams">0 √©quipe</span>
              <span class="sep-dot"></span>
              <span>R<span id="tv-meta-roulement">1</span>/<span id="tv-meta-roulements-max">16</span></span>
            </div>
          </div>
        </div>

        <div class="tv-layout">
          <!-- Terrains -->
          <section class="tv-card">
            <div class="tv-card-title">üéæ Terrains</div>

            <div>
              <div class="tv-matches-label-row">
                <span class="tv-matches-label">üéØ Maintenant</span>
                <span class="tv-matches-roulement">R<span id="tv-roulement-now">1</span></span>
              </div>
              <div class="tv-matches-grid" id="tv-matches-now">
                <div class="empty">Aucun match √† afficher pour l‚Äôinstant.</div>
              </div>
            </div>

            <div style="margin-top:10px;">
              <div class="tv-matches-label-row">
                <span class="tv-matches-label">‚è≠Ô∏è √Ä suivre</span>
                <span class="tv-matches-roulement">R<span id="tv-roulement-next">2</span></span>
              </div>
              <div class="tv-matches-grid" id="tv-matches-next">
                <div class="empty">Prochain roulement non disponible.</div>
              </div>
            </div>
          </section>

          <!-- Repos + classement -->
          <section class="tv-card">
            <div class="tv-card-title">üò¥ Repos & üèÜ Classement</div>

            <div>
              <div style="font-size:0.8rem; text-transform:uppercase; letter-spacing:0.16em; color:var(--blue-soft); margin-bottom:3px;">
                √âquipes au repos
              </div>
              <div class="tv-rest-list" id="tv-rest">
                <span class="empty" style="font-size:0.8rem;">Aucune √©quipe au repos sur ce roulement.</span>
              </div>
            </div>

            <div style="margin-top:8px;">
              <div style="font-size:0.8rem; text-transform:uppercase; letter-spacing:0.16em; color:var(--blue-soft); margin-bottom:3px;">
                Classement live
              </div>
              <div class="tv-ranking-list" id="tv-ranking">
                <div class="empty">Le classement appara√Ætra apr√®s les premiers r√©sultats.</div>
              </div>
            </div>
          </section>
        </div>

        <div class="tv-back-row">
          <button class="btn-icon secondary" id="btn-tv-back">
            ‚Üê Retour admin
          </button>
        </div>
      </section>

    </div>
  </div>

  <script>
    var HISTORY_KEY = "padel_md_history_v1";

    var state = {
      name: "",
      teamCount: 16,
      maxRoulements: 12,
      teams: [],
      results: {},
      currentRoulement: 1,
      historyId: null
    };

    var historyList = [];

    var homeScreen       = document.getElementById("home-screen");
    var tournamentScreen = document.getElementById("tournament-screen");
    var tvScreen         = document.getElementById("tv-screen");

    var homeName        = document.getElementById("home-name");
    var homeTeams       = document.getElementById("home-teams");
    var homeRoulements  = document.getElementById("home-roulements");
    var homeStart       = document.getElementById("home-start");

    var historyListEl   = document.getElementById("history-list");
    var historyCount    = document.getElementById("history-count");

    var inputTourneyName= document.getElementById("input-tourney-name");
    var selectTeamCount = document.getElementById("select-team-count");
    var selectRoulements= document.getElementById("select-roulements");

    var headerTourney   = document.getElementById("header-tournament-name");
    var headerMetaTeams = document.getElementById("header-meta-teams");
    var headerMetaFmt   = document.getElementById("header-meta-format");
    var chipRoulement   = document.getElementById("chip-roulement");
    var chipRoulementsMax = document.getElementById("chip-roulements-max");

    var pillFormat      = document.getElementById("pill-format");
    var pillTeams       = document.getElementById("pill-teams");
    var roulementInfo   = document.getElementById("roulement-info");
    var matchesGrid     = document.getElementById("matches-grid");
    var restList        = document.getElementById("rest-list");
    var teamsEdit       = document.getElementById("teams-edit");
    var rankingEl       = document.getElementById("ranking");
    var labelRoulement  = document.getElementById("label-roulement");
    var labelRoulementsMax = document.getElementById("label-roulements-max");

    var btnPrev         = document.getElementById("btn-prev");
    var btnNext         = document.getElementById("btn-next");
    var btnFullscreen   = document.getElementById("btn-fullscreen");
    var btnBackHome     = document.getElementById("btn-back-home");
    var btnFinish       = document.getElementById("btn-finish");
    var btnTvView       = document.getElementById("btn-tv-view");
    var btnTvBack       = document.getElementById("btn-tv-back");

    // TV refs
    var tvTournamentName   = document.getElementById("tv-tournament-name");
    var tvMetaTeams        = document.getElementById("tv-meta-teams");
    var tvMetaRoulement    = document.getElementById("tv-meta-roulement");
    var tvMetaRoulementsMax= document.getElementById("tv-meta-roulements-max");
    var tvMatchesNow       = document.getElementById("tv-matches-now");
    var tvMatchesNext      = document.getElementById("tv-matches-next");
    var tvRoulementNow     = document.getElementById("tv-roulement-now");
    var tvRoulementNext    = document.getElementById("tv-roulement-next");
    var tvRest             = document.getElementById("tv-rest");
    var tvRanking          = document.getElementById("tv-ranking");

    document.addEventListener("DOMContentLoaded", function() {
      loadHistory();
      renderHistory();
    });

    homeStart.addEventListener("click", startFromHome);
    historyListEl.addEventListener("click", onHistoryClick);
    btnPrev.addEventListener("click", function(){ changeRoulement(-1); });
    btnNext.addEventListener("click", function(){ changeRoulement(1); });
    btnFullscreen.addEventListener("click", toggleFullscreen);
    btnBackHome.addEventListener("click", goBackHome);
    btnFinish.addEventListener("click", markTournamentFinished);
    btnTvView.addEventListener("click", showTvScreen);
    btnTvBack.addEventListener("click", function(){
      tvScreen.classList.add("hidden");
      tournamentScreen.classList.remove("hidden");
    });

    function cloneTeams(arr){
      return arr.map(function(t){ return {id:t.id, name:t.name}; });
    }
    function cloneResults(res){
      var out={};
      for (var k in res){ if (Object.prototype.hasOwnProperty.call(res,k)) out[k]=res[k]; }
      return out;
    }
    function stateToSnapshot(){
      return {
        name: state.name,
        teamCount: state.teamCount,
        maxRoulements: state.maxRoulements,
        teams: cloneTeams(state.teams),
        results: cloneResults(state.results),
        currentRoulement: state.currentRoulement
      };
    }
    function updateHistorySnapshot(){
      if (!state.historyId) return;
      var item = historyList.find(function(h){ return h.id===state.historyId; });
      if (!item) return;
      item.name = state.name;
      item.teamCount = state.teamCount;
      item.maxRoulements = state.maxRoulements;
      item.snapshot = stateToSnapshot();
      saveHistory();
      renderHistory();
    }

    function loadHistory() {
      try {
        var raw = localStorage.getItem(HISTORY_KEY);
        historyList = raw ? JSON.parse(raw) : [];
      } catch(e) {
        historyList = [];
      }
    }

    function saveHistory() {
      try {
        localStorage.setItem(HISTORY_KEY, JSON.stringify(historyList));
      } catch(e) {}
    }

    function renderHistory() {
      if (!historyList.length) {
        historyListEl.innerHTML =
          '<div class="empty">Aucun tournoi enregistr√© pour l‚Äôinstant.<br>Lance ton premier √©v√©nement pour le voir appara√Ætre ici.</div>';
        historyCount.textContent = "0 tournoi";
        return;
      }
      historyCount.textContent = historyList.length + " tournoi" + (historyList.length>1?"s":"");

      historyListEl.innerHTML = historyList.map(function(item){
        var created = new Date(item.createdAt);
        var createdLabel = created.toLocaleDateString("fr-FR", {
          day:"2-digit", month:"2-digit", year:"2-digit",
          hour:"2-digit", minute:"2-digit"
        });
        var badgeClass = item.status==="termine" ? "badge-termine" : "badge-en-cours";
        var badgeText  = item.status==="termine" ? "Termin√©" : "En cours";

        return ''+
          '<article class="history-item" data-id="'+item.id+'">'+
            '<div class="history-main">'+
              '<div class="history-name">'+escapeHtml(item.name)+'</div>'+
              '<div class="history-meta">'+item.teamCount+' √©quipes ‚Ä¢ '+item.maxRoulements+' roulements ‚Ä¢ '+createdLabel+'</div>'+
            '</div>'+
            '<div class="history-actions">'+
              '<button class="btn-small" data-role="open" data-id="'+item.id+'">Ouvrir</button>'+
              '<span class="badge-status '+badgeClass+'">'+badgeText+'</span>'+
              '<button class="btn-small danger" data-role="delete" data-id="'+item.id+'">üóë</button>'+
            '</div>'+
          '</article>';
      }).join("");
    }

    function onHistoryClick(e){
      var delBtn = e.target.closest && e.target.closest("button[data-role='delete']");
      if (delBtn){
        var idDel = delBtn.getAttribute("data-id");
        if (!idDel) return;
        if (!confirm("Supprimer ce tournoi de l'historique ?")) return;
        historyList = historyList.filter(function(h){ return String(h.id)!==String(idDel); });
        saveHistory();
        renderHistory();
        return;
      }
      var openBtn = e.target.closest && e.target.closest("button[data-role='open']");
      if (openBtn){
        var idOpen = openBtn.getAttribute("data-id");
        if (!idOpen) return;
        openHistoryTournament(parseInt(idOpen,10));
      }
    }

    function openHistoryTournament(id){
      var item = historyList.find(function(h){ return h.id===id; });
      if (!item) return;
      state.historyId = id;
      var snap = item.snapshot || {
        name: item.name,
        teamCount: item.teamCount,
        maxRoulements: item.maxRoulements,
        teams: [],
        results: {},
        currentRoulement: 1
      };

      state.name = snap.name;
      state.teamCount = snap.teamCount;
      state.maxRoulements = snap.maxRoulements;
      state.currentRoulement = snap.currentRoulement || 1;
      state.results = snap.results || {};
      state.teams = (snap.teams && snap.teams.length)
        ? snap.teams.map(function(t){ return {id:t.id, name:t.name}; })
        : generateDefaultTeams(state.teamCount);

      inputTourneyName.value = state.name;
      selectTeamCount.value  = String(state.teamCount);
      selectRoulements.value = String(state.maxRoulements);

      applyStateToUI();
      showTournamentScreen();
    }

    function startFromHome(){
      var name   = (homeName.value || "").trim();
      var tCount = parseInt(homeTeams.value,10);
      var maxR   = parseInt(homeRoulements.value,10);

      if (!name) { alert("Merci de saisir un nom de tournoi üòä"); return; }
      if ([8,12,16].indexOf(tCount)===-1) { alert("Nombre d'√©quipes invalide (8, 12 ou 16)."); return; }

      state.name = name;
      state.teamCount = tCount;
      state.maxRoulements = maxR;
      state.currentRoulement = 1;
      state.results = {};
      state.teams = generateDefaultTeams(tCount);

      inputTourneyName.value = name;
      selectTeamCount.value  = String(tCount);
      selectRoulements.value = String(maxR);

      applyStateToUI();
      addHistoryEntry();
      showTournamentScreen();
    }

    function generateDefaultTeams(count){
      var arr=[];
      for (var i=1;i<=count;i++) arr.push({id:i, name:"√âquipe "+i});
      return arr;
    }

    function addHistoryEntry(){
      var id = Date.now();
      state.historyId = id;
      historyList.push({
        id: id,
        name: state.name,
        teamCount: state.teamCount,
        maxRoulements: state.maxRoulements,
        createdAt: new Date().toISOString(),
        status: "en_cours",
        snapshot: stateToSnapshot()
      });
      saveHistory();
      renderHistory();
    }

    function markTournamentFinished(){
      if (!state.historyId) {
        alert("Ce tournoi n‚Äôest pas li√© √† l‚Äôhistorique (lanc√© en mode d√©mo).");
        return;
      }
      var item = historyList.find(function(h){ return h.id===state.historyId; });
      if (item) {
        item.status = "termine";
        item.finishedAt = new Date().toISOString();
        item.snapshot = stateToSnapshot();
        saveHistory();
        renderHistory();
        alert("Tournoi marqu√© comme termin√© ‚úÖ");
      }
    }

    function showTournamentScreen(){
      homeScreen.classList.add("hidden");
      tvScreen.classList.add("hidden");
      tournamentScreen.classList.remove("hidden");
    }
    function goBackHome(){
      tournamentScreen.classList.add("hidden");
      tvScreen.classList.add("hidden");
      homeScreen.classList.remove("hidden");
    }

    function showTvScreen(){
      tournamentScreen.classList.add("hidden");
      homeScreen.classList.add("hidden");
      tvScreen.classList.remove("hidden");
      renderTv();
    }

    function applyStateToUI(){
      headerTourney.textContent   = state.name;
      headerMetaTeams.textContent = state.teamCount+" √©quipe"+(state.teamCount>1?"s":"");
      headerMetaFmt.textContent   = "format Montante/Descendante";
      chipRoulement.textContent   = String(state.currentRoulement);
      chipRoulementsMax.textContent = String(state.maxRoulements);
      labelRoulementsMax.textContent = String(state.maxRoulements);
      labelRoulement.textContent  = String(state.currentRoulement);
      pillTeams.textContent       = state.teamCount+" √©quipe"+(state.teamCount>1?"s":"");

      if (state.teamCount===8)      pillFormat.textContent = "8 √©quipes ‚Äì 4 terrains, aucun repos";
      else if (state.teamCount===12)pillFormat.textContent = "12 √©quipes ‚Äì 8 jouent, 4 repos (rotation)";
      else                          pillFormat.textContent = "16 √©quipes ‚Äì 8 jouent, 8 repos (pair/impair)";

      roulementInfo.textContent = "Roulement "+state.currentRoulement+" lanc√©. D√©clare les vainqueurs pour activer le classement.";

      renderTeamsEditor();
      renderRoulement();
      renderRanking();
      renderTv();
    }

    function changeRoulement(delta){
      if (!state.teams.length) return;
      var newR = state.currentRoulement + delta;
      if (newR<1 || newR>state.maxRoulements) return;
      state.currentRoulement = newR;
      chipRoulement.textContent = String(newR);
      labelRoulement.textContent = String(newR);
      renderRoulement();
      renderRanking();
      renderTv();
      updateHistorySnapshot();
    }

    function toggleFullscreen(){
      if (!document.fullscreenElement) {
        if (document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
      } else {
        if (document.exitFullscreen) document.exitFullscreen();
      }
    }

    function getCycleLength(){
      if (state.teamCount===8) return 1;
      if (state.teamCount===12) return 3;
      return 2;
    }

    function getPlayingAndRestTeams(roulementNumber){
      var teams = state.teams;
      var teamCount = state.teamCount;
      if (!teams.length) return {playing:[], rest:[]};

      if (teamCount===8){
        return {playing: teams.slice(0,8), rest: []};
      }
      if (teamCount===12){
        var idx = (roulementNumber-1)%3;
        var playingIds;
        if (idx===0)      playingIds = range(1,8);
        else if (idx===1) playingIds = range(5,12);
        else              playingIds = range(1,4).concat(range(9,12));
        var playing = teams.filter(function(t){ return playingIds.indexOf(t.id)!==-1; });
        var rest = teams.filter(function(t){ return playingIds.indexOf(t.id)===-1; });
        return {playing:playing, rest:rest};
      }
      var isEven = roulementNumber%2===0;
      var playing16 = isEven ? teams.slice(0,8) : teams.slice(8,16);
      var rest16    = teams.filter(function(t){ return playing16.indexOf(t)===-1; });
      return {playing:playing16, rest:rest16};
    }

    function range(start,end){
      var out=[];
      for (var i=start;i<=end;i++) out.push(i);
      return out;
    }

    function computeMatchesForRoulement(roulementNumber){
      var pr = getPlayingAndRestTeams(roulementNumber);
      var playing = pr.playing.slice();
      if (playing.length<2) return [];

      playing.sort(function(a,b){ return a.id-b.id; });

      var cycleLen = getCycleLength();
      var baseRoulement = ((roulementNumber-1)%cycleLen)+1;
      var steps = Math.floor((roulementNumber-1)/cycleLen);

      var arrangement = {};
      for (var t=1;t<=4;t++){
        var idxA = (t-1)*2;
        var idxB = idxA+1;
        if (idxB>=playing.length) break;
        arrangement[t] = [playing[idxA].id, playing[idxB].id];
      }

      for (var s=0;s<steps;s++){
        var prevR = baseRoulement + s*cycleLen;
        var prevResults = [];
        for (var terrain=1;terrain<=4;terrain++){
          if (!arrangement[terrain]) continue;
          var pair = arrangement[terrain];
          var key = resultKey(prevR, terrain);
          var winnerId = state.results[key] || pair[0];
          var loserId  = (winnerId===pair[0]) ? pair[1] : pair[0];
          prevResults.push({terrain:terrain, winnerId:winnerId, loserId:loserId});
        }
        arrangement = computeNextArrangement(prevResults, arrangement);
      }

      var matches = [];
      for (var terrain2=1;terrain2<=4;terrain2++){
        if (!arrangement[terrain2]) continue;
        var ids = arrangement[terrain2];
        var teamA = findTeamById(ids[0]);
        var teamB = findTeamById(ids[1]);
        if (!teamA || !teamB) continue;
        matches.push({terrain:terrain2, teamA:teamA, teamB:teamB});
      }
      return matches;
    }

    function computeNextArrangement(prevResults, currentArrangement){
      var resByT = {};
      prevResults.forEach(function(r){ resByT[r.terrain]=r; });

      var positions = {};
      if (resByT[1] && resByT[2]) positions[1] = [resByT[1].winnerId, resByT[2].winnerId];
      else if (currentArrangement[1]) positions[1] = currentArrangement[1].slice();

      if (resByT[1] && resByT[3]) positions[2] = [resByT[1].loserId, resByT[3].winnerId];
      else if (currentArrangement[2]) positions[2] = currentArrangement[2].slice();

      if (resByT[2] && resByT[4]) positions[3] = [resByT[2].loserId, resByT[4].winnerId];
      else if (currentArrangement[3]) positions[3] = currentArrangement[3].slice();

      if (resByT[3] && resByT[4]) positions[4] = [resByT[3].loserId, resByT[4].loserId];
      else if (currentArrangement[4]) positions[4] = currentArrangement[4].slice();

      return positions;
    }

    function findTeamById(id){
      return state.teams.find(function(t){ return t.id===id; });
    }

    function renderRoulement(){
      var r = state.currentRoulement;
      labelRoulement.textContent = String(r);

      if (!state.teams.length){
        matchesGrid.innerHTML = '<div class="empty">Lance un tournoi depuis la page d‚Äôaccueil pour g√©n√©rer les roulements.</div>';
        restList.innerHTML = "";
        btnPrev.disabled = true;
        btnNext.disabled = true;
        renderTv();
        return;
      }

      var pr = getPlayingAndRestTeams(r);
      var playing = pr.playing;
      var rest = pr.rest;

      if (state.teamCount===8)
        roulementInfo.textContent = "Roulement "+r+" ‚Äì 8 √©quipes sur les terrains, aucune au repos.";
      else if (state.teamCount===12)
        roulementInfo.textContent = "Roulement "+r+" ‚Äì 8 √©quipes jouent, 4 au repos (rotation sur 3 roulements).";
      else
        roulementInfo.textContent = "Roulement "+r+" ‚Äì 8 √©quipes jouent, 8 au repos (pair/impair).";

      var matches = computeMatchesForRoulement(r);
      if (!matches.length){
        matchesGrid.innerHTML = '<div class="empty">Pas assez d‚Äô√©quipes pour g√©n√©rer des matchs sur ce roulement.</div>';
      } else {
        matchesGrid.innerHTML = matches.map(function(m){ return renderCourtHTML(m, r); }).join("");
        attachWinnerButtons();
      }

      if (!rest.length){
        restList.innerHTML = '<span style="font-size:0.75rem; color:var(--text-muted);">Aucune √©quipe ne se repose sur ce roulement.</span>';
      } else {
        restList.innerHTML = rest.map(function(t){
          return '<span class="rest-pill">'+escapeHtml(t.name)+'</span>';
        }).join("");
      }

      btnPrev.disabled = (r===1);
      btnNext.disabled = (r===state.maxRoulements);

      renderTv();
    }

    function renderCourtHTML(match, roulement){
      var key = resultKey(roulement, match.terrain);
      var winnerId = state.results[key] || null;
      var isWinnerA = winnerId===match.teamA.id;
      var isWinnerB = winnerId===match.teamB.id;

      var tiers = {1:"Plus fort",2:"Inter +",3:"Inter -",4:"Terrain fun"};

      return ''+
        '<article class="court-card">'+
          '<div class="court-header">'+
            '<div class="court-name">'+
              '<span class="label">Terrain</span>'+
              '<span class="value">#'+match.terrain+'</span>'+
            '</div>'+
            '<span class="court-tier">'+(tiers[match.terrain]||"Terrain")+'</span>'+
          '</div>'+
          '<div class="match-body">'+
            '<div class="team-row '+(isWinnerA?"winner":"")+'">'+
              '<div style="display:flex;align-items:center;flex:1;min-width:0;">'+
                '<span class="team-label">A</span>'+
                '<span class="team-name">'+escapeHtml(match.teamA.name)+'</span>'+
              '</div>'+
              '<button class="btn-win '+(isWinnerA?"":"inactive")+'" data-role="set-winner" data-team-id="'+match.teamA.id+'" data-roulement="'+roulement+'" data-terrain="'+match.terrain+'">‚úî Vainqueur</button>'+
            '</div>'+
            '<div class="team-row '+(isWinnerB?"winner":"")+'">'+
              '<div style="display:flex;align-items:center;flex:1;min-width:0;">'+
                '<span class="team-label">B</span>'+
                '<span class="team-name">'+escapeHtml(match.teamB.name)+'</span>'+
              '</div>'+
              '<button class="btn-win '+(isWinnerB?"":"inactive")+'" data-role="set-winner" data-team-id="'+match.teamB.id+'" data-roulement="'+roulement+'" data-terrain="'+match.terrain+'">‚úî Vainqueur</button>'+
            '</div>'+
          '</div>'+
          '<div class="match-footer">'+
            '<span class="tag-small">Match R'+roulement+'-T'+match.terrain+'</span>'+
            '<span>'+(winnerId ? "<span class='text-success'>R√©sultat enregistr√©</span>" : "En attente de r√©sultat")+'</span>'+
          '</div>'+
        '</article>';
    }

    function attachWinnerButtons(){
      var btns = document.querySelectorAll("button[data-role='set-winner']");
      for (var i=0;i<btns.length;i++){
        btns[i].addEventListener("click", function(){
          var teamId = parseInt(this.getAttribute("data-team-id"),10);
          var r = parseInt(this.getAttribute("data-roulement"),10);
          var t = parseInt(this.getAttribute("data-terrain"),10);
          setWinner(r,t,teamId);
        });
      }
    }

    function resultKey(r,t){ return "R"+r+"-T"+t; }

    function setWinner(roulement, terrain, teamId){
      var key = resultKey(roulement, terrain);
      state.results[key] = teamId;
      renderRoulement();
      renderRanking();
      renderTv();
      updateHistorySnapshot();
    }

    function renderTeamsEditor(){
      if (!state.teams.length){
        teamsEdit.innerHTML = '<div class="empty" style="flex:1;">Les √©quipes appara√Ætront ici apr√®s le lancement du tournoi.</div>';
        return;
      }
      teamsEdit.innerHTML = state.teams.map(function(t){
        return ''+
        '<div style="display:flex;align-items:center;gap:4px;background:rgba(7,34,68,0.97);border:1px solid rgba(148,163,184,0.9);border-radius:999px;padding:3px 7px;">'+
          '<span style="font-size:0.7rem;color:var(--blue-soft);">#'+t.id+'</span>'+
          '<input type="text" data-team-id="'+t.id+'" value="'+escapeHtml(t.name)+'" '+
            'style="background:transparent;border:none;outline:none;color:var(--text-light);font-size:0.78rem;min-width:40px;" />'+
        '</div>';
      }).join("");

      var inputs = teamsEdit.querySelectorAll("input[data-team-id]");
      for (var i=0;i<inputs.length;i++){
        inputs[i].addEventListener("input", function(){
          var id = parseInt(this.getAttribute("data-team-id"),10);
          var team = state.teams.find(function(t){ return t.id===id; });
          if (team){
            team.name = this.value.trim() || ("√âquipe "+id);
            renderRoulement();
            renderRanking();
            renderTv();
            updateHistorySnapshot();
          }
        });
      }
    }

    function renderRanking(){
      if (!state.teams.length){
        rankingEl.innerHTML = '<div class="empty">Lance un tournoi depuis la page d‚Äôaccueil pour voir le classement.</div>';
        return;
      }
      var stats = computeStats();

      var hasMatch = stats.some(function(s){ return s.matches>0; });
      if (!hasMatch){
        rankingEl.innerHTML = '<div class="empty">D√®s que tu auras d√©clar√© quelques vainqueurs, le classement s‚Äôaffichera ici.</div>';
        return;
      }

      rankingEl.innerHTML = stats.map(function(s,idx){
        var pos = idx+1;
        var medalClass="default", medalLabel=pos+".";
        if (pos===1){ medalClass="gold"; medalLabel="ü•á"; }
        else if (pos===2){ medalClass="silver"; medalLabel="ü•à"; }
        else if (pos===3){ medalClass="bronze"; medalLabel="ü•â"; }

        return ''+
          '<div class="ranking-item">'+
            '<div class="ranking-main">'+
              '<div class="ranking-medal '+medalClass+'">'+medalLabel+'</div>'+
              '<div>'+
                '<div class="ranking-name">'+escapeHtml(s.name)+'</div>'+
                '<div class="ranking-sub">√âquipe '+s.id+'</div>'+
              '</div>'+
            '</div>'+
            '<div class="ranking-meta">'+
              '<div><strong>'+s.points+' pts</strong></div>'+
              '<div>'+s.wins+'V - '+s.losses+'D</div>'+
              '<div>'+s.matches+' match'+(s.matches>1?'s':'')+'</div>'+
            '</div>'+
          '</div>';
      }).join("");
    }

    function computeStats(){
      var stats = state.teams.map(function(t){
        return {id:t.id, name:t.name, wins:0, losses:0, points:0, matches:0};
      });

      for (var r=1;r<=state.maxRoulements;r++){
        var matches = computeMatchesForRoulement(r);
        for (var m=0;m<matches.length;m++){
          var match = matches[m];
          var key = resultKey(r, match.terrain);
          var winnerId = state.results[key];
          if (!winnerId) continue;
          var sA = stats.find(function(s){ return s.id===match.teamA.id; });
          var sB = stats.find(function(s){ return s.id===match.teamB.id; });
          if (!sA || !sB) continue;
          sA.matches++; sB.matches++;
          if (winnerId===match.teamA.id){
            sA.wins++; sA.points+=3; sB.losses++;
          } else if (winnerId===match.teamB.id){
            sB.wins++; sB.points+=3; sA.losses++;
          }
        }
      }

      stats.sort(function(a,b){
        if (b.points!==a.points) return b.points-a.points;
        if (b.wins!==a.wins)     return b.wins-a.wins;
        return a.name.localeCompare(b.name);
      });

      return stats;
    }

    /* VUE TV */

    function renderTv(){
      tvTournamentName.textContent = state.name || "Tournoi Padel Parc";
      tvMetaTeams.textContent = state.teamCount+" √©quipe"+(state.teamCount>1?"s":"");
      tvMetaRoulement.textContent = String(state.currentRoulement);
      tvMetaRoulementsMax.textContent = String(state.maxRoulements);

      if (!state.teams.length){
        tvMatchesNow.innerHTML = '<div class="empty">Lance un tournoi pour afficher les terrains.</div>';
        tvMatchesNext.innerHTML = '<div class="empty">Prochain roulement non disponible.</div>';
        tvRest.innerHTML    = '<span class="empty" style="font-size:0.8rem;">Aucune √©quipe au repos pour le moment.</span>';
        tvRanking.innerHTML = '<div class="empty">Le classement appara√Ætra apr√®s les premiers r√©sultats.</div>';
        return;
      }

      var r = state.currentRoulement;
      var matchesNow = computeMatchesForRoulement(r);
      var pr = getPlayingAndRestTeams(r);
      var rest = pr.rest;

      tvRoulementNow.textContent = String(r);

      var tiers = {1:"Plus fort",2:"Inter +",3:"Inter -",4:"Terrain fun"};

      // MATCHS EN COURS (bleu)
      if (!matchesNow.length){
        tvMatchesNow.innerHTML = '<div class="empty">Pas de match sur ce roulement.</div>';
      } else {
        tvMatchesNow.innerHTML = matchesNow.map(function(m){
          var key = resultKey(r, m.terrain);
          var winnerId = state.results[key];
          var winnerName = "";
          if (winnerId===m.teamA.id) winnerName = m.teamA.name;
          else if (winnerId===m.teamB.id) winnerName = m.teamB.name;

          return ''+
            '<article class="tv-court tv-court-now">'+
              '<div class="tv-court-header">'+
                '<div class="tv-court-name">Terrain #'+m.terrain+'</div>'+
                '<div class="tv-court-tag">'+(tiers[m.terrain]||"Terrain")+'</div>'+
              '</div>'+
              '<div class="tv-teams">'+
                '<div class="tv-team"><div class="tv-team-name">'+escapeHtml(m.teamA.name)+'</div></div>'+
                '<div class="tv-team-vs">VS</div>'+
                '<div class="tv-team"><div class="tv-team-name">'+escapeHtml(m.teamB.name)+'</div></div>'+
              '</div>'+
              '<div class="tv-status">'+
                (winnerName
                  ? '<span class="winner">üèÜ '+escapeHtml(winnerName)+'</span>'
                  : '‚è±Ô∏è En cours')+
              '</div>'+
            '</article>';
        }).join("");
      }

      // REPOS
      if (!rest.length){
        tvRest.innerHTML = '<span class="empty" style="font-size:0.8rem;">Aucune √©quipe au repos sur ce roulement.</span>';
      } else {
        tvRest.innerHTML = rest.map(function(t){
          return '<span class="tv-rest-pill">'+escapeHtml(t.name)+'</span>';
        }).join("");
      }

      // CLASSEMENT ‚Äì PODIUM + 2 COLONNES, SANS SCROLL
      var stats = computeStats();
      var hasMatch = stats.some(function(s){ return s.matches>0; });
      if (!hasMatch){
        tvRanking.innerHTML = '<div class="empty">Le classement appara√Ætra apr√®s les premiers r√©sultats.</div>';
      } else {
        // On limite √† 16 √©quipes max pour la TV
        stats = stats.slice(0,16);
        var top3 = stats.slice(0,3);
        var restStats = stats.slice(3);

        var podiumHtml = "";
        if (top3.length){
          podiumHtml += '<div class="tv-ranking-top"><div class="tv-ranking-podium">';
          podiumHtml += top3.map(function(s, idx){
            var rank = idx+1;
            var clazz = rank===1 ? "first" : rank===2 ? "second" : "third";
            var emoji = rank===1 ? "ü•á" : rank===2 ? "ü•à" : "ü•â";
            return ''+
              '<div class="tv-podium-item '+clazz+'">'+
                '<div class="tv-podium-rank">'+emoji+'</div>'+
                '<div class="tv-podium-name">'+escapeHtml(s.name)+'</div>'+
                '<div class="tv-podium-points">'+s.points+' pts</div>'+
                '<div class="tv-podium-record">'+s.wins+'V - '+s.losses+'D</div>'+
              '</div>';
          }).join("");
          podiumHtml += '</div></div>';
        }

        var restHtml = "";
        if (restStats.length){
          restHtml += '<div class="tv-ranking-rest">';
          restHtml += restStats.map(function(s,idx){
            var pos = idx+4; // positions 4,5,6...
            return ''+
              '<div class="tv-ranking-rest-item">'+
                '<span class="tv-ranking-rest-pos">'+pos+'.</span>'+
                '<span class="tv-ranking-rest-name">'+escapeHtml(s.name)+'</span>'+
                '<span class="tv-ranking-rest-points">'+s.points+' pts</span>'+
              '</div>';
          }).join("");
          restHtml += '</div>';
        }

        tvRanking.innerHTML = podiumHtml + (restHtml || "");
      }

      // PROCHAIN ROULEMENT (d√©grad√© jaune/bleu)
      var nextR = r + 1;
      if (nextR > state.maxRoulements){
        tvRoulementNext.textContent = "-";
        tvMatchesNext.innerHTML = '<div class="empty">Fin du tournoi apr√®s ce roulement.</div>';
      } else {
        tvRoulementNext.textContent = String(nextR);
        var matchesNext = computeMatchesForRoulement(nextR);
        if (!matchesNext.length){
          tvMatchesNext.innerHTML = '<div class="empty">Prochain roulement non disponible.</div>';
        } else {
          tvMatchesNext.innerHTML = matchesNext.map(function(m){
            return ''+
              '<article class="tv-court tv-court-next">'+
                '<div class="tv-court-header">'+
                  '<div class="tv-court-name">Terrain #'+m.terrain+'</div>'+
                  '<div class="tv-court-tag">√Ä suivre</div>'+
                '</div>'+
                '<div class="tv-teams">'+
                  '<div class="tv-team"><div class="tv-team-name">'+escapeHtml(m.teamA.name)+'</div></div>'+
                  '<div class="tv-team-vs">VS</div>'+
                  '<div class="tv-team"><div class="tv-team-name">'+escapeHtml(m.teamB.name)+'</div></div>'+
                '</div>'+
                '<div class="tv-status">üì¢ Pr√©vu prochain roulement</div>'+
              '</article>';
          }).join("");
        }
      }
    }

    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g,function(c){
        return {"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c] || c;
      });
    }
  </script>
</body>
</html>

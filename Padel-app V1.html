<!-- CODEX_RESET_OK -->
<!doctype html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Padel Parc - Gestion</title>
  <link rel="icon" type="image/png" sizes="32x32" href="./assets/Favicon/favicon-32.png?v=1" />
  <link rel="shortcut icon" href="./assets/Favicon/favicon-32.png?v=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="sidebar.css">
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <style>
    :root {
      --brand-primary: #004b9b;
      --brand-primary-rgb: 0, 75, 155;
      --brand-secondary: #4d81b9;
      --brand-secondary-rgb: 77, 129, 185;
      --brand-accent: #e5e339;
      --brand-accent-rgb: 229, 227, 57;
      --brand-bg: #020617;
      --brand-bg-rgb: 2, 6, 23;
      --brand-card-bg: #0b1220;
      --brand-card-bg-rgb: 11, 18, 32;
      --brand-text: #f9fafb;
      --brand-text-rgb: 249, 250, 251;
      --brand-title: #e5e339;
      --brand-title-rgb: 229, 227, 57;
      --brand-accent-soft: rgba(var(--brand-accent-rgb), 0.25);
      --brand-primary-glow: rgba(var(--brand-primary-rgb), 0.55);

      --blue-strong: var(--brand-primary);
      --blue-mid: var(--brand-secondary);
      --blue-soft: var(--brand-secondary);
      --blue-bg: #e6edf5;
      --accent: var(--brand-accent);
      --bg-dark: var(--brand-bg);
      --card: var(--brand-card-bg);
      --border: #1e293b;
      --text: var(--brand-text);
      --muted: #9ca3af;
      --success: #22c55e;
      --danger: #ef4444;
      --app-font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: var(--app-font-family);
      background: radial-gradient(circle at 0 0, var(--brand-accent-soft), transparent 55%),
                  radial-gradient(circle at 100% 100%, var(--brand-primary-glow), transparent 60%),
                  linear-gradient(135deg, var(--bg-dark), var(--bg-dark) 40%, #001428);
      color: var(--text);
      min-height: 100vh;
      padding: 16px;
    }

    /* TV mode: full screen without sidebar */
    body.tv-mode {
      padding: 0;
      overflow-x: hidden;
    }

    h1, h2, h3, h4, h5, h6,
    .card, .btn, .settings-shell, .settings-section,
    input, select, textarea, label,
    .tournaments-title, .small-muted, .chip, .tab,
    .tv-overlay, .tv-match-card, .ranking-item, .team-chip {
      font-family: var(--app-font-family);
    }

    .app {
      max-width: 1100px;
      margin: 0 auto;
      background: radial-gradient(circle at 0 0, rgba(148,163,184,0.25), transparent 55%),
                  var(--bg-dark);
      border-radius: 18px;
      border: 1px solid #1f2937;
      box-shadow: 0 24px 60px rgba(0,0,0,0.85);
      padding: 16px;
    }

    /* HEADER GLOBAL */
    .app-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 4px;
      position: relative;
    }

    .header-back-btn {
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 34px;
      height: 34px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #fff;
      color: #0f172a;
      display: none;
      align-items: center;
      justify-content: center;
      box-shadow: 0 12px 30px rgba(0,0,0,0.4);
      cursor: pointer;
      font-size: 1rem;
      line-height: 1;
      padding: 0;
    }

    #app-logo {
      height: 40px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #020617;
      padding: 4px;
      display: none;
    }

    h1 {
      font-size: 1.5rem;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      text-align: center;
    }

    .subtitle {
      text-align: center;
      font-size: 0.85rem;
      color: var(--muted);
      margin-bottom: 8px;
    }

    .mode-toggle {
      display: flex;
      justify-content: flex-end;
      gap: 6px;
      margin-bottom: 8px;
    }

    .mode-toggle button { font-size: 0.75rem; }

    /* ROOT SECTIONS */
    #home-root { display: block; }
    #admin-root, #tv-root, #tournaments-root, #classic-root, #league-root, #americano-root, #americano-tv-root { display: none; }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 7px 14px;
      border-radius: 999px;
      border: none;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      cursor: pointer;
      background: radial-gradient(circle at 0 0, #fffdea, var(--accent));
      color: #111827;
      box-shadow: 0 12px 30px rgba(0,0,0,0.8);
    }

    .btn-secondary {
      background: #020617;
      color: var(--blue-soft);
      border: 1px solid #1e293b;
      box-shadow: none;
    }

    .btn-small { padding: 4px 9px; font-size: 0.75rem; }

    .btn:disabled {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
    }

    .chip {
      padding: 4px 10px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid #1f2937;
      color: var(--blue-soft);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 0.75rem;
    }

    .small-muted {
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 4px;
    }

    .empty {
      font-size: 0.8rem;
      color: var(--muted);
      padding: 6px 4px;
    }

    /* TIMER M/D */
    .md-timer-panel { margin-top: 12px; }
    .md-timer-controls { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; margin-top: 8px; }
    .md-timer-pop { position: fixed; top: 16px; left: 50%; transform: translateX(-50%); z-index: 9999; display: none; }
    .md-timer-pop .md-timer-shell {
      min-width: 260px;
      background: rgba(10,18,34,0.96);
      border: 1px solid #1e293b;
      border-radius: 12px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.65);
      overflow: hidden;
      position: relative;
    }
    .md-timer-pop .md-timer-shell.pulse { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(var(--brand-accent-rgb), 0.35), 0 22px 50px rgba(0,0,0,0.7); }
    .md-timer-pop header {
      cursor: move;
      background: linear-gradient(135deg, #0f172a, #0b1220);
      padding: 10px 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      user-select: none;
    }
    .md-timer-pop header h4 { margin: 0; font-size: 0.9rem; letter-spacing: 0.08em; text-transform: uppercase; }
    .md-timer-body { padding: 12px; text-align: center; }
    .md-timer-remaining { font-size: 2rem; font-weight: 700; letter-spacing: 0.1em; margin-bottom: 6px; }
    .md-timer-status { font-size: 0.8rem; color: var(--muted); }

    /* HOME */
    .home-hero {
      text-align: center;
      margin-bottom: 14px;
      margin-top: 8px;
    }

    .home-hero h2 {
      font-size: 1.1rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      margin-bottom: 6px;
      color: var(--blue-soft);
    }

    .home-hero p {
      font-size: 0.85rem;
      color: var(--muted);
    }

    .home-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 12px;
      margin-top: 10px;
    }
    @media (max-width: 800px) {
      .home-grid { grid-template-columns: minmax(0,1fr); }
    }

    .home-card {
   .home-card {
  border-radius: 20px;
  padding: 20px;
  border: 1px solid rgba(148, 163, 184, 0.1);
  background: linear-gradient(145deg,
    rgba(11, 18, 32, 0.8) 0%,
    rgba(2, 6, 23, 0.9) 100%);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
  display: flex;
  flex-direction: column;
  gap: 12px;
  position: relative;
  overflow: hidden;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  cursor: pointer;
}

.home-card::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at 0% 0%, 
    rgba(229, 227, 57, 0.08) 0%,
    transparent 50%);
  opacity: 0;
  transition: opacity 0.4s ease;
  pointer-events: none;
}

.home-card:hover {
  transform: translateY(-8px) scale(1.02);
  border-color: rgba(229, 227, 57, 0.3);
  box-shadow: 
    0 20px 48px rgba(0, 0, 0, 0.8),
    0 0 0 1px rgba(229, 227, 57, 0.2);
}

.home-card:hover::before {
  opacity: 1;
}

.home-card-icon {
  width: 56px;
  height: 56px;
  border-radius: 16px;
  background: linear-gradient(135deg, var(--brand-accent), var(--brand-title));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  box-shadow: 0 8px 20px rgba(229, 227, 57, 0.3);
  transition: all 0.3s ease;
}

.home-card:hover .home-card-icon {
  transform: scale(1.1) rotate(5deg);
  box-shadow: 0 12px 28px rgba(229, 227, 57, 0.5);
}
    }

    .home-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    /* Nouveau : couleur des titres pilotée par le thème */
    .home-card-title,
    .tournaments-title,
    .settings-header h2,
    .settings-subtitle,
    .card h1,
    .card h2,
    .card h3,
    h1, h2, h3,
    .tv-title,
    .md-timer-display {
      color: var(--brand-title, var(--brand-accent));
    }

    .home-card-title {
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }

    .home-card-icon {
      font-size: 0.87rem;
    }

    .home-card-body {
      font-size: 0.85rem;
      color: var(--muted);
    }

    .home-card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 4px;
      gap: 8px;
      font-size: 0.8rem;
      color: var(--blue-soft);
    }

    .home-badge {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
    }

    /* GENERIC CARD / GRID (ADMIN + TOURNAMENTS) */
    .grid {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.4fr);
      gap: 12px;
    }
    @media (max-width: 900px) {
      .grid { grid-template-columns: minmax(0,1fr); }
    }

    .card {
      background: linear-gradient(145deg, var(--card), var(--card) 40%, var(--bg-dark));
      border-radius: 14px;
      border: 1px solid var(--border);
      padding: 12px;
    }

    .card h2 {
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      margin-bottom: 6px;
    }

    .card p {
      font-size: 0.8rem;
      color: var(--muted);
      margin-bottom: 8px;
    }

    /* Effet interactif léger pour les blocs d'admin (exclu TV / vues joueur) */
    .app-block-interactive {
      transition: transform 0.15s ease-out, box-shadow 0.15s ease-out, background-color 0.15s ease-out;
      cursor: pointer;
    }
    .app-block-interactive:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 12px 30px rgba(250, 204, 21, 0.15), 0 10px 25px rgba(0,0,0,0.45);
      background-color: rgba(250, 204, 21, 0.08);
    }

    /* Début styles typographie personnalisée */
    .app-font-system { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    .app-font-inter { font-family: "Inter", system-ui, sans-serif; }
    .app-font-poppins { font-family: "Poppins", system-ui, sans-serif; }
    .app-font-montserrat { font-family: "Montserrat", system-ui, sans-serif; }
    /* Fin styles typographie personnalisée */

    /* Début thèmes boutons */
    .app-buttons-solid .btn { border: 1px solid transparent; }
    .app-buttons-outline .btn { background: transparent !important; border: 1px solid var(--brand-primary); color: var(--brand-primary); }
    .app-buttons-ghost .btn { background: transparent !important; border: 1px solid transparent; color: var(--brand-primary); }
    /* Fin thèmes boutons */

    /* Début formes cartes */
    .app-cards-square .card,
    .app-cards-square .ligue-match-card,
    .app-cards-square .tournament-type-card,
    .app-cards-square .home-card { border-radius: 0px; }

    .app-cards-rounded .card,
    .app-cards-rounded .ligue-match-card,
    .app-cards-rounded .tournament-type-card,
    .app-cards-rounded .home-card { border-radius: 0.75rem; }

    .app-cards-pill .card,
    .app-cards-pill .ligue-match-card,
    .app-cards-pill .tournament-type-card,
    .app-cards-pill .home-card { border-radius: 1.5rem; }
    /* Fin formes cartes */

    /* Début thèmes de fond */
    .app-bg-solid { background: var(--bg-dark); }
    .app-bg-gradient { background: radial-gradient(circle at 0 0, var(--brand-accent-soft), transparent 55%), radial-gradient(circle at 100% 100%, var(--brand-primary-glow), transparent 60%), linear-gradient(135deg, var(--bg-dark), var(--bg-dark) 40%, #001428); }
    .app-bg-pattern { background-color: var(--bg-dark); background-image: radial-gradient(circle at 1px, rgba(255,255,255,0.08) 1px, transparent 0); background-size: 16px 16px; }
    .app-bg-image { background-color: var(--bg-dark); }
    /* Fin thèmes de fond */

    /* Bandeau sponsor TV */
    .tv-sponsor { position: fixed; right: 12px; bottom: 12px; background: rgba(15,23,42,0.8); border: 1px solid rgba(255,255,255,0.08); border-radius: 14px; padding: 6px 10px; display: none; align-items: center; gap: 8px; box-shadow: 0 12px 30px rgba(0,0,0,0.45); cursor: grab; }
    .tv-sponsor img { width: 42px; height: 42px; object-fit: contain; background: rgba(255,255,255,0.08); border-radius: 10px; }
    .tv-sponsor .tv-sponsor-name { font-weight: 700; font-size: 0.8rem; }
    /* Fin bandeau sponsor TV */

    .theme-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 8px;
      margin-top: 6px;
    }

    .theme-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .theme-buttons { display: flex; gap: 8px; margin-left: auto; }

    .settings-shell { padding: 14px; }

    .settings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    .settings-section { margin-top: 12px; border: 1px solid var(--border); border-radius: 12px; padding: 10px; background: rgba(255,255,255,0.02); }
    .settings-subtitle { font-size: 0.9rem; font-weight: 700; margin-bottom: 6px; display: flex; align-items: center; gap: 6px; }
    .settings-inline { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 8px; align-items: end; }
    .settings-inline .field { margin-bottom: 0; }

    .settings-tabs { display: flex; gap: 8px; margin-bottom: 10px; flex-wrap: wrap; }
    .settings-tab {
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.02);
      color: var(--text);
      cursor: pointer;
      font-size: 0.85rem;
      transition: transform 0.15s ease-out, box-shadow 0.15s ease-out, background-color 0.15s ease-out;
    }
    .settings-tab.active {
      background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
      color: #fff;
      box-shadow: 0 12px 26px rgba(0,0,0,0.35);
      transform: translateY(-1px);
    }
    .settings-panels { position: relative; }
    .settings-panel { display: none; }
    .settings-panel.active { display: block; }

    .pong-card { position: relative; }
    .pong-draggable { position: relative; }
    .pong-draggable .drag-handle { cursor: move; display: inline-flex; align-items: center; gap: 6px; font-size: 0.85rem; color: var(--muted); }
    .pong-draggable .resize-handle {
      position: absolute;
      right: 4px;
      bottom: 4px;
      width: 14px;
      height: 14px;
      border-radius: 4px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.25);
      cursor: nwse-resize;
    }
    .pong-qr { width: 160px; height: 160px; background: rgba(255,255,255,0.05); border: 1px dashed rgba(255,255,255,0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; }
    .pong-description { color: var(--muted); font-size: 0.9rem; }

    .pong-tv-widget {
      position: absolute;
      right: 12px;
      top: 12px;
      min-width: 200px;
      background: rgba(10,18,34,0.92);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px;
      padding: 10px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.6);
      z-index: 20;
    }
    .pong-tv-widget .widget-head { display: flex; justify-content: space-between; align-items: center; gap: 8px; margin-bottom: 6px; cursor: move; }
    .pong-tv-widget .widget-title { font-weight: 700; font-size: 0.9rem; }
    .pong-tv-widget .widget-body { display: grid; grid-template-columns: 80px 1fr; gap: 8px; align-items: center; }
    .pong-tv-widget .widget-qr { width: 80px; height: 80px; background: rgba(255,255,255,0.06); border-radius: 10px; display: flex; align-items: center; justify-content: center; }
    .pong-tv-widget .widget-name { font-size: 0.8rem; color: var(--muted); }
    .pong-tv-widget .widget-close { background: transparent; color: var(--text); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; padding: 2px 6px; cursor: pointer; font-size: 0.75rem; }

    .app-bg-image::before {
      content: '';
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.35);
      pointer-events: none;
      z-index: -1;
    }

    .club-theme-card { margin-top: 12px; }

    /* Application aux blocs dynamiques d'admin dépourvus de classe dédiée */
    #admin-root .match-card,
    #ligue-manage-root .ligue-match-card,
    #ligue-root .ligue-list .card,
    #ligue-active-root .ligue-list .card {
      transition: transform 0.15s ease-out, box-shadow 0.15s ease-out, background-color 0.15s ease-out;
      cursor: pointer;
    }
    #admin-root .match-card:hover,
    #ligue-manage-root .ligue-match-card:hover,
    #ligue-root .ligue-list .card:hover,
    #ligue-active-root .ligue-list .card:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 12px 30px rgba(250, 204, 21, 0.15), 0 10px 25px rgba(0,0,0,0.45);
      background-color: rgba(250, 204, 21, 0.08);
    }

    /* LIGUE THEMES */
    .ligue-theme-shell {
      border: 1px solid var(--border);
      background: linear-gradient(145deg, #0b1220, #020617 45%, #000a18);
      border-radius: 14px;
    }

    .ligue-theme-n1 { border-color: #7f1d1d; box-shadow: 0 0 0 1px rgba(127,29,29,0.4); }
    .ligue-theme-n2 { border-color: #b45309; box-shadow: 0 0 0 1px rgba(180,83,9,0.4); }
    .ligue-theme-n3 { border-color: #ca8a04; box-shadow: 0 0 0 1px rgba(202,138,4,0.4); }

    .ligue-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.08);
      color: var(--text);
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .ligue-theme-n1 .ligue-chip { border-color: rgba(127,29,29,0.6); color: #fca5a5; }
    .ligue-theme-n2 .ligue-chip { border-color: rgba(180,83,9,0.6); color: #fbbf24; }
    .ligue-theme-n3 .ligue-chip { border-color: rgba(202,138,4,0.6); color: #fcd34d; }

    .ligue-section { margin-top: 12px; display: grid; gap: 10px; }
    .ligue-grid-2 { display: grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: 10px; }
    @media (max-width: 900px) { .ligue-grid-2 { grid-template-columns: minmax(0,1fr); } }

    .ligue-form-grid { display: grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: 10px; }
    @media (max-width: 800px) { .ligue-form-grid { grid-template-columns: minmax(0,1fr); } }

    .ligue-field textarea,
    .ligue-field input[type="number"],
    .ligue-field input[type="date"] {
      width: 100%;
      padding: 6px 10px;
      border-radius: 10px;
      border: 1px solid #1e293b;
      background: #020617;
      color: var(--text);
      font-size: 0.85rem;
      outline: none;
      resize: vertical;
      min-height: 70px;
    }

    .ligue-field input[type="number"],
    .ligue-field input[type="date"] {
      border-radius: 999px;
      min-height: auto;
    }

    .ligue-field textarea:focus,
    .ligue-field input[type="number"]:focus,
    .ligue-field input[type="date"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(var(--brand-accent-rgb), 0.5);
    }

    .ligue-field label { display: block; font-size: 0.78rem; text-transform: uppercase; letter-spacing: 0.14em; color: var(--blue-soft); margin-bottom: 4px; }
    .ligue-inline { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; }
    .ligue-badge { padding: 4px 8px; border-radius: 10px; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.08); font-size: 0.8rem; color: var(--muted); }

    .ligue-list { display: grid; gap: 8px; }
    .ligue-list .card { border: 1px solid #111827; }
    .ligue-match-row { display: grid; grid-template-columns: 140px 1fr 140px; gap: 8px; align-items: center; padding: 8px; border: 1px solid #111827; border-radius: 10px; background: rgba(255,255,255,0.02); }
    @media (max-width: 800px) { .ligue-match-row { grid-template-columns: 1fr; } }
    .ligue-match-row input { width: 100%; padding: 6px 10px; border-radius: 10px; border: 1px solid #1e293b; background: #020617; color: var(--text); }
    .ligue-match-row input:focus { border-color: var(--accent); box-shadow: 0 0 0 1px rgba(var(--brand-accent-rgb), 0.4); }
    .ligue-match-title { font-size: 0.85rem; color: var(--muted); }
    .ligue-standings { width: 100%; border-collapse: collapse; }
    .ligue-standings th, .ligue-standings td { padding: 6px 8px; border-bottom: 1px solid #111827; text-align: left; font-size: 0.85rem; }
    .ligue-standings th { color: var(--blue-soft); text-transform: uppercase; letter-spacing: 0.12em; font-size: 0.78rem; }
    .ligue-history-standings { margin-top: 8px; }
    .ligue-history-standings table { width: 100%; border-collapse: collapse; }
    .ligue-history-standings th, .ligue-history-standings td { padding: 6px 8px; border-bottom: 1px solid #111827; text-align: left; font-size: 0.85rem; }
    .ligue-history-standings th { color: var(--blue-soft); text-transform: uppercase; letter-spacing: 0.12em; font-size: 0.78rem; }
    .ligue-actions { display: flex; gap: 8px; flex-wrap: wrap; }

    .ligue-tabs { display: flex; gap: 8px; flex-wrap: wrap; margin: 12px 0; }
    .ligue-tab {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      border-radius: 12px;
      background: rgba(255,255,255,0.04);
      border: 1px solid #111827;
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 600;
    }
    .ligue-tab:hover { box-shadow: 0 0 0 1px rgba(229,231,235,0.08); transform: translateY(-1px); }
    .ligue-tab.active { color: #0b0b0b; background: #e6e6e6; }
    .ligue-theme-n1 .ligue-tab.active { background: linear-gradient(135deg, #7f1d1d, #b91c1c); color: #fff; }
    .ligue-theme-n2 .ligue-tab.active { background: linear-gradient(135deg, #b45309, #f97316); color: #fff; }
    .ligue-theme-n3 .ligue-tab.active { background: linear-gradient(135deg, #ca8a04, #fbbf24); color: #0f172a; }

    .ligue-panel { margin-top: 12px; }
    .ligue-panel.hidden { display: none; }
    .ligue-match-card { border: 1px solid #111827; border-radius: 12px; padding: 10px; background: rgba(255,255,255,0.02); }
    .ligue-match-validated { background: rgba(16,185,129,0.08); border-color: rgba(16,185,129,0.55); }
    .ligue-match-winner-card { background: rgba(16,185,129,0.12); border-color: rgba(16,185,129,0.55); }
    /* PATCH: alignement "vs" au centre (grille 3 colonnes) */
    .ligue-match-vs-grid { display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 10px; }
    .ligue-match-vs-grid .vs-center { text-align: center; color: var(--muted); }
    .ligue-match-vs-grid .team-left { text-align: left; }
    .ligue-match-vs-grid .team-right { text-align: right; }
    .ligue-badge { padding: 4px 8px; border-radius: 999px; font-size: 0.85rem; border: 1px solid rgba(255,255,255,0.12); }
    .ligue-badge-valid { background: rgba(16,185,129,0.15); color: #ecfdf3; border-color: rgba(16,185,129,0.45); }
    .winner-tag {
      background: linear-gradient(135deg, #b91c1c, #ef4444);
      color: #fff;
      padding: 4px 8px;
      border-radius: 12px;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .match-winner {
      background: #b91c1c;
      color: #ffffff;
      padding: 4px 8px;
      border-radius: 999px;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .ligue-result-row { gap: 10px; flex-wrap: wrap; }
    .ligue-result-team { padding: 8px 10px; border-radius: 12px; border: 1px solid #111827; background: rgba(255,255,255,0.03); font-weight: 600; }
    .ligue-result-score { font-weight: 800; letter-spacing: 0.08em; color: #e6e6e6; }
    .ligue-theme-n1 .ligue-result-winner { background: rgba(127,29,29,0.18); border-color: rgba(127,29,29,0.55); color: #fee2e2; }
    .ligue-theme-n2 .ligue-result-winner { background: rgba(180,83,9,0.18); border-color: rgba(180,83,9,0.55); color: #ffedd5; }
    .ligue-theme-n3 .ligue-result-winner { background: rgba(202,138,4,0.18); border-color: rgba(202,138,4,0.55); color: #fef9c3; }
    /* Export / impression des matchs (masquer les scores) */
    body.printing-matches * { visibility: hidden; }
    body.printing-matches #ligue-manage-calendar,
    body.printing-matches #ligue-manage-calendar * { visibility: visible; }
    body.printing-matches #ligue-manage-calendar { position: absolute; left: 0; top: 0; width: 100%; }
    body.printing-matches .ligue-score-area { display: none !important; }
    .ligue-export-hide-scores .ligue-score-area { display: none !important; }
    .ligue-badge-accent { padding: 4px 8px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.04); font-size: 0.8rem; }
    .ligue-theme-n1 .ligue-badge-accent { border-color: rgba(127,29,29,0.6); color: #fca5a5; }
    .ligue-theme-n2 .ligue-badge-accent { border-color: rgba(180,83,9,0.6); color: #fbbf24; }
    .ligue-theme-n3 .ligue-badge-accent { border-color: rgba(202,138,4,0.6); color: #fcd34d; }

    /* Historique ligues : bouton et disposition */
    .ligue-history-actions { display: flex; justify-content: flex-end; margin-top: 8px; }
    .ligue-history-btn { background: #fff; color: #0f172a; border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; font-weight: 600; }

    /* Nuances blocs ligue (config vs actif) */
    .ligue-block-config { background: linear-gradient(145deg, rgba(15,23,42,0.7), rgba(15,23,42,0.55)); }
    .ligue-block-active { background: linear-gradient(145deg, rgba(15,23,42,0.9), rgba(2,6,23,0.9)); }

    /* Modale social / aperçu */
    .social-modal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 99; }
    .social-modal.open { display: flex; }
    .social-modal-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(3px); }
    .social-modal-panel { position: relative; background: #0b1220; border: 1px solid #1e293b; border-radius: 14px; padding: 14px; width: min(900px, 92vw); box-shadow: 0 24px 60px rgba(0,0,0,0.5); z-index: 1; }
    .social-modal-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
    .social-modal-close { background: #111827; color: #e5e7eb; border: 1px solid #1f2937; border-radius: 8px; padding: 6px 10px; cursor: pointer; }
    .social-modal-body { max-height: 70vh; overflow: auto; border: 1px dashed rgba(255,255,255,0.08); border-radius: 10px; padding: 10px; background: rgba(255,255,255,0.02); }
    .social-modal-actions { display: flex; justify-content: flex-end; gap: 8px; margin-top: 12px; }
    .social-preview-img img { width: 100%; border-radius: 12px; box-shadow: 0 20px 40px rgba(0,0,0,0.4); }

    /* Social export visuels */
    .social-bg { width: 1080px; height: 1080px; padding: 40px; background: radial-gradient(circle at 20% 20%, rgba(153,183,215,0.18), transparent 35%), radial-gradient(circle at 80% 80%, rgba(var(--brand-secondary-rgb),0.25), transparent 40%), linear-gradient(145deg, #0b1220, #050914 55%, #01030a); display: flex; align-items: center; justify-content: center; }
    /* Nouveau : fond dédié pour l'export de journée (ligue interne) */
    .social-day-bg { background: radial-gradient(circle at 20% 20%, rgba(153,183,215,0.18), transparent 35%), radial-gradient(circle at 80% 80%, rgba(var(--brand-secondary-rgb),0.25), transparent 40%), linear-gradient(145deg, #0b1220, #050914 55%, #01030a); }
    .social-card { width: 980px; min-height: 980px; border-radius: 28px; padding: 28px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.08); box-shadow: 0 28px 70px rgba(0,0,0,0.55); color: #f9fafb; display: flex; flex-direction: column; gap: 16px; }
    .social-header { display: flex; flex-direction: column; align-items: center; gap: 6px; text-align: center; }
    .social-logo { width: 120px; height: 120px; border-radius: 24px; border: 2px solid rgba(255,255,255,0.18); object-fit: cover; background: rgba(0,0,0,0.35); }
    .social-title { font-size: 2.1rem; letter-spacing: 0.02em; }
    .social-level-band { width: 100%; padding: 10px 14px; border-radius: 14px; color: #0b1220; font-weight: 800; text-transform: uppercase; letter-spacing: 0.18em; text-align: center; box-shadow: inset 0 1px 0 rgba(255,255,255,0.1); }
    .social-podium { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 8px; }
    .social-podium-item { padding: 12px; border-radius: 16px; background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08); text-align: center; box-shadow: 0 16px 30px rgba(0,0,0,0.25); }
    .social-podium-item strong { display: block; font-size: 1.4rem; }
    .social-ranking { border-radius: 14px; border: 1px solid rgba(255,255,255,0.08); overflow: hidden; }
    .social-ranking table { width: 100%; border-collapse: collapse; }
    .social-ranking th, .social-ranking td { padding: 8px 10px; text-align: left; font-size: 0.9rem; }
    .social-ranking thead { background: rgba(255,255,255,0.05); }
    .social-ranking tbody tr:nth-child(odd) { background: rgba(255,255,255,0.02); }
    .social-day-list { display: flex; flex-direction: column; gap: 8px; }
    .social-day-match { padding: 10px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.03); display: flex; justify-content: space-between; align-items: center; }
    .social-match-winner { background: linear-gradient(135deg, rgba(34,197,94,0.18), rgba(34,197,94,0.32)); border: 1px solid rgba(34,197,94,0.45); }
    .social-footer { text-align: center; color: rgba(255,255,255,0.68); font-size: 0.95rem; margin-top: auto; }

    .field { margin-bottom: 8px; }

    .field label {
      display: block;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--blue-soft);
      margin-bottom: 3px;
    }

    input[type="text"], select {
      width: 100%;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #1e293b;
      background: #020617;
      color: var(--text);
      font-size: 0.85rem;
      outline: none;
    }

    input[type="text"]::placeholder { color: #4b5563; }

    input[type="text"]:focus, select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(var(--brand-accent-rgb), 0.5);
    }

    /* ADMIN M/D */
    .layout-matches {
      margin-top: 10px;
      display: grid;
      grid-template-columns: minmax(0,1.6fr) minmax(0,1.4fr);
      gap: 10px;
    }
    @media (max-width: 900px) {
      .layout-matches { grid-template-columns: minmax(0,1fr); }
    }

    .teams-edit {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      max-height: 180px;
      overflow-y: auto;
      padding: 4px 2px;
      background: #020617;
      border-radius: 10px;
      border: 1px solid #111827;
    }

    .team-chip {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 3px 6px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid #1f2937;
    }

    .team-chip span { font-size: 0.8rem; }

    .team-chip input {
      border: none;
      background: transparent;
      color: var(--text);
      font-size: 0.8rem;
      outline: none;
      min-width: 40px;
    }

    .match-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 8px;
    }
    @media (max-width: 700px) {
      .match-grid { grid-template-columns: minmax(0,1fr); }
    }

    .match-card {
      background: #020617;
      border-radius: 10px;
      border: 1px solid #1f2937;
      padding: 8px;
    }

    .match-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
      font-size: 0.8rem;
      color: var(--blue-soft);
    }

    .teams-row {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 4px;
    }

    .team-row {
      display: flex;
      align-items: center;
      justify-content:space-between;
      gap: 4px;
      padding: 4px 6px;
      border-radius: 8px;
      background: #020617;
      border: 1px solid #1f2937;
      font-size: 0.85rem;
    }

    .team-row.winner {
      border-color: var(--success);
      box-shadow: 0 0 10px rgba(34,197,94,0.5);
    }

    .team-name { flex: 1; }

    .status-line {
      font-size: 0.75rem;
      color: var(--muted);
      text-align: right;
    }

    .rest-list {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      min-height: 22px;
      margin-top: 4px;
    }

    .rest-pill {
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
      font-size: 0.8rem;
    }

    .ranking-list {
      margin-top: 6px;
      max-height: 260px;
      overflow-y: auto;
      border-radius: 10px;
      border: 1px solid #111827;
      background: #020617;
      padding: 4px 2px;
    }

    .ranking-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-bottom: 1px solid #0b1120;
      font-size: 0.8rem;
    }

    .ranking-pos {
      width: 1.6em;
      text-align: right;
      color: var(--blue-soft);
    }

    .ranking-name { flex: 1; margin: 0 4px; }

    .ranking-points {
      color: var(--accent);
      font-weight: 600;
    }

    .ranking-record {
      color: var(--muted);
      font-size: 0.75rem;
      margin-left: 4px;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-top: 8px;
      font-size: 0.8rem;
    }

    /* VUE TV */
    #tv-root,
    #americano-tv-root {
      position: relative;
      width: 100vw;
      min-height: 100vh;
      padding: 16px;
    }
    .tv-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
      padding: 8px 12px;
      border-radius: 16px;
      border: 1px solid rgba(148,163,184,0.4);
      background: linear-gradient(90deg,
                rgba(var(--brand-primary-rgb), 0.95) 0%,
                rgba(var(--brand-primary-rgb), 0.80) 55%,
                rgba(var(--brand-accent-rgb), 0.85) 100%);
      box-shadow: 0 18px 40px rgba(0,0,0,0.9);
    }

    .tv-header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #tv-logo {
      height: 46px;
      width: 46px;
      border-radius: 999px;
      border: 2px solid rgba(15,23,42,0.7);
      background: #020617;
      padding: 4px;
      object-fit: contain;
      display: none;
    }

    .tv-title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    #tv-tournoi-name {
      font-size: 1.1rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #0b1120;
    }

    #tv-roulement-info {
      font-size: 0.85rem;
      color: #111827;
    }

    .tv-header-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .tv-tag-live {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      background: #b91c1c;
      color: #fee2e2;
      box-shadow: 0 0 12px rgba(248,113,113,0.7);
    }

    .tv-main {
      display: grid;
      grid-template-columns: minmax(0,1.4fr) minmax(0,1.3fr);
      gap: 12px;
      min-height: 420px;
    }
    @media (max-width: 900px) {
      .tv-main { grid-template-columns: minmax(0,1fr); }
    }

    .tv-column {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .tv-block {
      border-radius: 16px;
      padding: 10px;
      border: 1px solid rgba(15,23,42,0.8);
      background: radial-gradient(circle at 0 0, rgba(148,163,184,0.2), transparent 55%),
                  #020617;
      box-shadow: 0 20px 45px rgba(0,0,0,0.9);
    }

    .tv-block-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--blue-soft);
    }

    .tv-block-title span:last-child {
      font-size: 0.8rem;
      color: var(--muted);
    }

    .tv-current-list,.tv-next-list {
      display: grid;
      grid-template-columns: minmax(0,1fr);
      gap: 6px;
    }

    .tv-match-card {
      border-radius: 12px;
      padding: 8px 10px;
      background: linear-gradient(120deg,
              rgba(var(--brand-primary-rgb), 0.95) 0%,
              rgba(var(--brand-secondary-rgb), 0.9) 55%,
              rgba(var(--brand-accent-rgb), 0.8) 100%);
      color: #020617;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .tv-match-card-next {
      background: linear-gradient(135deg,
              rgba(15,23,42,0.95) 0%,
              rgba(30,64,175,0.95) 45%,
              rgba(56,189,248,0.85) 100%);
      color: #e5f2ff;
    }

    .tv-match-top {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      opacity: 0.95;
    }

    .tv-match-teams {
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-size: 0.95rem;
      font-weight: 600;
    }

    .tv-match-team-line {
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }

    .tv-match-team-name {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tv-match-tag {
      font-size: 0.75rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(15,23,42,0.6);
      color: #e5e7eb;
    }

    .tv-ranking-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 4px;
      margin-top: 6px;
    }
    .tv-podium {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 6px;
    }
    .tv-podium-row {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 8px;
      border-radius: 10px;
      background: linear-gradient(120deg, rgba(15,23,42,0.9), rgba(15,23,42,0.95));
      border: 1px solid rgba(51,65,85,0.9);
      font-size: 0.9rem;
    }
    .tv-podium-emoji { font-size: 20px; }
    .tv-podium-name {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .tv-podium-premium .tv-podium-row {
      background: linear-gradient(120deg, rgba(255,255,255,0.12), rgba(255,255,255,0.05));
      border-color: rgba(255,255,255,0.2);
      color: #0f172a;
    }
    .tv-podium-premium .tv-podium-emoji { font-size:22px; }
    .tv-podium-premium .tv-podium-name { font-weight:700; color:#0f172a; }
    @media (max-width: 700px) {
      .tv-ranking-grid { grid-template-columns: minmax(0,1fr); }
    }

    .tv-ranking-item {
      border-radius: 10px;
      padding: 4px 8px;
      background: linear-gradient(120deg,
                rgba(15,23,42,0.9),
                rgba(15,23,42,0.95));
      border: 1px solid rgba(51,65,85,0.9);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      font-size: 0.8rem;
    }

    .tv-ranking-pos {
      font-weight: 600;
      color: var(--blue-soft);
      width: 1.8em;
    }

    .tv-ranking-name {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tv-ranking-points {
      font-weight: 600;
      color: var(--accent);
    }

    .tv-ranking-record {
      font-size: 0.7rem;
      color: var(--muted);
      margin-left: 4px;
    }

    .tv-podium {
      display: flex;
      gap: 6px;
      margin-bottom: 6px;
    }

    .tv-podium-item {
      flex: 1;
      border-radius: 12px;
      padding: 6px 8px;
      background: linear-gradient(135deg,
              rgba(var(--brand-accent-rgb), 0.95),
              rgba(129,140,248,0.9));
      color: #111827;
      text-align: center;
      box-shadow: 0 14px 30px rgba(0,0,0,0.9);
      font-size: 0.8rem;
    }

    .tv-podium-item:nth-child(2) { transform: translateY(-4px); }

    .tv-podium-rank {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      opacity: 0.9;
    }

    .tv-podium-name {
      font-size: 0.9rem;
      font-weight: 700;
      margin-top: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tv-podium-points {
      font-size: 0.8rem;
      margin-top: 2px;
    }

    .tv-empty {
      font-size: 0.85rem;
      color: var(--muted);
      padding: 6px 2px;
    }

    .tv-small-note {
      font-size: 0.7rem;
      color: var(--muted);
      margin-top: 4px;
    }

    /* PAGE TOURNOIS CLASSIQUES */
    .tournaments-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:10px;
      gap:8px;
    }

    .tournaments-grid {
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:10px;
    }
    @media(max-width:800px){
      .tournaments-grid{ grid-template-columns:minmax(0,1fr); }
    }

    .tournament-type-card{
      border-radius:14px;
      padding:10px;
      border:1px solid rgba(15,23,42,0.8);
      background: radial-gradient(circle at 0 0, rgba(148,163,184,0.18), transparent 55%),
                  linear-gradient(135deg,#020617,#020c1f);
      box-shadow:0 16px 40px rgba(0,0,0,0.85);
      display:flex;
      flex-direction:column;
      gap:6px;
      font-size:0.85rem;
    }

    .tournament-type-title{
      font-size:0.9rem;
      text-transform:uppercase;
      letter-spacing:0.14em;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
    }

    .tournament-type-pill{
      font-size:0.7rem;
      padding:2px 8px;
      border-radius:999px;
      border:1px solid #1f2937;
      background:#020617;
      color:var(--blue-soft);
    }

    /* AMERICANO */
    .americano-tabs { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px; }
    .americano-tab-btn { border:1px solid #1f2937; background: rgba(15,23,42,0.7); color: var(--text); border-radius:999px; padding:8px 14px; cursor:pointer; font-weight:600; transition: all 0.15s ease; }
    .americano-tab-btn:hover { border-color: var(--brand-accent); box-shadow: 0 4px 12px rgba(0,0,0,0.25); }
    .americano-tab-btn.active { background: linear-gradient(120deg, var(--brand-accent), #a3e635); color: #0f172a; border-color: #d9f99d; }
    .americano-tab-panel { display:none; }
    .americano-tab-panel.active { display:block; }
    .americano-card { border: 1px solid #1f2937; border-radius: 14px; background: rgba(2,6,23,0.4); padding: 10px; min-width:0; box-shadow:0 12px 28px rgba(0,0,0,0.4); }
    .americano-card-header { display: flex; align-items: flex-start; justify-content: space-between; gap: 8px; }
    .americano-card-body { display: flex; flex-direction: column; gap: 8px; margin-top: 6px; }
    .americano-card-body.americano-collapsed { display: none; }
    .americano-inline { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; justify-content: space-between; }
    .americano-section { margin-top: 10px; }
    .americano-rounds { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 10px; }
    .americano-rounds-nav { display: flex; align-items: center; justify-content: space-between; gap: 10px; flex-wrap: wrap; }
    .americano-round-card { border: 1px solid #1f2937; padding: 10px; border-radius: 14px; background: rgba(2,6,23,0.4); min-width:0; }
    .americano-match-row { display: grid; grid-template-columns: minmax(0,1fr) 50px minmax(0,1fr); align-items: center; gap: 6px; padding: 2px 0; }
    .americano-score-inputs { display: flex; gap: 6px; align-items: center; }
    .americano-chip { display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 999px; border: 1px solid #1e293b; background: rgba(255,255,255,0.04); color: var(--text); font-size: 0.8rem; }
    .americano-team { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; min-width: 0; }
    .americano-team.left { text-align: left; }
    .americano-team.right { text-align: right; }
    .americano-vs { text-align: center; color: var(--muted); font-weight: 700; }
    .americano-score-row { grid-column: 1 / span 3; display: flex; align-items: center; justify-content: space-between; gap: 8px; flex-wrap: wrap; }
    .collapse-toggle.americano-collapse { margin-left: 8px; }
    /* UI : style bouton réduire (– jaune, sans fond) */
    .americano-collapse-btn { background: transparent !important; border: none !important; padding: 0 !important; line-height: 1; color: var(--brand-accent); font-weight: 800; font-size: 22px; cursor: pointer; }
    .americano-collapse-btn:hover { opacity: 0.85; }
    .americano-teams-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 8px; }
    .americano-team-row { display: grid; grid-template-columns: 1fr; gap: 8px; align-items: center; min-width:0; }
    .americano-team-cell { min-width:0; display:flex; flex-direction:column; gap:4px; }
    .americano-team-cell label { font-size:0.85rem; color: var(--muted); }
    .americano-team-row input { width:100%; min-width:0; }
    /* UI : Podium actuel (top 3) à côté du classement */
    .americano-podium { display: flex; flex-direction: column; gap: 6px; }
    .americano-podium-row { display: flex; align-items: center; gap: 8px; padding: 6px 8px; border: 1px solid rgba(30,41,59,0.8); border-radius: 10px; background: rgba(15,23,42,0.35); }
    .americano-podium-emoji { font-size: 20px; }
    .americano-podium-name { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .americano-podium-ga { color: var(--muted); font-size: 0.85rem; }

    /* ======================================
       STYLES PARAMÈTRES - NOUVELLE INTERFACE
       ====================================== */

    /* Container principal des paramètres */
    .settings-shell {
      display: flex;
      flex-direction: column;
      gap: 0;
      background: var(--card);
      border-radius: 16px;
      border: 1px solid var(--border);
      overflow: hidden;
    }

    /* En-tête principal */
    .settings-main-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.02);
    }

    .settings-breadcrumb {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--muted);
      font-size: 0.9rem;
      margin-bottom: 8px;
    }

    .settings-main-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--brand-title);
      margin: 0;
    }

    .home-btn-settings {
      background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
      border: none;
      color: white;
      padding: 10px 18px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s ease;
      box-shadow: 0 4px 12px rgba(0, 75, 155, 0.3);
    }

    .home-btn-settings:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 75, 155, 0.5);
    }

    /* Navigation par onglets */
    .settings-tabs-nav {
      display: flex;
      gap: 0;
      background: rgba(0, 0, 0, 0.2);
      border-bottom: 2px solid var(--border);
      padding: 0;
      overflow-x: auto;
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(10px);
    }

    .settings-tab {
      flex: 1;
      min-width: fit-content;
      padding: 14px 20px;
      background: transparent;
      border: none;
      border-bottom: 3px solid transparent;
      color: var(--muted);
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      white-space: nowrap;
    }

    .settings-tab:hover {
      background: rgba(255, 255, 255, 0.05);
      color: var(--text);
    }

    .settings-tab.active {
      background: rgba(229, 227, 57, 0.1);
      border-bottom-color: var(--brand-accent);
      color: var(--brand-accent);
    }

    /* Panneaux */
    .settings-panels {
      padding: 24px;
    }

    .settings-panel {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .settings-panel.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Sections de paramètres */
    .settings-section {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      transition: all 0.2s ease;
    }

    .settings-section:hover {
      background: rgba(255, 255, 255, 0.04);
      border-color: rgba(229, 227, 57, 0.3);
    }

    .settings-section:last-child {
      margin-bottom: 0;
    }

    .settings-section-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text);
      margin: 0 0 16px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Grilles de champs */
    .settings-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }

    .settings-grid-2 {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
    }

    .settings-grid-3 {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }

    /* Champs de formulaire */
    .field {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .field-label {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .field-label .required {
      color: var(--danger);
      font-size: 0.85rem;
    }

    .field-input,
    .field-select,
    .field-textarea {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px 14px;
      color: var(--text);
      font-size: 0.95rem;
      transition: all 0.2s ease;
      font-family: var(--app-font-family);
    }

    .field-input:focus,
    .field-select:focus,
    .field-textarea:focus {
      outline: none;
      border-color: var(--brand-accent);
      box-shadow: 0 0 0 3px rgba(229, 227, 57, 0.1);
    }

    .field-input::placeholder,
    .field-textarea::placeholder {
      color: var(--muted);
      opacity: 0.6;
    }

    .field-textarea {
      resize: vertical;
      min-height: 80px;
    }

    .field-color {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .field-color input[type="color"] {
      width: 50px;
      height: 40px;
      border: 1px solid var(--border);
      border-radius: 8px;
      cursor: pointer;
      background: transparent;
    }

    .field-color-value {
      flex: 1;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px 14px;
      color: var(--text);
      font-size: 0.9rem;
      font-family: monospace;
    }

    .field-range {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .field-range-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .field-range-value {
      background: rgba(229, 227, 57, 0.15);
      color: var(--brand-accent);
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 700;
      font-family: monospace;
    }

    .field-range input[type="range"] {
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: rgba(255, 255, 255, 0.1);
      outline: none;
      -webkit-appearance: none;
    }

    .field-range input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--brand-accent);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .field-range input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.2);
      box-shadow: 0 0 0 6px rgba(229, 227, 57, 0.2);
    }

    .field-range input[type="range"]::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--brand-accent);
      cursor: pointer;
      border: none;
      transition: all 0.2s ease;
    }

    .field-range input[type="range"]::-moz-range-thumb:hover {
      transform: scale(1.2);
      box-shadow: 0 0 0 6px rgba(229, 227, 57, 0.2);
    }

    /* Checkbox personnalisé */
    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      font-size: 0.95rem;
      color: var(--text);
      padding: 10px;
      border-radius: 8px;
      transition: background 0.2s ease;
    }

    .checkbox-label:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .checkbox-label input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
      accent-color: var(--brand-accent);
    }

    /* Upload de fichier avec preview */
    .field-file-upload {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .file-upload-area {
      border: 2px dashed var(--border);
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
      background: rgba(255, 255, 255, 0.02);
    }

    .file-upload-area:hover {
      border-color: var(--brand-accent);
      background: rgba(229, 227, 57, 0.05);
    }

    .file-upload-icon {
      font-size: 2rem;
      margin-bottom: 8px;
    }

    .file-upload-text {
      color: var(--muted);
      font-size: 0.9rem;
    }

    .file-preview {
      max-width: 200px;
      max-height: 200px;
      border-radius: 8px;
      border: 1px solid var(--border);
      object-fit: contain;
    }

    /* Templates d'export */
    .export-templates-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 16px;
    }

    .export-template-card {
      border: 2px solid var(--border);
      border-radius: 10px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      background: rgba(255, 255, 255, 0.02);
      text-align: center;
    }

    .export-template-card:hover {
      border-color: var(--brand-accent);
      background: rgba(229, 227, 57, 0.05);
      transform: translateY(-2px);
    }

    .export-template-card.selected {
      border-color: var(--brand-accent);
      background: rgba(229, 227, 57, 0.1);
      box-shadow: 0 0 0 4px rgba(229, 227, 57, 0.2);
    }

    .template-preview {
      width: 100%;
      height: 120px;
      background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
      border-radius: 8px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
    }

    .template-name {
      font-weight: 600;
      color: var(--text);
      font-size: 0.9rem;
    }

    /* Bibliothèque de thèmes */
    .themes-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 16px;
    }

    .theme-card {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      background: rgba(255, 255, 255, 0.02);
      transition: all 0.2s ease;
      cursor: pointer;
    }

    .theme-card:hover {
      border-color: var(--brand-accent);
      background: rgba(229, 227, 57, 0.05);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }

    .theme-card-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }

    .theme-card-icon {
      font-size: 1.5rem;
    }

    .theme-card-name {
      flex: 1;
      font-weight: 700;
      color: var(--text);
      font-size: 1rem;
    }

    .theme-palette {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin-bottom: 12px;
    }

    .theme-color-swatch {
      height: 36px;
      border-radius: 6px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .theme-apply-btn {
      width: 100%;
      background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
      border: none;
      color: white;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      transition: all 0.2s ease;
    }

    .theme-apply-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 75, 155, 0.4);
    }

    /* Éditeur de thème personnalisé */
    .theme-editor-group {
      border: 1px solid var(--border);
      border-radius: 10px;
      margin-bottom: 12px;
      overflow: hidden;
      background: rgba(255, 255, 255, 0.02);
    }

    .theme-editor-summary {
      padding: 14px 18px;
      cursor: pointer;
      font-weight: 700;
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: background 0.2s ease;
      list-style: none;
    }

    .theme-editor-summary::-webkit-details-marker {
      display: none;
    }

    .theme-editor-summary:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .theme-editor-summary::after {
      content: '▼';
      font-size: 0.8rem;
      color: var(--muted);
      transition: transform 0.2s ease;
    }

    .theme-editor-group[open] .theme-editor-summary::after {
      transform: rotate(-180deg);
    }

    .theme-editor-content {
      padding: 16px 18px;
      border-top: 1px solid var(--border);
    }

    /* Preview du thème */
    .theme-preview-container {
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      background: rgba(0, 0, 0, 0.3);
    }

    .theme-preview-header {
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.05);
      border-bottom: 1px solid var(--border);
      font-weight: 600;
      color: var(--muted);
      font-size: 0.85rem;
    }

    .theme-preview-iframe {
      width: 100%;
      height: 400px;
      border: none;
      display: block;
    }

    /* Gestion des thèmes personnalisés */
    .custom-themes-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .custom-theme-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--border);
      border-radius: 8px;
      transition: all 0.2s ease;
    }

    .custom-theme-item:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .custom-theme-name {
      flex: 1;
      font-weight: 600;
      color: var(--text);
    }

    .custom-theme-actions {
      display: flex;
      gap: 6px;
    }

    .custom-theme-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: all 0.2s ease;
    }

    .custom-theme-btn:hover {
      background: rgba(255, 255, 255, 0.15);
      border-color: var(--brand-accent);
    }

    /* État vide */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--muted);
    }

    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 12px;
      opacity: 0.5;
    }

    .empty-state-text {
      font-size: 0.95rem;
    }

    /* Actions des paramètres */
    .settings-actions {
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: flex-end;
      padding-top: 16px;
      border-top: 1px solid var(--border);
      margin-top: 20px;
    }

    .settings-btn {
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.2s ease;
      border: none;
    }

    .settings-btn-primary {
      background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
      color: white;
      box-shadow: 0 4px 12px rgba(0, 75, 155, 0.3);
    }

    .settings-btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 75, 155, 0.5);
    }

    .settings-btn-secondary {
      background: rgba(255, 255, 255, 0.05);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .settings-btn-secondary:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .settings-btn-danger {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
      border: 1px solid var(--danger);
    }

    .settings-btn-danger:hover {
      background: rgba(239, 68, 68, 0.2);
    }

    /* Indicateur de modifications non sauvegardées */
    .unsaved-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      background: var(--danger);
      border-radius: 50%;
      margin-left: 6px;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.5;
      }
    }

    /* Liste des sponsors */
    .sponsors-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .sponsor-item {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 16px;
      background: rgba(255, 255, 255, 0.02);
      transition: all 0.2s ease;
      cursor: grab;
    }

    .sponsor-item:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(229, 227, 57, 0.3);
    }

    .sponsor-item.dragging {
      opacity: 0.5;
      cursor: grabbing;
    }

    .sponsor-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .sponsor-logo {
      width: 50px;
      height: 50px;
      border-radius: 8px;
      object-fit: contain;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid var(--border);
    }

    .sponsor-info {
      flex: 1;
    }

    .sponsor-name {
      font-weight: 700;
      color: var(--text);
      margin-bottom: 4px;
    }

    .sponsor-category {
      font-size: 0.85rem;
      color: var(--muted);
    }

    .sponsor-zones {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
    }

    .sponsor-zone-tag {
      background: rgba(229, 227, 57, 0.15);
      color: var(--brand-accent);
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .sponsor-controls {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .sponsor-priority {
      display: flex;
      gap: 4px;
    }

    .priority-star {
      color: var(--muted);
      font-size: 1rem;
    }

    .priority-star.filled {
      color: var(--brand-accent);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .settings-tabs-nav {
        flex-wrap: nowrap;
        overflow-x: auto;
      }

      .settings-tab {
        font-size: 0.85rem;
        padding: 12px 16px;
      }

      .settings-panels {
        padding: 16px;
      }

      .settings-grid-2,
      .settings-grid-3 {
        grid-template-columns: 1fr;
      }

      .export-templates-grid,
      .themes-grid {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      }
    }

    /* ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
       📺 VUE TV - STYLES
       ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */

    /* Sub-tabs pour modes */
    .tvview-mode-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      flex-wrap: wrap;
      padding: 12px;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 12px;
      border: 1px solid var(--border);
    }

    .tvview-mode-tab {
      flex: 1;
      min-width: 140px;
      padding: 10px 16px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text);
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .tvview-mode-tab:hover {
      background: rgba(255, 255, 255, 0.06);
      transform: translateY(-1px);
    }

    .tvview-mode-tab.active {
      background: linear-gradient(135deg, var(--brand-accent), var(--brand-title));
      color: #0f172a;
      border-color: var(--brand-accent);
    }

    .tvview-mode-panel {
      display: none;
    }

    .tvview-mode-panel.active {
      display: block;
    }

    /* Blocs list */
    .tvview-blocks-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .tvview-block-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--border);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .tvview-block-item:hover {
      background: rgba(255, 255, 255, 0.04);
      border-color: rgba(var(--brand-accent-rgb), 0.3);
    }

    .tvview-block-item input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }

    .block-label {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 1;
    }

    .block-icon {
      font-size: 1.2rem;
    }

    .block-name {
      font-weight: 500;
      color: var(--text);
    }

    /* Rotation settings */
    .tvview-rotation-settings {
      margin-top: 12px;
      padding: 12px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
    }

    .subsection-title {
      font-size: 0.95rem;
      font-weight: 700;
      color: var(--brand-accent);
      margin: 16px 0 12px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .tvview-duration-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }

    .duration-item {
      padding: 10px;
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--border);
      border-radius: 8px;
    }

    .slider-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 6px;
    }

    .duration-slider {
      flex: 1;
      -webkit-appearance: none;
      appearance: none;
      height: 6px;
      border-radius: 3px;
      background: rgba(255, 255, 255, 0.1);
      outline: none;
    }

    .duration-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--brand-accent);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .duration-slider::-webkit-slider-thumb:hover {
      transform: scale(1.2);
      box-shadow: 0 0 8px rgba(var(--brand-accent-rgb), 0.6);
    }

    .duration-slider::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--brand-accent);
      cursor: pointer;
      border: none;
    }

    .duration-value {
      min-width: 40px;
      text-align: right;
      font-weight: 600;
      color: var(--brand-accent);
      font-size: 0.9rem;
    }

    /* Rotation order (drag & drop) */
    .tvview-rotation-order {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 16px;
    }

    .rotation-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--border);
      border-radius: 10px;
      cursor: move;
      transition: all 0.2s ease;
    }

    .rotation-item:hover {
      background: rgba(255, 255, 255, 0.06);
      border-color: var(--brand-accent);
      transform: translateX(4px);
    }

    .rotation-item.dragging {
      opacity: 0.5;
      transform: scale(1.02);
    }

    .drag-handle {
      color: var(--muted);
      font-size: 1.2rem;
      line-height: 1;
    }

    .rotation-number {
      font-weight: 700;
      color: var(--brand-accent);
      min-width: 24px;
    }

    .rotation-icon {
      font-size: 1.1rem;
    }

    .rotation-name {
      flex: 1;
      font-weight: 500;
    }

    /* Layout options */
    .tvview-layout-options {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 12px;
      margin: 12px 0;
    }

    .layout-option {
      cursor: pointer;
    }

    .layout-option input[type="radio"] {
      display: none;
    }

    .layout-card {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.02);
      border: 2px solid var(--border);
      border-radius: 12px;
      transition: all 0.2s ease;
    }

    .layout-option:hover .layout-card {
      background: rgba(255, 255, 255, 0.04);
      border-color: rgba(var(--brand-accent-rgb), 0.5);
    }

    .layout-option input[type="radio"]:checked + .layout-card {
      background: rgba(var(--brand-accent-rgb), 0.1);
      border-color: var(--brand-accent);
      box-shadow: 0 0 12px rgba(var(--brand-accent-rgb), 0.3);
    }

    .layout-preview {
      width: 100%;
      height: 80px;
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      padding: 4px;
    }

    .preview-block {
      background: rgba(var(--brand-accent-rgb), 0.3);
      border: 1px solid rgba(var(--brand-accent-rgb), 0.6);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 700;
      color: var(--text);
    }

    .fullscreen-preview .preview-block {
      width: 100%;
      height: 100%;
    }

    .split-v-preview {
      flex-direction: row;
    }

    .split-v-preview .preview-block {
      flex: 1;
      height: 100%;
    }

    .split-h-preview {
      flex-direction: column;
    }

    .split-h-preview .preview-block {
      width: 100%;
      flex: 1;
    }

    .grid-preview {
      flex-wrap: wrap;
    }

    .grid-preview .preview-block {
      width: calc(50% - 2px);
      height: calc(50% - 2px);
    }

    .pip-preview {
      position: relative;
    }

    .pip-preview .preview-block.main {
      width: 100%;
      height: 100%;
    }

    .pip-preview .preview-block.mini {
      position: absolute;
      bottom: 8px;
      right: 8px;
      width: 30%;
      height: 30%;
      background: rgba(var(--brand-primary-rgb), 0.4);
      border-color: rgba(var(--brand-primary-rgb), 0.8);
    }

    .layout-name {
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--text);
    }

    .layout-desc {
      font-size: 0.75rem;
      color: var(--muted);
    }

    .tvview-layout-extras {
      margin-top: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    /* Config actions */
    .tvview-config-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin: 12px 0;
    }

    .tvview-saved-configs {
      border: 1px dashed var(--border);
      border-radius: 10px;
      padding: 12px;
      margin: 12px 0;
      min-height: 100px;
    }

    .tvview-apply-modes {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 10px;
      border: 1px solid var(--border);
    }

    .tvview-import-export {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .tvview-permanent-note {
      margin-top: 12px;
      padding: 10px;
      background: rgba(var(--brand-accent-rgb), 0.05);
      border-left: 3px solid var(--brand-accent);
      border-radius: 6px;
    }

    /* Settings grid 3 columns */
    .settings-grid-3 {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }

    @media (max-width: 900px) {
      .settings-grid-3 {
        grid-template-columns: 1fr;
      }

      .tvview-mode-tab {
        min-width: 100%;
      }

      .tvview-layout-options {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      }
    }
  </style>

  <!-- Styles du moteur tournoi classique -->
<style>:root{
      --blue-strong: #004b9b;
      --blue-mid: #4d81b9;
      --blue-soft: #99b7d7;
      --blue-bg: #e6edf5;
      --accent: #e5e339;
      --bg-dark: #020617;
      --card: #0b1220;
      --border: #1e293b;
      --text: #f9fafb;
      --muted: #9ca3af;
      --success: #22c55e;
      --danger: #ef4444;
      --hover-glow: rgba(var(--brand-accent-rgb), 0.18);
    }#classic-root *{ box-sizing: border-box; margin: 0; padding: 0; }#classic-root{
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at 0 0, rgba(var(--brand-accent-rgb), 0.25), transparent 55%),
                  radial-gradient(circle at 100% 100%, rgba(var(--brand-primary-rgb), 0.55), transparent 60%),
                  linear-gradient(135deg, #020617, #020617 40%, #001428);
      color: var(--text);
      min-height: 100vh;
      padding: 24px;
    }#classic-root .app{
      max-width: 1500px;
      margin: 0 auto;
      background: radial-gradient(circle at 0 0, rgba(148,163,184,0.25), transparent 55%),
                  #020617;
      border-radius: 24px;
      border: 2px solid #1f2937;
      box-shadow: 0 32px 80px rgba(0,0,0,0.9);
      padding: 24px;
    }#classic-root .app-header{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }#classic-root .app-header-main{
      display:flex;
      align-items:center;
      gap:12px;
    }#home-root .logo-wrapper,
    #classic-root .logo-wrapper,
    #settings-root .logo-wrapper{
      width: 72px;
      height: 72px;
      border-radius: 16px;
      border: 1px solid rgba(148,163,184,0.5);
      background:#020617;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:0 8px 24px rgba(0,0,0,0.8);
      position:relative;
      cursor:pointer;
    }#home-root .logo-wrapper::after,
    #classic-root .logo-wrapper::after,
    #settings-root .logo-wrapper::after{
      content:"Choisir un fichier";
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background:rgba(0,0,0,0.6);
      color:#ffffff;
      font-size:11px;
      letter-spacing:0.14em;
      text-transform:uppercase;
      opacity:0;
      transition:opacity 0.15s ease-in-out;
    }#home-root .logo-wrapper:hover::after,
    #classic-root .logo-wrapper:hover::after,
    #settings-root .logo-wrapper:hover::after{
      opacity:1;
    }#home-root .logo-wrapper input[type="file"],
    #classic-root .logo-wrapper input[type="file"],
    #settings-root .logo-wrapper input[type="file"]{
      position:absolute;
      inset:0;
      opacity:0;
      cursor:pointer;
    }#home-root .logo-wrapper img,
    #classic-root .logo-wrapper img,
    #settings-root .logo-wrapper img{
      max-width:100%;
      max-height:100%;
      object-fit:contain;
    }

    /* Nouveau : wrapper logo affichage simple (sans upload) */
    .logo-wrapper.is-display { cursor: default; }
    .logo-wrapper.is-display::after { display: none; }
    }#classic-root .app-header-text{
      display:flex;
      flex-direction:column;
      gap:4px;
    }#classic-root h1{
      font-size: 26px;
      text-transform: uppercase;
      letter-spacing: 0.3em;
      font-weight:700;
      color:#ffffff;
    }#classic-root .subtitle{
      font-size: 14px;
      color: var(--muted);
    }#classic-root .header-right{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:6px;
    }#classic-root .header-actions{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }#classic-root .header-tournament-name{
      font-size:14px;
      font-weight:700;
      text-transform:uppercase;
      letter-spacing:0.18em;
      color:var(--accent);
    }#classic-root .btn{
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 20px;
      border-radius: 999px;
      border: none;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      cursor: pointer;
      background: radial-gradient(circle at 0 0, #fffdea, var(--accent));
      color: #111827;
      box-shadow: 0 16px 40px rgba(0,0,0,0.9);
      font-weight:600;
    }#classic-root .btn-secondary{
      background: #020617;
      color: var(--blue-soft);
      border: 1px solid #1e293b;
      box-shadow: none;
    }#classic-root .btn-small{
      padding: 6px 12px;
      font-size: 12px;
    }#classic-root .btn-ghost{
      background: transparent;
      border: 1px solid rgba(148,163,184,0.5);
      color: var(--blue-soft);
      box-shadow: none;
    }#classic-root .btn:disabled{
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
    }#classic-root .small-muted{
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
    }#classic-root .empty{
      font-size: 13px;
      color: var(--muted);
      padding: 6px 4px;
    }#classic-root input[type="file"]{
      font-size:11px;
      color:var(--muted);
      max-width:230px;
    }#classic-root /* Tabs */
    .tabs{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-bottom:14px;
      margin-top:8px;
    }#classic-root .history-standalone{
      margin-top:18px;
    }#classic-root .history-standalone .card{
      background: linear-gradient(135deg, #04060f, #0a1b2e);
      border:1px solid #0b1220;
      color:#f8fafc;
    }#classic-root .history-standalone .card-header-title h2, #classic-root .history-standalone .card-header-title p, #classic-root .history-standalone .card-body, #classic-root .history-standalone .small-muted{
      color:#f8fafc;
    }#classic-root .history-standalone #btn-save-history{
      background:#ffffff;
      color:#0b1220;
      padding:6px 12px;
      font-size:12px;
    }#classic-root .tab-btn{
      padding:8px 14px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.4);
      background:#020617;
      color:var(--blue-soft);
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:0.16em;
      cursor:pointer;
      font-weight:600;
      transition:all 0.2s ease;
    }#classic-root .tab-btn.active{
      background: linear-gradient(135deg, var(--blue-strong), var(--blue-mid));
      color:#f9fafb;
      border-color:transparent;
      box-shadow:0 12px 30px rgba(0,0,0,0.8);
    }#classic-root .tab-btn.disabled{
      opacity:0.4;
      cursor:not-allowed;
    }#classic-root .tab-panel{ display:none; }#classic-root .tab-panel.active{ display:block; }#classic-root /* Cards + hover */
    .card, #classic-root .pool-card, #classic-root .bracket-card, #classic-root .tv-block, #classic-root .final-ranking-row, #classic-root .tv-match-card{
      transition: all 0.18s ease;
    }#classic-root .card, #classic-root .pool-card, #classic-root .bracket-card{
      background: linear-gradient(145deg, #020617, #020617 40%, #020c1f);
      border-radius: 18px;
      border: 1px solid var(--border);
      padding: 16px;
      margin-bottom:14px;
    }#classic-root .card:hover, #classic-root .pool-card:hover, #classic-root .bracket-card:hover, #classic-root .tv-block:hover, #classic-root .tv-match-card:hover, #classic-root .final-ranking-row:hover{
      box-shadow:0 0 0 1px rgba(var(--brand-accent-rgb), 0.5), 0 18px 40px rgba(0,0,0,0.9);
      background-image: radial-gradient(circle at 0 0, var(--hover-glow), transparent 55%),
                        linear-gradient(145deg, #020617, #020617 40%, #020c1f);
    }#classic-root .card-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom:8px;
    }#classic-root .card-header-title{
      display:flex;
      flex-direction:column;
      gap:2px;
    }#classic-root .card-header-title h2{
      font-size: 16px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      font-weight:700;
      color:#ffffff;
    }#classic-root .card-header-title p{
      font-size: 13px;
      color: var(--muted);
      margin-top:2px;
    }#classic-root .card-body{ margin-top:6px; }#classic-root .collapse-toggle{
      padding:4px 9px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.5);
      background:#020617;
      color:var(--blue-soft);
      font-size:14px;
      cursor:pointer;
    }#classic-root .chip{
      padding: 6px 12px;
      border-radius: 999px;
      background:#020617;
      border: 1px solid #1f2937;
      color: var(--blue-soft);
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.16em;
      font-weight:600;
    }#classic-root /* Config layout */
    .layout-config{
      display:grid;
      grid-template-columns:minmax(0,1.1fr) minmax(0,1.2fr);
      gap:16px;
    }
    @media(max-width:1100px){#classic-root .layout-config{grid-template-columns:minmax(0,1fr);}
    }#classic-root .field{ margin-bottom: 10px; }#classic-root .field label{
      display:block;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--blue-soft);
      margin-bottom: 4px;
      font-weight:600;
    }#classic-root input[type="text"], #classic-root select, #classic-root input[type="number"]{
      width: 100%;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid #1e293b;
      background:#020617;
      color: var(--text);
      font-size: 14px;
      outline: none;
    }#classic-root input[type="text"]::placeholder{ color:#4b5563; }#classic-root input[type="text"]:focus, #classic-root select:focus, #classic-root input[type="number"]:focus{
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(var(--brand-accent-rgb), 0.5);
    }#classic-root .teams-grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:8px;
      max-height:300px;
      overflow-y:auto;
      padding-right:4px;
    }
    @media(max-width:800px){#classic-root .teams-grid{grid-template-columns:minmax(0,1fr);}
    }#classic-root .team-input-row{
      display:flex;
      align-items:center;
      gap:6px;
    }#classic-root .team-label{
      width:28px;
      font-size:12px;
      color:var(--blue-soft);
      text-align:right;
      font-weight:600;
    }#classic-root /* Terrains */
    .terrain-grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:8px;
    }
    @media(max-width:800px){#classic-root .terrain-grid{grid-template-columns:minmax(0,1fr);}
    }#classic-root /* Poules */
    .pools-grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:10px;
    }
    @media(max-width:1200px){#classic-root .pools-grid{grid-template-columns:minmax(0,1fr);}
    }#classic-root .pool-card{
      border-radius:14px;
      border:1px solid #1f2937;
      padding:10px;
    }#classic-root .pool-card.theme-A{
      background: radial-gradient(circle at 0 0, rgba(var(--brand-secondary-rgb),0.18), transparent 55%),
                  linear-gradient(145deg,#020617,#02111f);
    }#classic-root .pool-card.theme-B{
      background: radial-gradient(circle at 100% 0, rgba(153,183,215,0.18), transparent 55%),
                  linear-gradient(145deg,#020617,#071322);
    }#classic-root .pool-card.theme-C{
      background: radial-gradient(circle at 0 100%, rgba(var(--brand-primary-rgb), 0.25), transparent 60%),
                  linear-gradient(145deg,#020617,#040f20);
    }#classic-root .pool-card.theme-D{
      background: radial-gradient(circle at 100% 100%, rgba(var(--brand-accent-rgb), 0.15), transparent 60%),
                  linear-gradient(145deg,#020617,#050f1f);
    }#classic-root .pool-card-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
      margin-bottom:6px;
    }#classic-root .pool-title{
      font-size:14px;
      text-transform:uppercase;
      letter-spacing:0.16em;
      color:#ffffff;
      font-weight:700;
    }#classic-root .pool-subtitle{
      font-size:12px;
      color:var(--blue-soft);
    }#classic-root .pool-ranking{
      margin-bottom:6px;
    }#classic-root .pool-ranking-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:13px;
      padding:3px 0;
    }#classic-root .pool-ranking-pos{
      width:24px;
      color:var(--blue-soft);
      text-align:right;
      font-weight:600;
    }#classic-root .pool-ranking-name{
      flex:1;
      margin:0 6px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      font-weight:600;
      color:#e5e7eb;
    }#classic-root .pool-ranking-points{
      min-width:40px;
      text-align:right;
      color:var(--accent);
      font-weight:600;
    }#classic-root .pool-next{
      border-radius:10px;
      border:1px dashed #1f2937;
      padding:6px 8px;
      margin-bottom:4px;
      font-size:13px;
    }#classic-root .pool-next-title{
      font-weight:700;
      margin-bottom:3px;
      color:#f9fafb;
    }#classic-root .pool-next-line{
      display:flex;
      justify-content:space-between;
      gap:6px;
      margin-top:3px;
    }#classic-root .pool-next-name{
      flex:1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      font-weight:600;
      color:#e5e7eb;
    }#classic-root .pool-next-note{
      font-size:11px;
      color:var(--muted);
      margin-top:4px;
    }#classic-root .pool-matches-toggle{
      margin-top:6px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
    }#classic-root .pool-matches-list{
      margin-top:6px;
    }#classic-root .pool-match-row{
      border-radius:10px;
      border:1px solid #111827;
      padding:6px 8px;
      font-size:13px;
      margin-bottom:4px;
      background:#020617;
    }#classic-root .pool-match-row.played{
      background:linear-gradient(135deg,
                 rgba(34,197,94,0.12),
                 rgba(21,128,61,0.35));
      border-color:var(--success);
      box-shadow:0 0 12px rgba(34,197,94,0.35);
    }#classic-root .pool-match-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:3px;
    }#classic-root .pool-match-title{
      font-weight:700;
      color:#f9fafb;
    }#classic-root .pool-match-teams{
      display:flex;
      justify-content:space-between;
      gap:6px;
      margin-bottom:4px;
    }#classic-root .pool-match-team-name{
      flex:1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      font-weight:600;
      color:#e5e7eb;
    }#classic-root .pool-match-score{
      display:flex;
      align-items:center;
      gap:6px;
      margin-bottom:4px;
    }#classic-root .pool-score-input{
      width:52px;
      text-align:center;
      padding:4px 6px;
      font-size:13px;
    }#classic-root .pool-score-separator{
      font-weight:700;
      color:#f9fafb;
    }#classic-root .pool-match-actions{
      display:flex;
      justify-content:flex-end;
      gap:6px;
      margin-bottom:2px;
      flex-wrap:wrap;
    }#classic-root .badge{
      font-size:11px;
      padding:2px 8px;
      border-radius:999px;
      border:1px solid #1f2937;
      background:#020617;
      color:var(--muted);
      font-weight:600;
    }#classic-root .status-line{
      font-size:11px;
      color:var(--muted);
      text-align:right;
    }#classic-root /* Brackets (tree style) */
    .bracket-card{
      background:#020617;
      border-radius:16px;
      border:1px solid #1f2937;
      padding:10px;
    }#classic-root .bracket-title{
      font-size:14px;
      text-transform:uppercase;
      letter-spacing:0.16em;
      margin-bottom:4px;
      color:#ffffff;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
      font-weight:700;
    }#classic-root .bracket-tree{
      --bracket-gap: 18px;
      --bracket-line-color: #c2d3ff44;
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:center;
      margin-top:10px;
      width:100%;
    }#classic-root .bracket-stage-block{
      width:100%;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:6px;
    }#classic-root .stage-qf-row-block{ max-width:100%; }#classic-root .stage-sf-row-block{ max-width:72%; }#classic-root .stage-final-row-block{ max-width:54%; }#classic-root .bracket-column-title{
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:0.12em;
      color:var(--blue-soft);
      font-weight:600;
    }#classic-root .bracket-stage-row{
      display:flex;
      gap:14px;
      width:100%;
      justify-content:space-between;
      flex-wrap:wrap;
    }#classic-root .stage-qf-row .bracket-match-row{ flex:1; min-width:200px; }#classic-root .stage-sf-row{ justify-content:center; gap:28px; }#classic-root .stage-sf-row .bracket-match-row{ min-width:230px; }#classic-root .stage-final-row{ justify-content:center; }#classic-root .stage-final-row .bracket-match-row{ min-width:240px; }#classic-root .bracket-match-row{
      position:relative;
      border-radius:10px;
      border:1px solid #111827;
      padding:10px 12px;
      margin-bottom:4px;
      font-size:14px;
      background:linear-gradient(145deg,#020617,#050b18);
      min-height:104px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
    }#classic-root .bracket-match-row.stage-qf{
      background:linear-gradient(145deg,rgba(var(--brand-primary-rgb),0.45),#020617);
    }#classic-root .bracket-match-row.stage-sf{
      background:linear-gradient(145deg,rgba(var(--brand-secondary-rgb),0.45),#020617);
    }#classic-root .bracket-match-row.stage-final{
      background:linear-gradient(145deg,rgba(var(--brand-accent-rgb),0.5),#020617);
    }#classic-root .bracket-match-row.stage-placement{
      background:linear-gradient(145deg,rgba(148,163,184,0.35),#020617);
    }#classic-root .bracket-match-row.played{
      border-color:var(--success);
      box-shadow:0 0 12px rgba(34,197,94,0.35);
    }#classic-root .bracket-match-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:4px;
      color:#f9fafb;
      font-weight:600;
    }#classic-root .bracket-match-teams{
      display:flex;
      flex-direction:column;
      gap:3px;
      margin-bottom:4px;
    }#classic-root .bracket-vs-line{
      margin-top:2px;
      margin-bottom:4px;
      font-weight:700;
      color:#e5e7eb;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      border-top:1px solid rgba(255,255,255,0.06);
      padding-top:6px;
    }#classic-root .bracket-team-line{
      display:flex;
      justify-content:space-between;
      gap:6px;
    }#classic-root .bracket-team-name{
      flex:1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      color:#f9fafb;
      font-weight:600;
    }#classic-root .bracket-team-winner{
      color:var(--success);
      font-weight:700;
    }#classic-root /* Classement final */
    .final-ranking-row{
      border-radius:10px;
      padding:4px 8px;
      background: linear-gradient(120deg,
                rgba(15,23,42,0.9),
                rgba(15,23,42,0.95));
      border:1px solid rgba(51,65,85,0.9);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
      font-size:13px;
      margin-bottom:4px;
    }#classic-root .final-ranking-pos{
      width:28px;
      color:var(--blue-soft);
      font-weight:600;
    }#classic-root .final-ranking-name{
      flex:1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      font-weight:600;
    }#classic-root .classement-phrase{
      font-size:13px;
      text-transform:uppercase;
      letter-spacing:0.16em;
      color:#e5e7eb;
      opacity:0.9;
    }#classic-root .classement-podium{
      display:flex;
      gap:10px;
      align-items:flex-end;
      justify-content:center;
      flex-wrap:wrap;
    }#classic-root .podium-col{
      flex:1;
      border-radius:16px;
      padding:8px 10px;
      background:linear-gradient(145deg,rgba(15,23,42,0.95),rgba(15,23,42,0.9));
      border:1px solid rgba(51,65,85,0.9);
      display:flex;
      flex-direction:column;
      justify-content:flex-end;
      align-items:center;
      min-height:120px;
      box-shadow:0 18px 40px rgba(0,0,0,0.9);
    }#classic-root .podium-col--first{
      min-height:160px;
      background:linear-gradient(145deg,rgba(var(--brand-accent-rgb),0.25),rgba(15,23,42,0.95));
      border-color:rgba(var(--brand-accent-rgb),0.7);
    }#classic-root .podium-col--second, #classic-root .podium-col--third{
      min-height:130px;
    }#classic-root .podium-emoji{
      font-size:46px;
      line-height:1;
      margin-bottom:6px;
      text-align:center;
    }#classic-root .podium-rank{
      font-size:20px;
      font-weight:800;
      margin-bottom:4px;
    }#classic-root .podium-name{
      font-size:13px;
      font-weight:600;
      text-align:center;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }#classic-root .bracket-match-row.stage-small-final{
      background:linear-gradient(145deg,rgba(234,179,8,0.6),#020617);
      border-color:#facc15;
    }#classic-root /* Bracket connectors for tree-like shape */
    .bracket-match-row.stage-qf::after, #classic-root .bracket-match-row.stage-sf::before, #classic-root .bracket-match-row.stage-sf::after, #classic-root .bracket-match-row.stage-sf.sf-top::before, #classic-root .bracket-match-row.stage-sf.sf-bottom::before, #classic-root .bracket-match-row.stage-final.final-node::before, #classic-root .bracket-match-row.stage-final.final-node::after{
      display:none;
      content:none;
    }

    /* TV OVERLAY - Plein écran */
    #classic-root .tv-overlay {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at 0 0, rgba(10,40,80,0.55), transparent 55%),
                  radial-gradient(circle at 100% 100%, rgba(4,75,155,0.7), transparent 60%),
                  #020617;
      z-index: 10000;
      display: none;
      padding: 24px;
      margin: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
    }
    #classic-root .tv-inner{
      max-width:1700px;
      margin:0 auto;
      height:100%;
      display:flex;
      flex-direction:column;
      gap:12px;
    }#classic-root .tv-logo-bar{
      display:flex;
      justify-content:center;
      align-items:center;
    }#classic-root .tv-logo-bar img{
      max-height:76px;
      object-fit:contain;
      filter:drop-shadow(0 8px 14px rgba(0,0,0,0.55));
      display:none;
    }#classic-root .tv-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:16px;
      padding:12px 18px;
      border-radius:20px;
      border:1px solid rgba(148,163,184,0.4);
      background:linear-gradient(120deg,
        rgba(0,48,112,0.95) 0%,
        rgba(var(--brand-primary-rgb),0.90) 45%,
        rgba(13,98,190,0.85) 100%);
      box-shadow:0 24px 60px rgba(0,0,0,0.95);
    }#classic-root .tv-header-left{
      display:flex;
      flex-direction:column;
      gap:4px;
    }#classic-root .tv-title{
      font-size:22px;
      text-transform:uppercase;
      letter-spacing:0.3em;
      color:#e5e7eb;
      font-weight:800;
    }#classic-root .tv-subtitle{
      font-size:14px;
      color:#e0f2fe;
      font-weight:600;
    }#classic-root .tv-header-right{
      display:flex;
      align-items:center;
      gap:10px;
    }#classic-root .tv-tag-live{
      padding:4px 12px;
      border-radius:999px;
      font-size:13px;
      text-transform:uppercase;
      letter-spacing:0.14em;
      background:#b91c1c;
      color:#fee2e2;
      box-shadow:0 0 14px rgba(248,113,113,0.7);
      font-weight:700;
    }#classic-root .tv-main{
      flex:1;
      display:grid;
      grid-template-columns:minmax(0,1.5fr) minmax(0,1.1fr);
      gap:12px;
      min-height:0;
    }
    @media(max-width:1100px){#classic-root .tv-main{grid-template-columns:minmax(0,1fr);}
    }#classic-root .tv-col{
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height:0;
    }#classic-root .tv-block{
      border-radius:18px;
      padding:10px;
      border:1px solid rgba(15,23,42,0.8);
      background: radial-gradient(circle at 0 0, rgba(17,94,163,0.15), transparent 55%),
                  #020617;
      box-shadow:0 24px 60px rgba(0,0,0,0.95);
      display:flex;
      flex-direction:column;
      gap:6px;
      min-height:0;
    }#classic-root .tv-block-title{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:13px;
      text-transform:uppercase;
      letter-spacing:0.18em;
      color:var(--blue-soft);
      font-weight:700;
    }#classic-root .tv-list{
      flex:1;
      overflow-y:auto;
      padding-right:4px;
    }#classic-root .tv-match-card{
      border-radius:12px;
      padding:8px 10px;
      background: linear-gradient(120deg,
              rgba(0,48,112,0.98) 0%,
              rgba(var(--brand-primary-rgb),0.95) 55%,
              rgba(13,98,190,0.92) 100%);
      color:#f8fafc;
      margin-bottom:6px;
      font-size:14px;
    }#classic-root .tv-match-card.upcoming{
      background: linear-gradient(120deg, #020617 0%, #0b2546 55%, #0d3a73 100%);
      color:#f8fafc;
      border:1px solid rgba(37,99,235,0.35);
      box-shadow:0 10px 28px rgba(0,0,0,0.7);
    }#classic-root .tv-bracket-row{
      display:none;
      grid-template-columns:repeat(auto-fit, minmax(320px, 1fr));
      gap:12px;
      margin-top:6px;
    }#classic-root .tv-final-ranking{
      background: linear-gradient(90deg, #0b2e6d 0%, #124c9c 100%);
      border:1px solid rgba(255,255,255,0.08);
      border-radius:10px;
      padding:16px;
      color:#f3f7ff;
      box-shadow:0 8px 18px rgba(0,0,0,0.35);
    }#classic-root .tv-final-ranking h3{
      margin:0 0 8px;
      font-size:20px;
      text-align:center;
      letter-spacing:0.5px;
    }#classic-root .tv-ranking-podium{
      display:flex;
      justify-content:center;
      gap:12px;
      margin-bottom:12px;
    }#classic-root .tv-podium-col{
      background:rgba(255,255,255,0.05);
      border:1px solid rgba(255,255,255,0.1);
      border-radius:10px;
      padding:10px 12px;
      flex:1;
      min-width:120px;
      text-align:center;
    }#classic-root .tv-podium-emoji{
      font-size:34px;
      display:block;
      line-height:1.1;
      margin-bottom:4px;
    }#classic-root .tv-podium-rank{
      font-weight:700;
      font-size:16px;
      margin-bottom:2px;
    }#classic-root .tv-podium-name{
      font-size:14px;
      color:#e9eefc;
    }#classic-root .tv-ranking-list{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
      gap:6px;
    }#classic-root .tv-ranking-row{
      background:rgba(255,255,255,0.04);
      border:1px solid rgba(255,255,255,0.05);
      border-radius:8px;
      padding:6px 10px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:14px;
    }#classic-root .tv-ranking-pos{
      font-weight:700;
      color:#ffdf6e;
    }#classic-root .tv-bracket-block{
      flex:1;
    }#classic-root .tv-bracket-body{
      min-height:140px;
      max-height:190px;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      justify-content:flex-start;
      gap:6px;
      padding:4px 6px;
    }#classic-root .tv-bracket-block .bracket-card{
      background:transparent;
      border:none;
      padding:0;
      box-shadow:none;
    }#classic-root .tv-bracket-block .bracket-title{
      margin-bottom:2px;
    }#classic-root .tv-stage-view{
      display:flex;
      flex-direction:column;
      gap:6px;
    }#classic-root .tv-stage-header{
      font-size:12px;
      letter-spacing:0.12em;
      text-transform:uppercase;
      color:var(--blue-soft);
      font-weight:700;
    }#classic-root .tv-stage-strip{
      display:flex;
      flex-direction:row-reverse;
      justify-content:flex-start;
      align-items:stretch;
      gap:8px;
      flex-wrap:wrap;
    }#classic-root .tv-stage-card{
      flex:1 1 150px;
      max-width:210px;
      background: linear-gradient(120deg, rgba(0,48,112,0.96) 0%, rgba(var(--brand-primary-rgb),0.94) 55%, rgba(13,98,190,0.9) 100%);
      color:#f8fafc;
      border-radius:12px;
      padding:8px 10px;
      box-shadow:0 16px 34px rgba(0,0,0,0.75);
      border:1px solid rgba(59,130,246,0.35);
    }#classic-root .tv-stage-card.played{
      opacity:0.9;
      border-color:rgba(94,234,212,0.4);
    }#classic-root .tv-stage-card .tv-match-top{
      font-size:12px;
    }#classic-root .tv-stage-card .tv-team-line{
      font-size:13px;
    }#classic-root .tv-match-top{
      display:flex;
      justify-content:space-between;
      margin-bottom:4px;
      font-size:13px;
      font-weight:700;
    }#classic-root .tv-match-teams{
      display:flex;
      flex-direction:column;
      gap:3px;
    }#classic-root .tv-team-line{
      display:flex;
      justify-content:space-between;
      gap:6px;
    }#classic-root .tv-team-name{
      flex:1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      font-weight:600;
    }#classic-root .tv-tag{
      font-size:11px;
      padding:2px 8px;
      border-radius:999px;
      background:rgba(255,255,255,0.1);
      color:#e5e7eb;
      font-weight:600;
    }#classic-root .tv-match-card.upcoming .tv-match-top, #classic-root .tv-match-card.upcoming .tv-team-line, #classic-root .tv-match-card.upcoming .tv-team-name, #classic-root .tv-match-card.upcoming .tv-tag{
      color:#f9fafb;
    }#classic-root .tv-match-card.upcoming .tv-tag{
      background:rgba(255,255,255,0.08);
    }
  </style>
</head>
<body>
    <!-- 🆕 SIDEBAR MODERNE V2 -->
<aside class="app-sidebar" id="app-sidebar">
  <div class="sidebar-brand">
    <img id="sidebar-logo" alt="Logo" class="sidebar-logo">
    <span class="sidebar-club-name" data-club-name>Padel Parc</span>
  </div>
  
  <nav class="sidebar-nav">
    <a href="#" class="sidebar-item active" data-nav="home">
      <span class="sidebar-icon">🏠</span>
      <span class="sidebar-label">Accueil</span>
    </a>
    
    <div class="sidebar-section">
      <span class="sidebar-section-label">Tournois</span>

      <a href="#" class="sidebar-item" data-nav="md">
        <span class="sidebar-icon">🔄</span>
        <span class="sidebar-label">Montante/Descendante</span>
      </a>

      <a href="#" class="sidebar-item" data-nav="tournaments">
        <span class="sidebar-icon">🏆</span>
        <span class="sidebar-label">Tournois classiques</span>
      </a>
    </div>

    <div class="sidebar-section">
      <span class="sidebar-section-label">Ligue</span>

      <div class="sidebar-item-wrapper">
        <a href="#" class="sidebar-item" data-nav="ligue" id="sidebar-ligues-main">
          <span class="sidebar-icon">📅</span>
          <span class="sidebar-label">Ligues actives</span>
        </a>
        <button class="sidebar-submenu-toggle" id="sidebar-ligues-toggle" aria-label="Toggle ligues">
          <span class="chevron">▼</span>
        </button>
      </div>

      <div class="sidebar-submenu" id="sidebar-ligues-submenu">
        <!-- Les ligues actives seront injectées ici par JS -->
      </div>
      
      <a href="#" class="sidebar-item" data-nav="ligue-config">
        <span class="sidebar-icon">➕</span>
        <span class="sidebar-label">Nouvelle ligue</span>
      </a>
    </div>
  </nav>
  
  <div class="sidebar-footer">
    <button class="sidebar-item sidebar-settings" id="sidebar-settings-btn">
      <span class="sidebar-icon">⚙️</span>
      <span class="sidebar-label">Paramètres</span>
    </button>
  </div>
</aside>

<!-- 🔘 BOUTON TOGGLE SIDEBAR (hors de la sidebar pour rester visible) -->
<button class="sidebar-toggle-btn" id="sidebar-toggle-btn" aria-label="Rétracter/Déplier la sidebar">
  <span class="toggle-chevron">◀</span>
</button>

<script>
// ⚡ ANTI-FLASH : Applique l'état sidebar IMMÉDIATEMENT avant le rendu
(function() {
  try {
    var stored = localStorage.getItem('sidebar_open');
    var isOpen = stored === null ? true : stored === 'true';

    if (!isOpen) {
      var sidebar = document.getElementById('app-sidebar');
      if (sidebar) {
        sidebar.classList.add('collapsed');
        document.body.classList.add('sidebar-collapsed');
      }
    }
  } catch (e) {
    // Si localStorage échoue, on laisse la sidebar ouverte par défaut
  }
})();
</script>

<!-- Handle mobile sidebar toggle -->
<div class="sidebar-mobile-handle" id="sidebar-mobile-handle">
  <div class="handle-bar"></div>
</div>
  <div class="app">
    <div class="app-header">
      <button id="btn-header-back" class="header-back-btn" aria-label="Retour">←</button>
      <img id="app-logo" alt="Logo club" />
      <h1 id="app-title" data-club-name>Padel Parc</h1>
    </div>
    <div class="subtitle" id="app-subtitle" data-club-shortname></div>

    <!-- PAGE D'ACCUEIL -->
    <section id="home-root">
      <div class="home-hero"></div>

      <div class="home-grid">
        <!-- Bloc TOURNOIS -->
        <article class="home-card app-block-interactive">
          <div class="home-card-header">
            <div>
              <div class="home-card-title">Tournois classiques</div>
              <div class="small-muted">Poules, élimination directe, round-robin...</div>
            </div>
            <div class="home-card-icon">🏆</div>
          </div>
          <div class="home-card-body">
            Organise des tournois complets avec poules, phases finales ou tableaux
            d’élimination directe. Idéal pour les gros évènements.
          </div>
          <div class="home-card-footer">
            <span class="home-badge">Bientôt plusieurs formats</span>
            <button class="btn btn-small" id="btn-home-tournaments">▶ Ouvrir</button>
          </div>
        </article>

        <!-- Bloc LIGUE INTERNE -->
        <article class="home-card app-block-interactive">
          <div class="home-card-header">
            <div>
              <div class="home-card-title">Ligue interne</div>
              <div class="small-muted">Gestion de votre ligue interne de padel</div>
            </div>
            <div class="home-card-icon">📅</div>
          </div>
          <div class="home-card-body">
            Accède à un espace dédié pour gérer ta ligue interne. Création des poules,
            suivi des résultats et classement général.
          </div>
          <div class="home-card-footer">
            <span class="home-badge">Section dédiée</span>
            <button class="btn btn-small" id="btn-home-ligue">▶ Ouvrir</button>
          </div>
        </article>

        <!-- Bloc MONTANTE / DESCENDANTE -->
        <article class="home-card app-block-interactive">
          <div class="home-card-header">
            <div>
              <div class="home-card-title">Montante / descendante</div>
              <div class="small-muted">Format rapide, fun et flexible</div>
            </div>
            <div class="home-card-icon">🔁</div>
          </div>
          <div class="home-card-body">
            Gère une montante / descendante de 6 à 16 équipes, avec vue TV en direct,
            classement automatique et rotation des terrains.
          </div>
          <div class="home-card-footer">
            <span class="home-badge">Moteur avancé actif</span>
            <button class="btn btn-small" id="btn-home-md">▶ Ouvrir</button>
          </div>
        </article>
      </div>

    </section>

    <!-- PAGE PARAMÈTRES CLUB -->
    <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
         NOUVELLE STRUCTURE PARAMÈTRES - 5 ONGLETS MODULAIRES
         ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
    <section id="settings-root" style="display:none;">
      <div class="settings-shell">

        <!-- HEADER -->
        <div class="settings-main-header">
          <div>
            <p class="settings-breadcrumb">Personnalisation</p>
            <h1 class="settings-title">⚙️ Paramètres</h1>
          </div>
          <button class="btn btn-secondary btn-small" id="btn-settings-home">🏠 Accueil</button>
        </div>

        <!-- NAVIGATION ONGLETS (STICKY) -->
        <div class="settings-tabs-nav" role="tablist">
          <button class="settings-tab active" data-panel="club" role="tab" aria-selected="true">
            <span class="tab-icon">🏢</span>
            <span class="tab-text">Club</span>
          </button>
          <button class="settings-tab" data-panel="sponsors" role="tab">
            <span class="tab-icon">💼</span>
            <span class="tab-text">Sponsors</span>
          </button>
          <button class="settings-tab" data-panel="pong" role="tab">
            <span class="tab-icon">🕹️</span>
            <span class="tab-text">Mini-Jeu</span>
          </button>
          <button class="settings-tab" data-panel="exports" role="tab">
            <span class="tab-icon">📤</span>
            <span class="tab-text">Exports</span>
          </button>
          <button class="settings-tab" data-panel="theme" role="tab">
            <span class="tab-icon">🎨</span>
            <span class="tab-text">Thème</span>
          </button>
          <button class="settings-tab" data-panel="tvview" role="tab">
            <span class="tab-icon">📺</span>
            <span class="tab-text">Vue TV</span>
          </button>
        </div>

        <!-- PANELS CONTAINER -->
        <div class="settings-panels">

          <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
               PANEL 1 : 🏢 CLUB
               ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
          <div class="settings-panel active" id="panel-club" role="tabpanel">

            <!-- Identité du club -->
            <div class="settings-section app-block-interactive">
              <h3 class="settings-section-title">🏷️ Identité du club</h3>

              <div class="settings-grid">
                <div class="field full-width">
                  <label for="club-logo-upload" class="field-label">Logo principal</label>
                  <div class="logo-upload-container">
                    <label class="logo-wrapper">
                      <img id="club-logo-preview" alt="Logo" />
                      <input id="club-logo-upload" type="file" accept="image/*" />
                    </label>
                    <p class="field-hint">Image carrée ou rectangulaire, max 2MB</p>
                  </div>
                </div>

                <div class="field">
                  <label for="club-name" class="field-label">Nom complet du club</label>
                  <input id="club-name" type="text" class="field-input" placeholder="Padel Parc" />
                </div>

                <div class="field">
                  <label for="club-shortname" class="field-label">Nom court / Acronyme</label>
                  <input id="club-shortname" type="text" class="field-input" placeholder="PP" />
                </div>

                <div class="field full-width">
                  <label for="club-slogan" class="field-label">Slogan (optionnel)</label>
                  <input id="club-slogan" type="text" class="field-input" placeholder="Le padel à votre portée" />
                </div>

                <div class="field">
                  <label for="club-signature-color" class="field-label">Couleur signature</label>
                  <input id="club-signature-color" type="color" class="field-color" value="#e5e339" />
                </div>
              </div>
            </div>

            <!-- Contact -->
            <div class="settings-section app-block-interactive">
              <h3 class="settings-section-title">📞 Informations de contact</h3>

              <div class="settings-grid">
                <div class="field full-width">
                  <label for="club-address" class="field-label">Adresse complète</label>
                  <textarea id="club-address" class="field-textarea" rows="3" placeholder="123 Rue du Padel, 75000 Paris"></textarea>
                </div>

                <div class="field">
                  <label for="club-phone" class="field-label">Téléphone</label>
                  <input id="club-phone" type="tel" class="field-input" placeholder="+33 1 23 45 67 89" />
                </div>

                <div class="field">
                  <label for="club-email" class="field-label">Email</label>
                  <input id="club-email" type="email" class="field-input" placeholder="contact@club.fr" />
                </div>

                <div class="field full-width">
                  <label for="club-website" class="field-label">Site web</label>
                  <input id="club-website" type="url" class="field-input" placeholder="https://www.club.fr" />
                </div>

                <div class="field">
                  <label for="club-instagram" class="field-label">Instagram</label>
                  <input id="club-instagram" type="text" class="field-input" placeholder="@club" />
                </div>

                <div class="field">
                  <label for="club-facebook" class="field-label">Facebook</label>
                  <input id="club-facebook" type="text" class="field-input" placeholder="Club Officiel" />
                </div>

                <div class="field">
                  <label for="club-twitter" class="field-label">Twitter / X</label>
                  <input id="club-twitter" type="text" class="field-input" placeholder="@club" />
                </div>
              </div>
            </div>

            <!-- Configuration -->
            <div class="settings-section app-block-interactive">
              <h3 class="settings-section-title">⚙️ Configuration événements</h3>

              <div class="settings-grid">
                <div class="field">
                  <label for="club-timezone" class="field-label">Fuseau horaire</label>
                  <select id="club-timezone" class="field-select">
                    <option value="Europe/Paris">Europe/Paris (GMT+1)</option>
                    <option value="Europe/London">Europe/London (GMT+0)</option>
                    <option value="America/New_York">America/New_York (GMT-5)</option>
                  </select>
                </div>

                <div class="field">
                  <label for="club-currency" class="field-label">Devise par défaut</label>
                  <select id="club-currency" class="field-select">
                    <option value="EUR">€ Euro</option>
                    <option value="USD">$ Dollar US</option>
                    <option value="GBP">£ Livre Sterling</option>
                    <option value="CHF">CHF Franc Suisse</option>
                  </select>
                </div>

                <div class="field">
                  <label for="club-date-format" class="field-label">Format de date</label>
                  <select id="club-date-format" class="field-select">
                    <option value="DD/MM/YYYY">JJ/MM/AAAA</option>
                    <option value="MM/DD/YYYY">MM/JJ/AAAA</option>
                    <option value="YYYY-MM-DD">AAAA-MM-JJ</option>
                  </select>
                </div>

                <div class="field">
                  <label for="club-language" class="field-label">Langue</label>
                  <select id="club-language" class="field-select">
                    <option value="fr">🇫🇷 Français</option>
                    <option value="en">🇬🇧 English</option>
                    <option value="es">🇪🇸 Español</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Actions -->
            <div class="settings-actions">
              <button class="btn btn-primary" id="btn-save-club">💾 Sauvegarder</button>
              <button class="btn btn-secondary" id="btn-reset-club">↩️ Réinitialiser</button>
            </div>
          </div>

          <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
               PANEL 2 : 💼 SPONSORS
               ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
          <div class="settings-panel" id="panel-sponsors" role="tabpanel">

            <div class="settings-section app-block-interactive">
              <h3 class="settings-section-title">➕ Ajouter un sponsor</h3>

              <div class="settings-grid">
                <div class="field">
                  <label for="sponsor-name-input" class="field-label">Nom du sponsor</label>
                  <input id="sponsor-name-input" type="text" class="field-input" placeholder="Entreprise XYZ" />
                </div>

                <div class="field">
                  <label for="sponsor-category-input" class="field-label">Catégorie</label>
                  <select id="sponsor-category-input" class="field-select">
                    <option value="sport">Sport</option>
                    <option value="alimentation">Alimentation</option>
                    <option value="automobile">Automobile</option>
                    <option value="tech">Tech</option>
                    <option value="autre">Autre</option>
                  </select>
                </div>

                <div class="field full-width">
                  <label for="sponsor-logo-input" class="field-label">Logo</label>
                  <input id="sponsor-logo-input" type="file" class="field-input" accept="image/*" />
                  <div id="sponsor-logo-preview-wrapper" style="display:none; margin-top:8px;">
                    <img id="sponsor-logo-preview-img" alt="Preview" style="max-width:100px; border-radius:8px;" />
                  </div>
                </div>

                <div class="field full-width">
                  <label for="sponsor-url-input" class="field-label">Site web (optionnel)</label>
                  <input id="sponsor-url-input" type="url" class="field-input" placeholder="https://..." />
                </div>
              </div>

              <button class="btn btn-primary" id="btn-add-new-sponsor">➕ Ajouter le sponsor</button>
            </div>

            <div class="settings-section app-block-interactive">
              <h3 class="settings-section-title">📋 Sponsors actifs</h3>
              <div id="sponsors-active-list"></div>
              <div id="sponsors-empty" class="empty-state" style="display:none;">
                <p>💼</p>
                <p>Aucun sponsor enregistré</p>
              </div>
            </div>

            <div class="settings-section app-block-interactive">
              <h3 class="settings-section-title">🎛️ Options avancées</h3>

              <div class="settings-grid">
                <div class="field">
                  <label class="checkbox-label">
                    <input id="sponsor-rotation-toggle" type="checkbox" />
                    <span>Rotation automatique</span>
                  </label>
                </div>

                <div class="field">
                  <label for="sponsor-rotation-duration" class="field-label">Durée rotation (sec)</label>
                  <input id="sponsor-rotation-duration" type="number" class="field-input" min="5" max="60" value="10" />
                </div>

                <div class="field">
                  <label for="sponsor-position" class="field-label">Position bannière TV</label>
                  <select id="sponsor-position" class="field-select">
                    <option value="top-right">Haut droite</option>
                    <option value="bottom-right" selected>Bas droite</option>
                    <option value="bottom-left">Bas gauche</option>
                    <option value="top-left">Haut gauche</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
               PANEL 3 : 🕹️ PONG
               ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
          <div class="settings-panel" id="panel-pong" role="tabpanel">

            <div class="settings-section app-block-interactive">
              <h3 class="settings-section-title">🎮 Configuration de base</h3>

              <div class="settings-grid">
                <div class="field">
                  <label for="pong-sponsor-name" class="field-label">Nom du sponsor Pong</label>
                  <input id="pong-sponsor-name" type="text" class="field-input" />
                </div>

                <div class="field">
                  <label for="pong-sponsor-logo" class="field-label">URL logo sponsor</label>
                  <input id="pong-sponsor-logo" type="text" class="field-input" placeholder="https://...logo.png" />
                </div>

                <div class="field">
                  <label for="pong-ai-name" class="field-label">Nom de l'IA</label>
                  <input id="pong-ai-name" type="text" class="field-input" placeholder="PadelBot" />
                </div>
              </div>
            </div>

            <div class="settings-section app-block-interactive">
              <h3 class="settings-section-title">🎨 Apparence du jeu</h3>

              <div class="field">
                <label class="checkbox-label">
                  <input id="pong-use-theme" type="checkbox" checked />
                  <span>Utiliser les couleurs du thème</span>
                </label>
              </div>

              <div id="pong-custom-colors-section" class="settings-grid" style="display:none;">
                <div class="field">
                  <label for="pong-color-ball" class="field-label">Couleur balle</label>
                  <input id="pong-color-ball" type="color" class="field-color" value="#e5e339" />
                </div>
                <div class="field">
                  <label for="pong-color-player" class="field-label">Raquette joueur</label>
                  <input id="pong-color-player" type="color" class="field-color" value="#004b9b" />
                </div>
                <div class="field">
                  <label for="pong-color-ai" class="field-label">Raquette IA</label>
                  <input id="pong-color-ai" type="color" class="field-color" value="#ff5252" />
                </div>
                <div class="field">
                  <label for="pong-color-bg" class="field-label">Fond terrain</label>
                  <input id="pong-color-bg" type="color" class="field-color" value="#020617" />
                </div>
              </div>
            </div>

            <div class="settings-section app-block-interactive">
              <h3 class="settings-section-title">⚙️ Gameplay</h3>

              <div class="settings-grid">
                <div class="field">
                  <label class="checkbox-label">
                    <input id="pong-leaderboard" type="checkbox" checked />
                    <span>Activer le leaderboard</span>
                  </label>
                </div>

                <div class="field">
                  <label class="checkbox-label">
                    <input id="pong-sounds" type="checkbox" checked />
                    <span>Activer les sons</span>
                  </label>
                </div>

                <div class="field">
                  <label for="pong-difficulty" class="field-label">Difficulté par défaut</label>
                  <select id="pong-difficulty" class="field-select">
                    <option value="easy">Facile</option>
                    <option value="medium" selected>Moyen</option>
                    <option value="hard">Difficile</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="settings-section app-block-interactive">
              <h3 class="settings-section-title">📱 QR Code</h3>

              <div class="settings-grid">
                <div class="field">
                  <label for="pong-qr-size" class="field-label">Taille QR Code</label>
                  <select id="pong-qr-size" class="field-select">
                    <option value="120">Petit (120px)</option>
                    <option value="160" selected>Moyen (160px)</option>
                    <option value="200">Grand (200px)</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="settings-actions">
              <button class="btn btn-primary" id="btn-save-pong">💾 Enregistrer config mini-jeu</button>
            </div>
          </div>

          <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
               PANEL 4 : 📤 EXPORTS
               ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
          <div class="settings-panel" id="panel-exports" role="tabpanel">

            <div class="settings-section app-block-interactive">
              <h3 class="settings-section-title">🎨 Templates d'export</h3>

              <div class="export-templates-grid">
                <label class="export-template-card">
                  <input type="radio" name="export-template" value="moderne" id="template-moderne" checked style="display:none;" />
                  <div class="template-preview moderne">
                    <span class="template-emoji">🎨</span>
                  </div>
                  <div class="template-name">Moderne</div>
                </label>

                <label class="export-template-card">
                  <input type="radio" name="export-template" value="epure" id="template-epure" style="display:none;" />
                  <div class="template-preview epure">
                    <span class="template-emoji">📄</span>
                  </div>
                  <div class="template-name">Épuré</div>
                </label>

                <label class="export-template-card">
                  <input type="radio" name="export-template" value="sombre" id="template-sombre" style="display:none;" />
                  <div class="template-preview sombre">
                    <span class="template-emoji">🌙</span>
                  </div>
                  <div class="template-name">Sombre</div>
                </label>

                <label class="export-template-card">
                  <input type="radio" name="export-template" value="sponsor" id="template-sponsor" style="display:none;" />
                  <div class="template-preview sponsor">
                    <span class="template-emoji">💼</span>
                  </div>
                  <div class="template-name">Sponsor</div>
                </label>
              </div>
            </div>

            <div class="settings-section app-block-interactive">
              <h3 class="settings-section-title">🖼️ Fond d'export journée ligue</h3>

              <div class="settings-grid">
                <div class="field full-width">
                  <label for="export-league-bg" class="field-label">Image de fond</label>
                  <input id="export-league-bg" type="file" class="field-input" accept="image/*" />
                  <div id="export-league-bg-preview-wrapper" style="display:none; margin-top:8px;">
                    <img id="export-league-bg-preview" alt="Preview" style="max-width:300px; border-radius:8px;" />
                  </div>
                </div>

                <div class="field">
                  <label for="export-overlay-opacity" class="field-label">Opacité overlay</label>
                  <input id="export-overlay-opacity" type="range" class="field-range" min="0" max="100" value="50" />
                  <span id="export-overlay-value">50%</span>
                </div>

                <div class="field">
                  <label class="checkbox-label">
                    <input id="export-dark-filter" type="checkbox" checked />
                    <span>Appliquer filtre sombre</span>
                  </label>
                </div>
              </div>
            </div>

            <div class="settings-section app-block-interactive">
              <h3 class="settings-section-title">🏷️ Branding automatique</h3>

              <div class="field">
                <label class="checkbox-label">
                  <input id="export-branding-enabled" type="checkbox" checked />
                  <span>Ajouter branding aux exports</span>
                </label>
              </div>

              <div id="export-branding-options" class="settings-grid">
                <div class="field full-width">
                  <label for="export-branding-logo" class="field-label">Logo pour exports</label>
                  <input id="export-branding-logo" type="file" class="field-input" accept="image/*" />
                </div>

                <div class="field full-width">
                  <label for="export-branding-text" class="field-label">Texte footer</label>
                  <input id="export-branding-text" type="text" class="field-input" placeholder="Généré par..." />
                </div>

                <div class="field">
                  <label class="checkbox-label">
                    <input id="export-qr-enabled" type="checkbox" />
                    <span>Ajouter QR code vers site</span>
                  </label>
                </div>

                <div class="field">
                  <label for="export-qr-position" class="field-label">Position QR</label>
                  <select id="export-qr-position" class="field-select">
                    <option value="bottom-left">Bas gauche</option>
                    <option value="bottom-right" selected>Bas droite</option>
                    <option value="none">Aucun</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="settings-section app-block-interactive">
              <h3 class="settings-section-title">📁 Formats d'export</h3>

              <div class="settings-grid">
                <div class="field">
                  <label class="checkbox-label">
                    <input id="export-format-png" type="checkbox" checked />
                    <span>PNG (réseaux sociaux)</span>
                  </label>
                </div>

                <div class="field">
                  <label class="checkbox-label">
                    <input id="export-format-pdf" type="checkbox" checked />
                    <span>PDF (impression)</span>
                  </label>
                </div>

                <div class="field">
                  <label class="checkbox-label">
                    <input id="export-format-jpeg" type="checkbox" checked />
                    <span>JPEG (compatibilité)</span>
                  </label>
                </div>

                <div class="field">
                  <label for="export-quality" class="field-label">Qualité image</label>
                  <select id="export-quality" class="field-select">
                    <option value="72">Normale (72 dpi)</option>
                    <option value="150" selected>Haute (150 dpi)</option>
                    <option value="300">Impression (300 dpi)</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="settings-actions">
              <button class="btn btn-primary" id="btn-save-exports">💾 Sauvegarder préférences exports</button>
            </div>
          </div>

          <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
               PANEL 5 : 🎨 THÈME
               ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
          <div class="settings-panel" id="panel-theme" role="tabpanel">

            <div class="settings-section app-block-interactive">
              <h3 class="settings-section-title">📚 Bibliothèque de thèmes</h3>

              <div id="themes-library-grid" class="themes-grid">
                <!-- Themes will be loaded dynamically -->
              </div>
            </div>

            <div class="settings-section app-block-interactive">
              <h3 class="settings-section-title">🎨 Éditeur de thème personnalisé</h3>

              <!-- Couleurs -->
              <details class="theme-editor-group" open>
                <summary class="theme-editor-summary">🎨 Couleurs</summary>
                <div class="settings-grid-3">
                  <div class="field">
                    <label for="theme-primary" class="field-label">Principale</label>
                    <input id="theme-primary" type="color" class="field-color" value="#004b9b" />
                  </div>
                  <div class="field">
                    <label for="theme-secondary" class="field-label">Secondaire</label>
                    <input id="theme-secondary" type="color" class="field-color" value="#4d81b9" />
                  </div>
                  <div class="field">
                    <label for="theme-accent" class="field-label">Accent</label>
                    <input id="theme-accent" type="color" class="field-color" value="#e5e339" />
                  </div>
                  <div class="field">
                    <label for="theme-bg" class="field-label">Fond</label>
                    <input id="theme-bg" type="color" class="field-color" value="#020617" />
                  </div>
                  <div class="field">
                    <label for="theme-card" class="field-label">Cartes</label>
                    <input id="theme-card" type="color" class="field-color" value="#0b1220" />
                  </div>
                  <div class="field">
                    <label for="theme-text" class="field-label">Texte</label>
                    <input id="theme-text" type="color" class="field-color" value="#ffffff" />
                  </div>
                  <div class="field">
                    <label for="theme-title" class="field-label">Titres</label>
                    <input id="theme-title" type="color" class="field-color" value="#e5e339" />
                  </div>
                </div>
              </details>

              <!-- Typographie -->
              <details class="theme-editor-group">
                <summary class="theme-editor-summary">✒️ Typographie</summary>
                <div class="settings-grid">
                  <div class="field">
                    <label for="theme-font" class="field-label">Police principale</label>
                    <select id="theme-font" class="field-select">
                      <option value="system" selected>System</option>
                      <option value="Inter">Inter</option>
                      <option value="Poppins">Poppins</option>
                      <option value="Montserrat">Montserrat</option>
                      <option value="Roboto">Roboto</option>
                      <option value="Nunito">Nunito</option>
                    </select>
                  </div>
                </div>
              </details>

              <!-- Formes -->
              <details class="theme-editor-group">
                <summary class="theme-editor-summary">🔲 Formes & Espacements</summary>
                <div class="settings-grid">
                  <div class="field">
                    <label for="theme-border-radius" class="field-label">Arrondis</label>
                    <select id="theme-border-radius" class="field-select">
                      <option value="square">Carré</option>
                      <option value="rounded" selected>Arrondi léger</option>
                      <option value="pill">Très arrondi</option>
                    </select>
                  </div>

                  <div class="field">
                    <label for="theme-button-style" class="field-label">Style boutons</label>
                    <select id="theme-button-style" class="field-select">
                      <option value="solid" selected>Plein</option>
                      <option value="outline">Contour</option>
                      <option value="ghost">Transparent</option>
                    </select>
                  </div>
                </div>
              </details>

              <!-- Fond -->
              <details class="theme-editor-group">
                <summary class="theme-editor-summary">🌌 Fond de page</summary>
                <div class="settings-grid">
                  <div class="field">
                    <label for="theme-bg-style" class="field-label">Type de fond</label>
                    <select id="theme-bg-style" class="field-select">
                      <option value="solid">Uni</option>
                      <option value="gradient" selected>Dégradé</option>
                      <option value="pattern">Motif</option>
                      <option value="image">Image</option>
                    </select>
                  </div>

                  <div class="field" id="theme-bg-image-field" style="display:none;">
                    <label for="theme-bg-image" class="field-label">Image</label>
                    <input id="theme-bg-image" type="file" class="field-input" accept="image/*" />
                  </div>
                </div>
              </details>
            </div>

            <div class="settings-section app-block-interactive">
              <h3 class="settings-section-title">💾 Mes thèmes sauvegardés</h3>

              <div id="custom-themes-list">
                <div class="empty-state">
                  <p>🎨</p>
                  <p>Aucun thème personnalisé</p>
                </div>
              </div>

              <div class="theme-management-btns">
                <button class="btn btn-primary" id="btn-save-custom-theme">💾 Sauvegarder comme nouveau thème</button>
                <button class="btn btn-secondary" id="btn-import-theme">📥 Importer</button>
                <button class="btn btn-secondary" id="btn-export-theme">📤 Exporter</button>
              </div>
            </div>

            <div class="settings-actions theme-actions">
              <div class="unsaved-indicator" id="theme-unsaved" style="display:none;">
                <span class="dot">●</span>
                <span>Modifications non sauvegardées</span>
              </div>
              <button class="btn btn-primary" id="btn-apply-theme">✅ Appliquer les modifications</button>
              <button class="btn btn-secondary" id="btn-cancel-theme">↩️ Annuler</button>
              <button class="btn btn-danger" id="btn-reset-theme">🔄 Réinitialiser par défaut</button>
            </div>
          </div>

          <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
               PANEL 6 : 📺 VUE TV
               ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
          <div class="settings-panel" id="panel-tvview" role="tabpanel">

            <div class="settings-section app-block-interactive">
              <h3 class="settings-section-title">📺 Configuration des vues TV</h3>
              <p class="field-hint">Personnalisez l'affichage, la rotation et les animations pour chaque mode de jeu</p>
            </div>

            <!-- Sub-tabs pour chaque mode -->
            <div class="tvview-mode-tabs">
              <button class="tvview-mode-tab active" data-mode="md">
                🔄 Montante/Desc.
              </button>
              <button class="tvview-mode-tab" data-mode="classic">
                🏆 Tournoi Classique
              </button>
              <button class="tvview-mode-tab" data-mode="americano">
                🎯 Américano
              </button>
            </div>

            <!-- Mode M/D Config -->
            <div class="tvview-mode-panel active" data-mode="md">
              <!-- Section 2.1 : Blocs affichés -->
              <div class="settings-section app-block-interactive">
                <h3 class="settings-section-title">📦 Blocs affichés</h3>
                <p class="field-hint">Sélectionnez les blocs qui apparaîtront dans la rotation TV</p>

                <div class="tvview-blocks-list">
                  <label class="tvview-block-item">
                    <input type="checkbox" id="md-block-current" checked />
                    <span class="block-label">
                      <span class="block-icon">🏓</span>
                      <span class="block-name">Matchs en cours</span>
                    </span>
                  </label>

                  <label class="tvview-block-item">
                    <input type="checkbox" id="md-block-ranking" checked />
                    <span class="block-label">
                      <span class="block-icon">📊</span>
                      <span class="block-name">Classement en temps réel</span>
                    </span>
                  </label>

                  <label class="tvview-block-item">
                    <input type="checkbox" id="md-block-next" checked />
                    <span class="block-label">
                      <span class="block-icon">⏭️</span>
                      <span class="block-name">Prochains matchs</span>
                    </span>
                  </label>

                  <label class="tvview-block-item">
                    <input type="checkbox" id="md-block-resting" />
                    <span class="block-label">
                      <span class="block-icon">💤</span>
                      <span class="block-name">Équipes au repos</span>
                    </span>
                  </label>

                  <label class="tvview-block-item">
                    <input type="checkbox" id="md-block-stats" />
                    <span class="block-label">
                      <span class="block-icon">📈</span>
                      <span class="block-name">Statistiques tournoi</span>
                    </span>
                  </label>

                  <label class="tvview-block-item">
                    <input type="checkbox" id="md-block-podium" checked />
                    <span class="block-label">
                      <span class="block-icon">🏆</span>
                      <span class="block-name">Podium top 3</span>
                    </span>
                  </label>
                </div>
              </div>

              <!-- Section 2.2 : Rotation automatique -->
              <div class="settings-section app-block-interactive">
                <h3 class="settings-section-title">🔄 Rotation automatique</h3>

                <label class="tvview-block-item">
                  <input type="checkbox" id="md-rotation-enabled" checked />
                  <span class="block-label">
                    <span class="block-name">Activer la rotation automatique</span>
                  </span>
                </label>

                <div id="md-rotation-settings" class="tvview-rotation-settings">
                  <h4 class="subsection-title">⏱️ Durée d'affichage par bloc</h4>

                  <div class="tvview-duration-grid">
                    <div class="duration-item">
                      <label class="field-label">Matchs en cours</label>
                      <div class="slider-group">
                        <input type="range" id="md-duration-current" min="2" max="30" value="10" class="duration-slider" />
                        <span class="duration-value">10s</span>
                      </div>
                    </div>

                    <div class="duration-item">
                      <label class="field-label">Classement</label>
                      <div class="slider-group">
                        <input type="range" id="md-duration-ranking" min="2" max="30" value="8" class="duration-slider" />
                        <span class="duration-value">8s</span>
                      </div>
                    </div>

                    <div class="duration-item">
                      <label class="field-label">Prochains matchs</label>
                      <div class="slider-group">
                        <input type="range" id="md-duration-next" min="2" max="30" value="6" class="duration-slider" />
                        <span class="duration-value">6s</span>
                      </div>
                    </div>

                    <div class="duration-item">
                      <label class="field-label">Podium</label>
                      <div class="slider-group">
                        <input type="range" id="md-duration-podium" min="2" max="30" value="5" class="duration-slider" />
                        <span class="duration-value">5s</span>
                      </div>
                    </div>

                    <div class="duration-item">
                      <label class="field-label">Sponsors</label>
                      <div class="slider-group">
                        <input type="range" id="md-duration-sponsors" min="2" max="30" value="3" class="duration-slider" />
                        <span class="duration-value">3s</span>
                      </div>
                    </div>

                    <div class="duration-item">
                      <label class="field-label">Padel Pong QR</label>
                      <div class="slider-group">
                        <input type="range" id="md-duration-pong" min="2" max="30" value="2" class="duration-slider" />
                        <span class="duration-value">2s</span>
                      </div>
                    </div>
                  </div>

                  <h4 class="subsection-title">📋 Ordre de rotation</h4>
                  <div class="tvview-rotation-order" id="md-rotation-order">
                    <div class="rotation-item" draggable="true" data-block="current">
                      <span class="drag-handle">⋮⋮</span>
                      <span class="rotation-number">1.</span>
                      <span class="rotation-icon">🏓</span>
                      <span class="rotation-name">Matchs en cours</span>
                    </div>
                    <div class="rotation-item" draggable="true" data-block="ranking">
                      <span class="drag-handle">⋮⋮</span>
                      <span class="rotation-number">2.</span>
                      <span class="rotation-icon">📊</span>
                      <span class="rotation-name">Classement</span>
                    </div>
                    <div class="rotation-item" draggable="true" data-block="next">
                      <span class="drag-handle">⋮⋮</span>
                      <span class="rotation-number">3.</span>
                      <span class="rotation-icon">⏭️</span>
                      <span class="rotation-name">Prochains matchs</span>
                    </div>
                    <div class="rotation-item" draggable="true" data-block="podium">
                      <span class="drag-handle">⋮⋮</span>
                      <span class="rotation-number">4.</span>
                      <span class="rotation-icon">🏆</span>
                      <span class="rotation-name">Podium</span>
                    </div>
                  </div>

                  <div class="tvview-rotation-options">
                    <label class="tvview-block-item">
                      <input type="checkbox" id="md-pause-hover" checked />
                      <span class="block-label">
                        <span class="block-name">Pause rotation au survol de la souris</span>
                      </span>
                    </label>

                    <label class="tvview-block-item">
                      <input type="checkbox" id="md-show-progress" checked />
                      <span class="block-label">
                        <span class="block-name">Afficher indicateur de progression</span>
                      </span>
                    </label>
                  </div>

                  <h4 class="subsection-title">✨ Transition entre blocs</h4>
                  <div class="settings-grid">
                    <div class="field">
                      <label for="md-transition-type" class="field-label">Type</label>
                      <select id="md-transition-type" class="field-select">
                        <option value="fade" selected>Fade</option>
                        <option value="slide">Slide</option>
                        <option value="none">None</option>
                      </select>
                    </div>
                    <div class="field">
                      <label for="md-transition-duration" class="field-label">Durée</label>
                      <div class="slider-group">
                        <input type="range" id="md-transition-duration" min="0.1" max="2" step="0.1" value="0.5" class="duration-slider" />
                        <span class="duration-value">0.5s</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Section 2.3 : Mise en page -->
              <div class="settings-section app-block-interactive">
                <h3 class="settings-section-title">📐 Mise en page (Layout)</h3>

                <div class="tvview-layout-options">
                  <label class="layout-option">
                    <input type="radio" name="md-layout" value="fullscreen" checked />
                    <div class="layout-card">
                      <div class="layout-preview fullscreen-preview">
                        <div class="preview-block">BLOC</div>
                      </div>
                      <span class="layout-name">Plein écran</span>
                      <span class="layout-desc">1 bloc à la fois</span>
                    </div>
                  </label>

                  <label class="layout-option">
                    <input type="radio" name="md-layout" value="split-vertical" />
                    <div class="layout-card">
                      <div class="layout-preview split-v-preview">
                        <div class="preview-block">1</div>
                        <div class="preview-block">2</div>
                      </div>
                      <span class="layout-name">Split vertical</span>
                      <span class="layout-desc">2 blocs côte à côte</span>
                    </div>
                  </label>

                  <label class="layout-option">
                    <input type="radio" name="md-layout" value="split-horizontal" />
                    <div class="layout-card">
                      <div class="layout-preview split-h-preview">
                        <div class="preview-block">1</div>
                        <div class="preview-block">2</div>
                      </div>
                      <span class="layout-name">Split horizontal</span>
                      <span class="layout-desc">2 blocs haut/bas</span>
                    </div>
                  </label>

                  <label class="layout-option">
                    <input type="radio" name="md-layout" value="grid-2x2" />
                    <div class="layout-card">
                      <div class="layout-preview grid-preview">
                        <div class="preview-block">1</div>
                        <div class="preview-block">2</div>
                        <div class="preview-block">3</div>
                        <div class="preview-block">4</div>
                      </div>
                      <span class="layout-name">Grille 2x2</span>
                      <span class="layout-desc">4 blocs</span>
                    </div>
                  </label>

                  <label class="layout-option">
                    <input type="radio" name="md-layout" value="pip" />
                    <div class="layout-card">
                      <div class="layout-preview pip-preview">
                        <div class="preview-block main">Principal</div>
                        <div class="preview-block mini">Mini</div>
                      </div>
                      <span class="layout-name">Picture-in-Picture</span>
                      <span class="layout-desc">Principal + mini</span>
                    </div>
                  </label>
                </div>

                <div class="tvview-layout-extras">
                  <label class="tvview-block-item">
                    <input type="checkbox" id="md-auto-fullscreen" />
                    <span class="block-label">
                      <span class="block-name">Mode plein écran automatique (F11)</span>
                    </span>
                  </label>

                  <label class="tvview-block-item">
                    <input type="checkbox" id="md-hide-cursor" checked />
                    <span class="block-label">
                      <span class="block-name">Cacher curseur après 3s d'inactivité</span>
                    </span>
                  </label>
                </div>
              </div>

              <!-- Section 2.4 : Animations & Effets -->
              <div class="settings-section app-block-interactive">
                <h3 class="settings-section-title">✨ Animations & Effets</h3>

                <label class="tvview-block-item">
                  <input type="checkbox" id="md-animations-enabled" checked />
                  <span class="block-label">
                    <span class="block-name">Activer les animations de victoire</span>
                  </span>
                </label>

                <div id="md-animations-settings" class="tvview-animations-settings">
                  <h4 class="subsection-title">🎊 Confettis</h4>
                  <label class="tvview-block-item">
                    <input type="checkbox" id="md-confetti-enabled" checked />
                    <span class="block-label">
                      <span class="block-name">Explosion de confettis</span>
                    </span>
                  </label>

                  <div class="settings-grid">
                    <div class="field">
                      <label class="field-label">Intensité</label>
                      <div class="slider-group">
                        <input type="range" id="md-confetti-intensity" min="1" max="5" value="3" class="duration-slider" />
                        <span class="duration-value">Moyen</span>
                      </div>
                    </div>
                    <div class="field">
                      <label class="field-label">Couleurs</label>
                      <select id="md-confetti-colors" class="field-select">
                        <option value="theme" selected>Accent du thème</option>
                        <option value="rainbow">Arc-en-ciel</option>
                        <option value="gold">Or & Argent</option>
                      </select>
                    </div>
                  </div>

                  <h4 class="subsection-title">✨ Effets visuels</h4>
                  <label class="tvview-block-item">
                    <input type="checkbox" id="md-flash-enabled" checked />
                    <span class="block-label">
                      <span class="block-name">Flash sur la card du match gagnant</span>
                    </span>
                  </label>

                  <label class="tvview-block-item">
                    <input type="checkbox" id="md-badge-enabled" checked />
                    <span class="block-label">
                      <span class="block-name">Badge "NOUVEAU" sur match validé</span>
                    </span>
                  </label>

                  <label class="tvview-block-item">
                    <input type="checkbox" id="md-scale-enabled" checked />
                    <span class="block-label">
                      <span class="block-name">Animation scale + glow sur équipe gagnante</span>
                    </span>
                  </label>

                  <h4 class="subsection-title">🔊 Son de célébration</h4>
                  <label class="tvview-block-item">
                    <input type="checkbox" id="md-sound-enabled" />
                    <span class="block-label">
                      <span class="block-name">Activer le son</span>
                    </span>
                  </label>

                  <div class="settings-grid">
                    <div class="field">
                      <label class="field-label">Volume</label>
                      <div class="slider-group">
                        <input type="range" id="md-sound-volume" min="0" max="100" value="50" class="duration-slider" />
                        <span class="duration-value">50%</span>
                      </div>
                    </div>
                    <div class="field">
                      <label class="field-label">Type de son</label>
                      <select id="md-sound-type" class="field-select">
                        <option value="ding" selected>Ding court</option>
                        <option value="fanfare">Fanfare</option>
                        <option value="custom">Custom</option>
                      </select>
                    </div>
                  </div>

                  <div class="field" id="md-sound-upload-field" style="display:none;">
                    <label for="md-sound-file" class="field-label">Upload son custom (.mp3, max 50KB)</label>
                    <input id="md-sound-file" type="file" class="field-input" accept="audio/mpeg" />
                  </div>

                  <button class="btn btn-secondary btn-small" id="md-test-animation">▶ Tester l'animation</button>
                </div>
              </div>

              <!-- Section 2.5 : Éléments permanents -->
              <div class="settings-section app-block-interactive">
                <h3 class="settings-section-title">📌 Éléments permanents</h3>

                <h4 class="subsection-title">Header (bandeau haut)</h4>
                <label class="tvview-block-item">
                  <input type="checkbox" id="md-header-enabled" checked />
                  <span class="block-label">
                    <span class="block-name">Afficher header</span>
                  </span>
                </label>

                <div id="md-header-settings" class="settings-grid-3">
                  <div class="field">
                    <label class="field-label">Logo club</label>
                    <select id="md-header-logo-pos" class="field-select">
                      <option value="left" selected>Gauche</option>
                      <option value="center">Centre</option>
                      <option value="right">Droite</option>
                      <option value="none">Masqué</option>
                    </select>
                  </div>
                  <div class="field">
                    <label class="field-label">Nom tournoi</label>
                    <select id="md-header-name-pos" class="field-select">
                      <option value="left">Gauche</option>
                      <option value="center" selected>Centre</option>
                      <option value="right">Droite</option>
                      <option value="none">Masqué</option>
                    </select>
                  </div>
                  <div class="field">
                    <label class="field-label">Heure actuelle</label>
                    <select id="md-header-time-pos" class="field-select">
                      <option value="left">Gauche</option>
                      <option value="center">Centre</option>
                      <option value="right" selected>Droite</option>
                      <option value="none">Masqué</option>
                    </select>
                  </div>
                </div>

                <label class="tvview-block-item">
                  <input type="checkbox" id="md-header-live-badge" checked />
                  <span class="block-label">
                    <span class="block-name">Badge "🔴 LIVE"</span>
                  </span>
                </label>

                <h4 class="subsection-title">Footer (bandeau bas)</h4>
                <label class="tvview-block-item">
                  <input type="checkbox" id="md-footer-enabled" />
                  <span class="block-label">
                    <span class="block-name">Afficher footer</span>
                  </span>
                </label>

                <div id="md-footer-settings" style="display:none;">
                  <div class="field">
                    <label for="md-footer-text" class="field-label">Texte personnalisé</label>
                    <input id="md-footer-text" type="text" class="field-input" placeholder="Merci aux partenaires..." />
                  </div>
                  <div class="field">
                    <label class="field-label">Alignement</label>
                    <select id="md-footer-align" class="field-select">
                      <option value="left">Gauche</option>
                      <option value="center" selected>Centre</option>
                      <option value="right">Droite</option>
                    </select>
                  </div>
                </div>

                <div class="tvview-permanent-note">
                  <p class="field-hint">
                    ℹ️ Configuration détaillée des sponsors et Padel Pong dans l'onglet "💼 Sponsors"
                  </p>
                </div>
              </div>

              <!-- Section 2.6 : Gestion des configurations -->
              <div class="settings-section app-block-interactive">
                <h3 class="settings-section-title">💾 Gestion des configurations</h3>

                <div class="field">
                  <label for="md-config-name" class="field-label">Nom de cette configuration</label>
                  <input id="md-config-name" type="text" class="field-input" value="Configuration standard M/D" />
                </div>

                <div class="tvview-config-actions">
                  <button class="btn btn-primary" id="md-save-config">💾 Sauvegarder cette config</button>
                  <button class="btn btn-secondary" id="md-duplicate-config">📋 Dupliquer</button>
                  <button class="btn btn-danger" id="md-reset-config">🔄 Réinitialiser par défaut</button>
                </div>

                <h4 class="subsection-title">📚 Mes configurations sauvegardées</h4>
                <div id="md-saved-configs" class="tvview-saved-configs">
                  <div class="empty-state">
                    <p>💾</p>
                    <p>Aucune configuration sauvegardée</p>
                  </div>
                </div>

                <h4 class="subsection-title">📤 Appliquer à d'autres modes</h4>
                <div class="tvview-apply-modes">
                  <label class="tvview-block-item">
                    <input type="checkbox" id="md-apply-to-classic" />
                    <span class="block-label">
                      <span class="block-name">Tournoi Classique</span>
                    </span>
                  </label>
                  <label class="tvview-block-item">
                    <input type="checkbox" id="md-apply-to-americano" />
                    <span class="block-label">
                      <span class="block-name">Américano</span>
                    </span>
                  </label>
                  <button class="btn btn-secondary" id="md-apply-to-modes">📤 Appliquer aux modes sélectionnés</button>
                </div>

                <h4 class="subsection-title">Import/Export</h4>
                <div class="tvview-import-export">
                  <button class="btn btn-secondary" id="md-import-config">📥 Importer config</button>
                  <input type="file" id="md-import-file" accept=".json" style="display:none;" />
                  <button class="btn btn-secondary" id="md-export-config">📤 Exporter cette config</button>
                </div>
              </div>

            </div>

            <!-- Mode Tournoi Classique Config (copy of MD with different IDs) -->
            <div class="tvview-mode-panel" data-mode="classic">
              <div class="settings-section app-block-interactive">
                <p class="field-hint">Configuration similaire au mode M/D avec blocs spécifiques au tournoi classique</p>
                <p style="color: var(--muted); font-style: italic;">
                  Section en cours de développement - Utilisez la config M/D comme template et appliquez-la ici
                </p>
              </div>
            </div>

            <!-- Mode Américano Config -->
            <div class="tvview-mode-panel" data-mode="americano">
              <div class="settings-section app-block-interactive">
                <p class="field-hint">Configuration similaire au mode M/D avec blocs spécifiques à l'Américano</p>
                <p style="color: var(--muted); font-style: italic;">
                  Section en cours de développement - Utilisez la config M/D comme template et appliquez-la ici
                </p>
              </div>
            </div>

          </div>

        </div><!-- End panels -->
      </div><!-- End shell -->
    </section>

    <!-- PAGE ADMIN M/D -->
    <section id="admin-root">
      <div class="mode-toggle">
        <button class="btn btn-secondary btn-small" id="btn-back-home-from-md">🏠 Accueil</button>
        <button id="btn-go-tv" class="btn btn-secondary btn-small">🎥 Vue TV</button>
        <button id="btn-toggle-md-timer" class="btn btn-secondary btn-small">⏱ Timer M/D</button>
      </div>

      <div class="grid">
        <div class="card app-block-interactive">
          <h2>Configuration du tournoi M/D</h2>
          <p>Choisis ton nombre d’équipes (entre 6 et 16) et le nombre de roulements.</p>

          <div class="field">
            <label for="tournament-name">Nom du tournoi</label>
            <input id="tournament-name" type="text" placeholder="Tournoi du vendredi soir" />
          </div>

          <div class="field">
            <label for="team-count">Nombre d’équipes</label>
            <select id="team-count"></select>
          </div>

          <div class="field">
            <label for="max-roulements">Nombre de roulements</label>
            <select id="max-roulements">
              <option value="6">6</option>
              <option value="8" selected>8</option>
              <option value="10">10</option>
              <option value="12">12</option>
              <option value="14">14</option>
              <option value="16">16</option>
            </select>
          </div>

          <button class="btn" id="btn-init-teams">Configurer les équipes</button>
        </div>

        <div class="card app-block-interactive">
          <h2>Équipes</h2>
          <p>Tu peux renommer les équipes avant de lancer le tournoi.</p>
          <div id="teams-edit" class="teams-edit">
            <div class="empty">Configure d’abord le nombre d’équipes.</div>
          </div>
          <div style="margin-top:8px; display:flex; justify-content:space-between; gap:6px;">
            <div class="small-muted" id="teams-info"></div>
            <button class="btn btn-secondary btn-small" id="btn-random-names">Noms aléatoires</button>
          </div>
          <div style="margin-top:8px; text-align:right;">
            <button class="btn" id="btn-start" disabled>🚀 Lancer la M/D</button>
          </div>
        </div>

        <div class="card md-timer-panel app-block-interactive" id="md-timer-panel" style="display:none;">
          <h2>Timer M/D</h2>
          <p>Définis la durée d’un roulement et lance le compte à rebours.</p>
          <div class="field">
            <label for="md-timer-select">Durée (minutes)</label>
            <select id="md-timer-select">
              <option value="10">10</option>
              <option value="15" selected>15</option>
              <option value="20">20</option>
              <option value="25">25</option>
            </select>
          </div>
          <div class="field">
            <label for="md-timer-custom">Durée personnalisée (minutes)</label>
            <input type="number" min="1" step="1" id="md-timer-custom" placeholder="Entrer une durée" />
          </div>
          <div class="md-timer-controls">
            <div class="chip" id="md-timer-display">15:00</div>
            <button class="btn btn-small" id="md-timer-start">Lancer le timer</button>
            <button class="btn btn-secondary btn-small" id="md-timer-pause">Mettre en pause</button>
            <button class="btn btn-secondary btn-small" id="md-timer-reset">Réinitialiser</button>
          </div>
        </div>
      </div>

      <div id="tournament-section" class="card app-block-interactive" style="margin-top:12px; display:none;">
        <h2 id="title-tournament">Tournoi</h2>
        <p id="subtitle-tournament" style="margin-bottom:6px;"></p>

        <div class="top-bar">
          <div class="chip" id="chip-roulement">Roulement 1 / 8</div>
          <div class="chip" id="chip-teams">0 équipe</div>
        </div>

        <div class="layout-matches">
          <div>
            <h3 style="font-size:0.9rem; text-transform:uppercase; letter-spacing:0.14em; margin-top:8px; margin-bottom:4px;">
              Matchs du roulement <span id="label-roulement">1</span>
            </h3>
            <div id="matches-grid" class="match-grid">
              <div class="empty">Aucun match pour l’instant.</div>
            </div>

            <div style="margin-top:8px;">
              <div style="font-size:0.8rem; text-transform:uppercase; letter-spacing:0.14em; color:var(--blue-soft); margin-bottom:3px;">
                Équipes au repos
              </div>
              <div id="rest-list" class="rest-list"></div>
            </div>

            <div style="margin-top:8px; display:flex; gap:6px; justify-content:space-between; align-items:center;">
              <button class="btn btn-secondary btn-small" id="btn-prev-round">◀ Roulement précédent</button>
              <button class="btn btn-small" id="btn-next-round">Roulement suivant ▶</button>
            </div>

            <div class="small-muted">
              Astuce : clique sur “Vainqueur” pour attribuer 3 points. Les affiches sont fixées par roulement,
              les points servent à organiser les roulements suivants.
            </div>
          </div>

          <div>
            <h3 style="font-size:0.9rem; text-transform:uppercase; letter-spacing:0.14em; margin-top:8px; margin-bottom:4px;">
              Classement général
            </h3>
            <div id="ranking" class="ranking-list">
              <div class="empty">Le classement apparaîtra dès les premiers résultats.</div>
            </div>
            <div class="small-muted">
              3 pts par victoire. Le moteur équilibre le nombre de matchs joués et les repos.
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- PAGE TOURNOIS CLASSIQUES (mise en page seule) -->
    <section id="tournaments-root">
      <div class="tournaments-header">
        <div>
          <div style="font-size:0.9rem; text-transform:uppercase; letter-spacing:0.14em;">
            Tournois classiques
          </div>
          <div class="small-muted">
            Choisis un format de tournoi. Les moteurs arriveront progressivement.
          </div>
        </div>
        <button class="btn btn-secondary btn-small" id="btn-back-home-from-tournaments">🏠 Accueil</button>
      </div>

      <div class="tournaments-grid">
        <article class="tournament-type-card app-block-interactive">
          <div class="tournament-type-title">
            <span>Poules + phases finales</span>
            <span class="tournament-type-pill">Idéal 8–32 équipes</span>
          </div>
          <p>
            Les équipes sont réparties en poules, tout le monde se rencontre, puis
            les meilleures équipes accèdent à un tableau de phases finales.
          </p>
          <div style="display:flex; justify-content:space-between; align-items:center; margin-top:4px;">
            <span class="small-muted">Version actuelle intégrée</span>
            <button class="btn btn-small" id="btn-open-classic">▶ Ouvrir</button>
          </div>
        </article>

        <article class="tournament-type-card app-block-interactive">
          <div class="tournament-type-title">
            <span>Élimination directe</span>
            <span class="tournament-type-pill">Tableau KO</span>
          </div>
          <p>
            Un tableau type “Coupe du Monde” : 1/8 de finale, 1/4, 1/2,
            finale. Possibilité de petits tableaux pour les perdants.
          </p>
          <div style="display:flex; justify-content:space-between; align-items:center; margin-top:4px;">
            <span class="small-muted">Disponible bientôt</span>
            <button class="btn btn-small" disabled>🚧 En cours</button>
          </div>
        </article>

        <article class="tournament-type-card app-block-interactive">
          <div class="tournament-type-title">
            <span>Américano</span>
            <span class="tournament-type-pill">Tous vs tous</span>
          </div>
          <p>
            Chaque équipe affronte toutes les autres une fois, classement en direct
            et vue TV dédiée.
          </p>
          <div style="display:flex; justify-content:space-between; align-items:center; margin-top:4px;">
            <span class="small-muted">Nouveau moteur complet</span>
            <button class="btn btn-small" id="btn-open-americano">▶ Ouvrir</button>
          </div>
        </article>

        <article class="tournament-type-card app-block-interactive">
          <div class="tournament-type-title">
            <span>Mode “Fun Night”</span>
            <span class="tournament-type-pill">Mix & rotation</span>
          </div>
          <p>
            Format plus léger pour les soirées découverte : matchs courts,
            équipes remixées, rotations automatiques sur les terrains.
          </p>
          <div style="display:flex; justify-content:space-between; align-items:center; margin-top:4px;">
            <span class="small-muted">Disponible bientôt</span>
            <button class="btn btn-small" disabled>🚧 En cours</button>
          </div>
        </article>
      </div>
    </section>

    <!-- MODE AMERICANO -->
    <section id="americano-root" style="display:none;">
      <div class="mode-toggle" style="justify-content:flex-start; margin-bottom:8px;">
        <button class="btn btn-secondary btn-small" id="btn-americano-home">🏠 Accueil</button>
        <button class="btn btn-secondary btn-small" id="btn-americano-formats">🏆 Formats</button>
        <button class="btn btn-secondary btn-small" id="btn-americano-open-tv">🎥 Vue TV</button>
      </div>

      <div class="card app-block-interactive" style="margin-bottom:10px;">
        <div class="tournaments-header" style="margin-bottom:4px;">
          <div>
            <div class="tournaments-subtitle">Tournoi classique</div>
            <h1 class="tournaments-title">Mode Américano</h1>
          </div>
          <div class="americano-inline" style="gap:6px;">
            <div class="americano-chip" id="americano-meta">0 équipes • 0 matchs</div>
            <div class="americano-chip" id="americano-round-meta">Planning non généré</div>
          </div>
        </div>
        <div class="small-muted">Chaque équipe affronte toutes les autres une fois. Classement live et vue TV synchronisée.</div>
      </div>

      <nav class="americano-tabs">
        <button class="americano-tab-btn active" data-americano-tab="organization">Organisation</button>
        <button class="americano-tab-btn" data-americano-tab="teams">Équipes</button>
        <button class="americano-tab-btn" data-americano-tab="standings">Classement</button>
        <button class="americano-tab-btn" data-americano-tab="matches">Matchs & Scores</button>
      </nav>

      <section id="americano-tab-organization" class="americano-tab-panel active" data-americano-tab-panel="organization">
        <div class="card app-block-interactive americano-card">
          <div class="americano-card-header">
            <div>
              <h3 class="tournaments-title" style="margin-bottom:6px;">Organisation & timer</h3>
              <div class="small-muted">Paramètres, génération et timer synchronisé</div>
            </div>
            <button class="collapse-toggle americano-collapse americano-collapse-btn" data-target="americano-config-body">−</button>
          </div>
          <div id="americano-config-body" class="americano-card-body">
            <div class="field">
              <label for="americano-name">Nom du tournoi</label>
              <input type="text" id="americano-name" placeholder="Américano du vendredi" />
            </div>
            <div class="field">
              <label for="americano-team-count">Nombre d’équipes (8 à 24)</label>
              <select id="americano-team-count"></select>
            </div>
            <div class="field">
              <label for="americano-games">Jeux gagnants</label>
              <select id="americano-games">
                <option value="4">4 jeux</option>
                <option value="6" selected>6 jeux</option>
                <option value="9">9 jeux</option>
              </select>
            </div>
            <div class="americano-inline" style="justify-content:flex-start;">
              <button class="btn" id="btn-americano-generate">Générer le planning</button>
              <button class="btn btn-secondary" id="btn-americano-reset">Réinitialiser</button>
            </div>
            <div class="americano-section">
              <h4 class="tournaments-title" style="margin-bottom:6px;">Timer</h4>
              <div class="field">
                <label for="americano-timer-minutes">Durée (minutes)</label>
                <input type="number" id="americano-timer-minutes" min="1" value="12" />
              </div>
              <div class="americano-inline" style="justify-content:flex-start; gap:10px;">
                <div class="chip" id="americano-timer-display">12:00</div>
                <button class="btn btn-small" id="btn-americano-timer-start">Lancer</button>
                <button class="btn btn-secondary btn-small" id="btn-americano-timer-pause">Pause</button>
                <button class="btn btn-secondary btn-small" id="btn-americano-timer-reset">Réinitialiser</button>
              </div>
              <div class="small-muted" id="americano-timer-status" style="margin-top:4px;">Timer prêt</div>
            </div>
          </div>
        </div>
      </section>

      <section id="americano-tab-teams" class="americano-tab-panel" data-americano-tab-panel="teams">
        <div class="card app-block-interactive americano-card">
          <div class="americano-card-header">
            <div>
              <h3 class="tournaments-title" style="margin-bottom:6px;">Création des équipes</h3>
              <div class="small-muted">1 nom par équipe • saisie directe</div>
            </div>
            <button class="collapse-toggle americano-collapse americano-collapse-btn" data-target="americano-teams-body">−</button>
          </div>
          <div id="americano-teams-body" class="americano-card-body">
            <div class="americano-inline" style="justify-content:flex-start;">
              <button class="btn btn-secondary btn-small" id="btn-americano-random-teams">Générer les équipes aléatoires</button>
              <button class="btn btn-small" id="btn-americano-random-names">Noms aléatoires</button>
            </div>
            <div id="americano-team-hint" class="small-muted" style="margin-top:4px;"></div>
            <div class="americano-section">
              <div class="americano-inline" style="margin-bottom:6px;">
                <h4 class="tournaments-title">Équipes</h4>
                <div class="small-muted">Saisis directement les noms</div>
              </div>
              <div id="americano-teams-list" class="americano-teams-grid"></div>
            </div>
          </div>
        </div>
      </section>

      <section id="americano-tab-standings" class="americano-tab-panel" data-americano-tab-panel="standings">
        <div class="card app-block-interactive americano-card">
          <div class="americano-card-header">
            <div>
              <h3 class="tournaments-title">Classement</h3>
              <div class="small-muted">Victoires, goal-average, confrontations directes</div>
            </div>
            <button class="collapse-toggle americano-collapse americano-collapse-btn" data-target="americano-standings-body">−</button>
          </div>
          <div id="americano-standings-body" class="americano-card-body">
            <table class="ligue-standings" id="americano-standings"></table>
          </div>
        </div>
      </section>

      <section id="americano-tab-matches" class="americano-tab-panel" data-americano-tab-panel="matches">
        <div class="card app-block-interactive americano-card">
          <div class="americano-card-header">
            <div class="americano-inline" style="margin-bottom:6px;">
              <h3 class="tournaments-title">Matchs & scores</h3>
              <div class="americano-chip" id="americano-status">Planning à générer</div>
            </div>
            <button class="collapse-toggle americano-collapse americano-collapse-btn" data-target="americano-matches-body">−</button>
          </div>
          <div id="americano-matches-body" class="americano-card-body">
            <div class="small-muted" style="margin-bottom:6px;">Scores validés = classement mis à jour instantanément. 4 terrains par roulement.</div>
            <div class="americano-rounds-nav">
              <button class="btn btn-secondary btn-small" id="americano-rounds-prev">⟵ Précédent</button>
              <div class="small-muted" id="americano-rounds-indicator">Roulements 0–0</div>
              <button class="btn btn-secondary btn-small" id="americano-rounds-next">Suivant ⟶</button>
            </div>
            <div class="americano-rounds" id="americano-rounds"></div>
            <div class="americano-inline" style="margin-top:8px; justify-content:flex-end;">
              <button class="btn btn-secondary btn-small" id="btn-americano-random-scores">Générer les scores aléatoires</button>
            </div>
          </div>
        </div>
      </section>
    </section>

    <!-- VUE TV AMERICANO -->
    <section id="americano-tv-root" style="display:none;">
      <header class="tv-header">
        <div class="tv-header-left">
          <img id="americano-tv-logo" alt="Logo club TV" />
          <div class="tv-title-block">
            <div id="americano-tv-name">Américano</div>
            <div id="americano-tv-meta">Matchs en direct</div>
          </div>
        </div>
        <div class="tv-header-right">
          <div class="tv-tag-live">🔴 LIVE</div>
          <div class="tv-tag-live" id="americano-tv-timer">00:00</div>
          <button id="btn-americano-tv-back" class="btn btn-secondary btn-small">↩ Mode admin</button>
        </div>
      </header>

      <div id="americano-tv-sponsor-banner" class="tv-sponsor">
        <img id="americano-tv-sponsor-logo" alt="Sponsor" />
        <div class="tv-sponsor-name" id="americano-tv-sponsor-name"></div>
      </div>

      <main class="tv-main">
        <section class="tv-column">
          <div class="tv-block">
            <div class="tv-block-title">
              <span>Matchs en cours</span>
              <span>Roulement <span id="americano-tv-round">1</span></span>
            </div>
            <div id="americano-tv-current" class="tv-current-list">
              <div class="tv-empty">Génère le planning puis lance les scores.</div>
            </div>
          </div>
        </section>

        <section class="tv-column">
          <div class="tv-block">
            <div class="tv-block-title">
              <span>Matchs à venir</span>
              <span>Prochain roulement</span>
            </div>
            <div id="americano-tv-next" class="tv-next-list">
              <div class="tv-empty">Les prochains matchs apparaîtront ici.</div>
            </div>
          </div>

          <div class="tv-block">
            <div class="tv-block-title">
              <span>Classement</span>
              <span>Live</span>
            </div>
            <!-- TV UI : podium premium + reste du classement -->
            <div id="americano-tv-podium" class="tv-podium tv-podium-premium"></div>
            <div id="americano-tv-ranking-rest" class="tv-ranking-grid"></div>
          </div>
        </section>
      </main>
    </section>

    <!-- TOURNOI CLASSIQUE COMPLET -->
    <section id="classic-root">
      <div class="mode-toggle" style="justify-content:flex-start; margin-bottom:8px;">
        <button class="btn btn-secondary btn-small" id="btn-back-home-from-classic">🏠 Accueil</button>
        <button class="btn btn-secondary btn-small" id="btn-back-formats-from-classic">🏆 Formats</button>
      </div>
        <div class="app">
    <header class="app-header">
      <div class="app-header-main">
        <div class="logo-wrapper is-display">
          <img id="logo-preview" alt="Logo centre" />
        </div>
        <div class="app-header-text">
          <h1>Tournoi classique</h1>
          <div class="subtitle" id="admin-subtitle">Poules + tableaux • … équipes</div>
          <div class="small-muted">Logo géré dans l’onglet ⚙️ Paramètres.</div>
        </div>
      </div>
      <div class="header-right">
        <div class="header-actions">
          <div id="header-tournament-name" class="header-tournament-name">TOURNOI DE PADEL</div>
          <button id="btn-open-tv" class="btn btn-secondary">🎥 Vue TV</button>
        </div>
      </div>
    </header>

    <nav class="tabs">
      <button class="tab-btn active" data-tab="config">Configuration</button>
      <button class="tab-btn disabled" data-tab="poules">Phases de poules</button>
      <button class="tab-btn disabled" data-tab="main">Tableau principal</button>
      <button class="tab-btn disabled" data-tab="conso">Tableau consolante</button>
      <button class="tab-btn disabled" data-tab="classement">Classement final</button>
    </nav>

    <!-- CONFIG TAB -->
    <section id="tab-config" class="tab-panel active">
      <article class="card">
        <div class="card-header">
          <div class="card-header-title">
            <h2>Configuration du tournoi</h2>
            <p>Nom du tournoi, équipes, paramètres de sets/jeux et terrains par poule.</p>
          </div>
          <button class="collapse-toggle" data-target="config-body">−</button>
        </div>
        <div id="config-body" class="card-body">
          <div class="layout-config">
            <div>
              <div class="field">
                <label for="tournament-name">Nom du tournoi</label>
                <input id="tournament-name" type="text" placeholder="Tournoi Padel Parc – Samedi" />
              </div>

              <div class="field">
                <label for="team-count">Nombre d’équipes</label>
                <select id="team-count">
                  <option value="8">8 équipes</option>
                  <option value="10">10 équipes</option>
                  <option value="12">12 équipes</option>
                  <option value="14">14 équipes</option>
                  <option value="16" selected>16 équipes</option>
                  <option value="18">18 équipes</option>
                  <option value="20">20 équipes</option>
                  <option value="22">22 équipes</option>
                  <option value="24">24 équipes</option>
                </select>
              </div>

              <div class="field">
                <label for="sets-per-match">Nombre de sets par match</label>
                <select id="sets-per-match">
                  <option value="1">1 set (format rapide)</option>
                  <option value="2">2 sets (format spécifique)</option>
                  <option value="3" selected>3 sets (classique)</option>
                </select>
              </div>

              <div class="field">
                <label for="games-per-set">Nombre de jeux par set (max)</label>
                <select id="games-per-set">
                  <option value="4">4 jeux</option>
                  <option value="5">5 jeux</option>
                  <option value="6" selected>6 jeux (standard)</option>
                  <option value="7">7 jeux</option>
                </select>
              </div>

              <div class="field">
                <label>Affectation des terrains (optionnel)</label>
                <div class="terrain-grid">
                  <div>
                    <span class="small-muted">Poule A → Terrain</span>
                    <select id="terrain-pool-A">
                      <option value="">Aucun</option>
                      <option value="1">Terrain 1</option>
                      <option value="2">Terrain 2</option>
                      <option value="3">Terrain 3</option>
                      <option value="4">Terrain 4</option>
                    </select>
                  </div>
                  <div>
                    <span class="small-muted">Poule B → Terrain</span>
                    <select id="terrain-pool-B">
                      <option value="">Aucun</option>
                      <option value="1">Terrain 1</option>
                      <option value="2">Terrain 2</option>
                      <option value="3">Terrain 3</option>
                      <option value="4">Terrain 4</option>
                    </select>
                  </div>
                  <div>
                    <span class="small-muted">Poule C → Terrain</span>
                    <select id="terrain-pool-C">
                      <option value="">Aucun</option>
                      <option value="1">Terrain 1</option>
                      <option value="2">Terrain 2</option>
                      <option value="3">Terrain 3</option>
                      <option value="4">Terrain 4</option>
                    </select>
                  </div>
                  <div>
                    <span class="small-muted">Poule D → Terrain</span>
                    <select id="terrain-pool-D">
                      <option value="">Aucun</option>
                      <option value="1">Terrain 1</option>
                      <option value="2">Terrain 2</option>
                      <option value="3">Terrain 3</option>
                      <option value="4">Terrain 4</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="small-muted">
                Le classement des poules utilise : <b>3 pts par victoire</b>, puis le total de <b>jeux gagnés</b> sur tous les matchs.
              </div>
            </div>

            <div>
              <div class="field">
                <label>Équipes (16)</label>
                <div id="teams-grid" class="teams-grid"></div>
              </div>

              <div style="display:flex; justify-content:space-between; align-items:center; gap:8px; margin-top:4px;">
                <button id="btn-random-names" class="btn btn-secondary btn-small">Noms aléatoires</button>
                <button id="btn-generate-pools" class="btn">🚀 Générer les poules</button>
              </div>

              <div id="config-info" class="small-muted" style="margin-top:8px;">
                Les poules seront A, B, C, D avec 4 équipes chacune. L’ordre des matchs est optimisé pour éviter de jouer plus de 2 fois de suite.
              </div>
            </div>
          </div>
        </div>
      </article>

      <!-- HISTORIQUE (indépendant mais dans configuration) -->
      <section class="history-standalone">
        <article class="card">
          <div class="card-header">
            <div class="card-header-title">
              <h2>Historique des tournois</h2>
              <p>Sauvegarde locale, chargement et suppression des tournois.</p>
            </div>
            <button class="collapse-toggle" data-target="history-body">−</button>
          </div>
          <div id="history-body" class="card-body">
            <div style="display:flex; gap:8px; margin-bottom:10px; flex-wrap:wrap;">
              <button id="btn-save-history" class="btn">💾 Sauvegarder le tournoi actuel</button>
              <span class="small-muted">Les données sont stockées uniquement dans ton navigateur.</span>
            </div>
            <div id="history-list" class="card app-block-interactive" style="background:transparent; border:1px dashed var(--border);"></div>
          </div>
        </article>
      </section>
    </section>

    <!-- POULES TAB -->
    <section id="tab-poules" class="tab-panel">
      <article class="card">
        <div class="card-header">
          <div class="card-header-title">
            <h2>Phases de poules</h2>
            <p>Classement, prochain match par poule, et liste complète des 6 matchs.</p>
          </div>
          <div style="display:flex;gap:6px;align-items:center;">
            <span id="pools-status" class="chip">Étape 1/3 : Poules</span>
            <button id="btn-random-pools" class="btn btn-secondary btn-small" style="opacity:0.7;">🎲 Scores aléatoires</button>
            <button class="collapse-toggle" data-target="pools-body">−</button>
          </div>
        </div>
        <div id="pools-body" class="card-body">
          <div style="display:flex;justify-content:flex-end;align-items:center;gap:8px;margin-bottom:6px;">
            <button id="btn-generate-brackets" class="btn btn-small" disabled>Créer les tableaux</button>
          </div>
          <div id="pools-grid" class="pools-grid">
            <div class="empty">Commence par générer les poules dans l’onglet Configuration.</div>
          </div>
        </div>
      </article>
    </section>

    <!-- TABLEAU PRINCIPAL TAB -->
    <section id="tab-main" class="tab-panel">
      <article class="card">
        <div class="card-header">
          <div class="card-header-title">
            <h2>Tableau principal (1–8)</h2>
            <p>Arbre horizontal : quarts → demis → finale & matchs de classement.</p>
          </div>
          <div style="display:flex;gap:6px;align-items:center;">
            <span id="brackets-status" class="chip">Étape 2/3 : Tableaux à générer</span>
            <button class="collapse-toggle" data-target="main-body">−</button>
          </div>
        </div>
        <div id="main-body" class="card-body">
          <div id="bracket-main-container">
            <div class="empty">Les tableaux apparaîtront après la validation de tous les matchs de poules.</div>
          </div>
        </div>
      </article>
    </section>

    <!-- TABLEAU CONSOLANTE TAB -->
    <section id="tab-conso" class="tab-panel">
      <article class="card">
        <div class="card-header">
          <div class="card-header-title">
            <h2>Tableau consolante (9–16)</h2>
            <p>Arbre horizontal + matchs de classement.</p>
          </div>
          <button class="collapse-toggle" data-target="conso-body">−</button>
        </div>
        <div id="conso-body" class="card-body">
          <div id="bracket-conso-container" class="bracket-card">
            <div class="empty">Les tableaux apparaîtront après la validation de tous les matchs de poules.</div>
          </div>
        </div>
      </article>
    </section>
    <!-- CLASSEMENT TAB -->
    <section id="tab-classement" class="tab-panel">
      <article class="card" id="final-ranking-container" style="display:none;">
        <div class="card-header">
          <div class="card-header-title">
            <h2>Classement final</h2>
            <p>Podium des 3 premiers et classement complet de toutes les équipes.</p>
          </div>
          <button class="collapse-toggle" data-target="classement-body">−</button>
        </div>
        <div id="classement-body" class="card-body">
          <div id="classement-phrase" class="classement-phrase">
            Merci à nos partenaires et à tous les joueurs !
          </div>
          <div class="field" style="margin-top:10px;">
            <label for="classement-message">Texte au-dessus du podium</label>
            <input id="classement-message" type="text" value="Merci à nos partenaires et à tous les joueurs !" />
          </div>

          <div id="classement-podium" class="classement-podium" style="margin-top:14px;"></div>

          <div style="margin-top:18px;">
            <h3 id="final-ranking-title" style="font-size:14px; text-transform:uppercase; letter-spacing:0.16em; margin-bottom:4px; font-weight:700; color:#ffffff;">
              Classement complet (1 → …)
            </h3>
            <div id="final-ranking-list"></div>
          </div>
        </div>
      </article>
    </section>

  </div>

  <!-- Générateur QR minimal pour Padel Pong -->
  <script>
    /*! QRCode.js v1.0.0 (minimal inline copy) */
    (function(){function d(a){this.mode=c.MODE_8BIT_BYTE;this.data=a}function e(a,c){this.typeNumber=a;this.errorCorrectLevel=c;this.modules=null;this.moduleCount=0;this.dataCache=null;this.dataList=[]}var c={};d.prototype={getLength:function(a){return this.data.length},write:function(a){for(var c=0;c<this.data.length;c++)a.put(this.data.charCodeAt(c),8)}};c.PAD0=236;c.PAD1=17;c.createData=function(a,b,d){for(var f=b.getRSBlocks(a,d),g=new b.Buffer,o=0;o<d.length;o++)b.dataList.push(d[o]);for(o=0;o<b.dataList.length;o++)d=b.dataList[o],g.put(d.mode,4),g.put(d.getLength(b.typeNumber),b._getLengthInBits(d.mode)),d.write(g);for(o=0;o<f.length;o++){d=f[o].dataCount;var h=f[o].totalCount-d;g.put(0,8*d)}for(;g.getLengthInBits()<=8*f.reduce(function(a,b){return a+b.totalCount},0);)g.put(0,1);return b.createBytes(g,f)};c._getErrorCorrectPolynomial=function(a){for(var b=new c.Polynomial([1],0),d=0;d<a;d++)b=b.multiply(new c.Polynomial([1,c.gexp(d)],0));return b};c.glog=function(a){if(1>a)throw"glog("+a+")";return c.LOG_TABLE[a]};c.gexp=function(a){for(;0>a;)a+=255;for(;256<=a;)a-=255;return c.EXP_TABLE[a]};c.stringToBytes=function(a){for(var c=[],b=0;b<a.length;b++){var d=a.charCodeAt(b);c.push(d)}return c};c.Polynomial=function(a,b){if(void 0==a.length)throw"not set rawPoly";for(var d=0;d<a.length&&0==a[d];)d++;this.num=new Array(a.length-d+b);for(var e=0;e<a.length-d;e++)this.num[e]=a[e+d]};c.Polynomial.prototype={get:function(a){return this.num[a]},getLength:function(){return this.num.length},multiply:function(a){for(var b=new Array(this.getLength()+a.getLength()-1),d=0;d<this.getLength();d++)for(var e=0;e<a.getLength();e++)b[d+e]^=c.gexp(c.glog(this.get(d))+c.glog(a.get(e)));return new c.Polynomial(b,0)},mod:function(a){if(0>this.getLength()-a.getLength())return this;for(var b=new Array(this.getLength()),d=0;d<this.getLength();d++)b[d]=this.get(d);for(;0<=b.length-a.getLength();){for(var e=c.glog(b[0])-c.glog(a.get(0)),f=0;f<a.getLength();f++)b[f]^=c.gexp(c.glog(a.get(f))+e);for(;0<b.length&&0==b[0];)b.shift()}return new c.Polynomial(b,0)}};c.Math={};c.Math.gcd=function(a,b){for(;0!=b;){var d=a% b;a=b;b=d}return a};e.prototype={addData:function(a){this.dataList.push(new d(a));this.dataCache=null},isDark:function(a,c){if(0>a||this.moduleCount<=a||0>c||this.moduleCount<=c)throw a+","+c;return this.modules[a][c]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(a,c){this.moduleCount=4*this.typeNumber+17;this.modules=new Array(this.moduleCount);for(var b=0;b<this.moduleCount;b++){this.modules[b]=new Array(this.moduleCount);for(var d=0;d<this.moduleCount;d++)this.modules[b][d]=null}this.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.setupPositionAdjustPattern();this.setupTimingPattern();this.setupTypeInfo(a,c);7<=this.typeNumber&&this.setupTypeNumber(a);null==this.dataCache&&(this.dataCache=c.createData(this.typeNumber,this.errorCorrectLevel,this.dataList));this.mapData(this.dataCache,c)},setupPositionProbePattern:function(a,c){for(var b=-1;7>=b;b++)if(!(-1>=a+b||this.moduleCount<=a+b))for(var d=-1;7>=d;d++)-1>=c+d||this.moduleCount<=c+d||(this.modules[a+b][c+d]=0<=b&&b<=6&&(0==d||6==d)||0<=d&&d<=6&&(0==b||6==b)||2<=b&&b<=4&&2<=d&&d<=4)},getBestMaskPattern:function(){for(var a=0,b=0,d=0;8>d;d++){this.makeImpl(!0,d);var e=c.Util.getLostPoint(this);if(0==d||a>e)a=e,b=d}return b},createBytes:function(a,b){for(var d=0,e=0,f=0;f<b.length;f++)d+=b[f].dataCount,e+=b[f].totalCount;for(var g=new Array(e),h=0,n=0,f=0;f<b.length;f++){var k=b[f].dataCount,p=b[f].totalCount-k,r=new Array(k);for(n=0;n<r.length;n++)r[n]=255&a.buffer[n+h];h+=k;n=c.getErrorCorrectPolynomial(p);k=(new c.Polynomial(r,0)).mod(n).num;for(n=0;n<k.length;n++)g[n+p*f]=k[n];for(n=0;n<r.length;n++)g[n]=r[n]}return g},setupPositionAdjustPattern:function(){for(var a=c.Pattern.getPatternPosition(this.typeNumber),b=0;b<a.length;b++)for(var d=0;d<a.length;d++){var e=a[b],f=a[d];if(null==this.modules[e][f])for(var g=-2;2>=g;g++)for(var h=-2;2>=h;h++)this.modules[e+g][f+h]=-2==g||2==g||-2==h||2==h||0==g&&0==h}},setupTimingPattern:function(){for(var a=8;a<this.moduleCount-8;a++)null==this.modules[a][6]&&(this.modules[a][6]=0==a%2),null==this.modules[6][a]&&(this.modules[6][a]=0==a%2)},setupTypeNumber:function(a){for(var b=c.Util.getBCHTypeNumber(this.typeNumber),d=0;18>d;d++){var e=!a&&1==(b>>d&1);this.modules[Math.floor(d/3)][d%3+this.moduleCount-8-3]=e;this.modules[d%3+this.moduleCount-8-3][Math.floor(d/3)]=e}},setupTypeInfo:function(a,b){for(var d=c.Util.getBCHTypeInfo(this.errorCorrectLevel<<3|b),e=0;15>e;e++){var f=!a&&1==(d>>e&1);6>e?this.modules[e][8]=f:8>e?this.modules[e+1][8]=f:this.modules[this.moduleCount-15+e][8]=f}for(e=0;15>e;e++)f=!a&&1==(d>>e&1),this.modules[8][this.moduleCount-1-e]=f;this.modules[this.moduleCount-8][8]=!a},mapData:function(a,b){for(var d=-1,e=this.moduleCount-1,f=7,g=0,h=this.moduleCount-1;0<h;h-=2){6==h&&h--;for(var n=0;this.moduleCount>n;n++){var k=e>=0?this.moduleCount-1-n:n,p=h;for(g=0;2>g;g++)null==this.modules[k][p-g]&&(0<a.length?(n=a[a.length-1],this.modules[k][p-g]=!b.getMask(k,p-g)):this.modules[k][p-g]=!1),a.length&&(g+=1)}}},setupTypeInfo:function(a,b){for(var d=c.Util.getBCHTypeInfo(this.errorCorrectLevel<<3|b),e=0;15>e;e++){var f=!a&&1==(d>>e&1);6>e?this.modules[e][8]=f:8>e?this.modules[e+1][8]=f:this.modules[this.moduleCount-15+e][8]=f}for(e=0;15>e;e++)f=!a&&1==(d>>e&1),this.modules[8][this.moduleCount-1-e]=f;this.modules[this.moduleCount-8][8]=!a}};c.Util={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],getPatternPosition:function(a){return c.Util.PATTERN_POSITION_TABLE[a-1]},getMask:function(a,b){switch((a+b)%8){case 0:return!0;case 1:return!1;case 2:return 0==a%3;case 3:return 0==(a+b)%3;case 4:return 0==(Math.floor(a/2)+Math.floor(b/3))%2;case 5:return 0==a*b%2+a*b%3;case 6:return 0==(a*b%2+a*b%3)%2;case 7:return 0==(a*b%3+(a+b)%2)%2}},getBCHTypeInfo:function(a){for(var b=a<<10;c.Util.getBCHDigit(b)-c.Util.getBCHDigit(1335)>=0;)b^=1335<<c.Util.getBCHDigit(b)-c.Util.getBCHDigit(1335);return 21522^a<<10^b},getBCHTypeNumber:function(a){for(var b=a<<12;c.Util.getBCHDigit(b)-c.Util.getBCHDigit(7973)>=0;)b^=7973<<c.Util.getBCHDigit(b)-c.Util.getBCHDigit(7973);return a<<12^b},getBCHDigit:function(a){for(var b=0;0!=a;)b++,a>>=1;return b},getLostPoint:function(a){for(var b=a.getModuleCount(),d=0,e=0;e<b;e++)for(var f=0;f<b;f++){for(var g=0,h=a.isDark(e,f),n=-1;1>=n;n++)if(!(0>e+n||e+n>=b))for(var k=-1;1>=k;k++)0>f+k||f+k>=b||0==n&&0==k||h==a.isDark(e+n,f+k)&&g++;5<g&&(d+=3+g-5)}for(e=0;e<b-1;e++)for(f=0;f<b-1;f++){g=0;a.isDark(e,f)&&g++;a.isDark(e+1,f)&&g++;a.isDark(e,f+1)&&g++;a.isDark(e+1,f+1)&&g++;0!=g&&4!=g||(d+=3)}for(e=0;e<b;e++)for(f=0;f<b-6;f++)a.isDark(e,f)&&!a.isDark(e,f+1)&&a.isDark(e,f+2)&&a.isDark(e,f+3)&&a.isDark(e,f+4)&&!a.isDark(e,f+5)&&a.isDark(e,f+6)&&(d+=40);for(f=0;f<b;f++)for(e=0;e<b-6;e++)a.isDark(e,f)&&!a.isDark(e+1,f)&&a.isDark(e+2,f)&&a.isDark(e+3,f)&&a.isDark(e+4,f)&&!a.isDark(e+5,f)&&a.isDark(e+6,f)&&(d+=40);for(f=0;f<b;f++)for(e=0;e<b;e++)a.isDark(e,f)&&(d+=Math.abs(100*a.getDarkCount()/a.getModuleCount()/a.getModuleCount()-50)/5);return d}};c.RSBlock=function(a,b){this.totalCount=a;this.dataCount=b};c.RSBlock.getRSBlocks=function(a,b){return[{totalCount:26,dataCount:19},{totalCount:48,dataCount:34},{totalCount:72,dataCount:55},{totalCount:88,dataCount:70},{totalCount:110,dataCount:84},{totalCount:132,dataCount:106},{totalCount:154,dataCount:122},{totalCount:180,dataCount:140},{totalCount:198,dataCount:158},{totalCount:216,dataCount:180}][a-1]?[{totalCount:26,dataCount:19}]:[{totalCount:26,dataCount:16}]};c.Buffer=function(){this.buffer=[];this.length=0};c.Buffer.prototype={get:function(a){return 1==(this.buffer[Math.floor(a/8)]>>>7-a%8&1)},put:function(a,c){for(var b=0;b<c;b++)this.putBit(1==(a>>>c-b-1&1))},getLengthInBits:function(){return this.length},putBit:function(a){var c=Math.floor(this.length/8);this.buffer.length<=c&&this.buffer.push(0);a&&(this.buffer[c]|=128>>>this.length%8);this.length++}};window.QRCode=e;window.QRCode.CorrectLevel={L:1,M:0,Q:3,H:2};})();
  </script>

  <!-- VUE TV -->
  <div id="tv-overlay" class="tv-overlay">
      <div class="tv-inner">
        <div class="tv-logo-bar">
          <img id="tv-logo" alt="Logo TV" />
        </div>
        <div id="classic-tv-sponsor-banner" class="tv-sponsor" style="right: 16px; top: 16px; bottom: auto;">
          <img id="classic-tv-sponsor-logo" alt="Sponsor" />
          <div class="tv-sponsor-name" id="classic-tv-sponsor-name"></div>
        </div>
        <div id="pong-tv-widget-classic" class="pong-tv-widget pong-draggable" style="display:none;">
          <div class="widget-head" id="pong-tv-drag-classic">
            <div class="widget-title">🕹️ Padel Pong</div>
            <button class="widget-close" type="button" id="pong-tv-hide-classic">Masquer</button>
          </div>
          <div class="widget-body">
            <div class="widget-qr" id="pong-tv-qr-classic"></div>
            <div>
              <div class="widget-name" id="pong-tv-name-classic">Scan & joue pendant la pause</div>
              <div class="widget-name" id="pong-tv-meta-classic">Sponsor & IA du mini-jeu</div>
            </div>
          </div>
          <div class="resize-handle" aria-hidden="true"></div>
        </div>
        <header class="tv-header">
          <div class="tv-header-left">
            <div class="tv-title" id="tv-title">TOURNOI</div>
            <div class="tv-subtitle" id="tv-subtitle">Poules + tableaux • … équipes</div>
          </div>
        <div class="tv-header-right">
          <div class="tv-tag-live" id="tv-phase-tag">POULES</div>
          <button id="btn-close-tv" class="btn btn-secondary btn-small">Quitter la vue TV</button>
        </div>
      </header>

      <main class="tv-main">
        <section class="tv-col">
          <article class="tv-block">
            <div class="tv-block-title">
              <span id="tv-left-title">Matchs en cours par terrain</span>
            </div>
            <div id="tv-left-list" class="tv-list"></div>
          </article>
        </section>

        <section class="tv-col">
          <article class="tv-block">
            <div class="tv-block-title">
              <span id="tv-right-title">Prochains matchs par terrain</span>
            </div>
            <div id="tv-right-list" class="tv-list"></div>
          </article>
        </section>
      </main>

      <section id="tv-final-ranking" class="tv-final-ranking" style="display:none;"></section>

      <section id="tv-bracket-row" class="tv-bracket-row">
        <article class="tv-block tv-bracket-block">
          <div class="tv-block-title">
            <span>Arbre tableau principal</span>
          </div>
          <div id="tv-main-bracket-tree" class="tv-bracket-body"></div>
        </article>
        <article class="tv-block tv-bracket-block">
          <div class="tv-block-title">
            <span>Arbre consolante / classement</span>
          </div>
          <div id="tv-conso-bracket-tree" class="tv-bracket-body"></div>
        </article>
      </section>
    </div>
  </div>
</section>

    <!-- PAGE LIGUE INTERNE -->
    <section id="ligue-root" style="display:none;">
      <header class="tournaments-header">
        <div>
          <p class="tournaments-subtitle">Ligue interne</p>
          <h1 class="tournaments-title">Gestion de vos ligues internes de padel</h1>
        </div>
        <div class="tournaments-actions">
          <button class="btn btn-secondary" id="btn-back-home-from-ligue">🏠 Accueil</button>
          <button class="btn btn-secondary btn-ligue-player-view">📱 Vue joueur</button>
        </div>
      </header>

      <section class="tournaments-grid">
        <article class="tournament-type-card ligue-block-config app-block-interactive">
          <div class="tournament-type-card-header">
            <div>
              <p class="tournaments-subtitle">Ligue interne</p>
              <h3 class="tournaments-title">Configurer une ligue</h3>
              <p class="tournament-type-description">Créer une nouvelle ligue : équipes, format, calendrier…</p>
            </div>
          </div>
          <div class="tournament-type-actions">
            <button class="btn" id="btn-ligue-config">Configurer une ligue</button>
          </div>
        </article>

        <article class="tournament-type-card ligue-block-active app-block-interactive">
          <div class="tournament-type-card-header">
            <div>
              <p class="tournaments-subtitle">Ligue interne</p>
              <h3 class="tournaments-title">Gestion des ligues en cours</h3>
              <p class="tournament-type-description">Voir et administrer les ligues actuellement actives.</p>
            </div>
          </div>
          <div class="tournament-type-actions">
            <button class="btn" id="btn-ligue-active">Gérer les ligues en cours</button>
          </div>
        </article>
      </section>

      <section class="card ligue-section app-block-interactive">
        <div class="ligue-inline">
          <div>
            <p class="tournaments-subtitle">Historique</p>
            <h3 class="tournaments-title">Historique des ligues terminées</h3>
          </div>
          <div class="small-muted">Ligues clôturées et archivées.</div>
        </div>
        <div id="ligue-history-list" class="ligue-list">
          <div class="empty">Aucune ligue terminée pour l’instant.</div>
        </div>
      </section>
    </section>

    <section id="ligue-player-root" style="display:none;">
      <div class="card ligue-theme-shell" id="ligue-player-shell">
        <header class="tournaments-header" style="margin-bottom:8px;">
          <div>
            <p class="tournaments-subtitle">📱 Vue joueur</p>
            <h1 class="tournaments-title">Ligues internes – kiosque</h1>
          </div>
          <div class="tournaments-actions ligue-actions">
            <button class="btn btn-secondary" id="btn-ligue-player-back">← Ligue</button>
          </div>
        </header>

          <div class="card" style="border:1px solid #111827;">
          <div class="ligue-inline" style="justify-content:space-between; align-items:center;">
            <div>
              <p class="tournaments-subtitle">Ligues actives</p>
              <h3 class="tournaments-title">Choisis une ligue</h3>
              <div class="small-muted">Accès en mode kiosque, lecture seule.</div>
            </div>
          </div>
          <div id="ligue-player-list" class="ligue-list" style="margin-top:6px;"></div>
        </div>
      </div>
    </section>

    <section id="ligue-player-manage-root" style="display:none;">
      <div class="card ligue-theme-shell" id="ligue-player-manage-shell">
        <header class="tournaments-header" style="margin-bottom:8px;">
          <div>
            <p class="tournaments-subtitle">📱 Vue joueur</p>
            <h1 class="tournaments-title" id="ligue-player-manage-title">Aucune ligue sélectionnée</h1>
            <div class="small-muted" id="ligue-player-manage-meta">Sélectionne une ligue active pour accéder aux onglets.</div>
          </div>
          <div class="tournaments-actions ligue-actions">
            <div id="ligue-player-manage-level" class="ligue-chip" style="display:none;"></div>
            <button class="btn btn-secondary" id="btn-ligue-player-manage-back">← Ligues</button>
          </div>
        </header>

        <div class="ligue-tabs" id="ligue-player-manage-tabs">
          <button class="ligue-tab active" data-tab="calendar" id="tab-player-calendar">📅 Calendrier</button>
          <button class="ligue-tab" data-tab="standings" id="tab-player-standings">📊 Classement</button>
          <button class="ligue-tab" data-tab="results" id="tab-player-results">🎾 Résultats</button>
          <button class="ligue-tab" data-tab="teams" id="tab-player-teams">👥 Équipes</button>
          <button class="ligue-tab" data-tab="rules" id="tab-player-rules">📜 Règlement</button>
        </div>

        <div class="ligue-panel" id="panel-player-calendar">
          <div class="ligue-inline" style="justify-content:space-between; align-items:center;">
            <h4 class="tournaments-title">📅 Calendrier complet</h4>
            <div class="small-muted">Lecture seule</div>
          </div>
          <div id="ligue-player-manage-calendar" class="ligue-section"></div>
        </div>

        <div class="ligue-panel hidden" id="panel-player-standings">
          <div class="ligue-inline" style="justify-content:space-between; align-items:center;">
            <h4 class="tournaments-title">📊 Classement</h4>
            <div class="small-muted">Lecture seule</div>
          </div>
          <table class="ligue-standings" id="ligue-player-manage-standings"></table>
        </div>

        <div class="ligue-panel hidden" id="panel-player-results">
          <div class="ligue-inline" style="justify-content:space-between; align-items:center;">
            <h4 class="tournaments-title">🎾 Résultats</h4>
            <div class="small-muted">Scores officiels</div>
          </div>
          <div id="ligue-player-manage-results" class="ligue-section"></div>
        </div>

        <div class="ligue-panel hidden" id="panel-player-teams">
          <div class="ligue-inline" style="justify-content:space-between; align-items:center;">
            <h4 class="tournaments-title">👥 Équipes</h4>
            <div class="small-muted">Rosters en lecture seule</div>
          </div>
          <div id="ligue-player-manage-teams" class="ligue-section"></div>
        </div>

        <div class="ligue-panel hidden" id="panel-player-rules">
          <div class="ligue-inline" style="justify-content:space-between; align-items:center;">
            <h4 class="tournaments-title">📜 Règlement</h4>
            <div class="small-muted">Lecture seule</div>
          </div>
          <div class="ligue-section" id="ligue-player-reglement-panel">
            <div class="card" style="border:1px solid #111827;">
              <div class="ligue-inline" style="gap:6px; flex-wrap:wrap; align-items:center; font-weight:600;">
                <span>Vous avez du</span>
                <span id="ligue-player-reglement-start" class="ligue-badge">—</span>
                <span>au</span>
                <span id="ligue-player-reglement-end" class="ligue-badge">—</span>
                <span>pour programmer vos matchs.</span>
              </div>
              <div class="ligue-section" style="margin-top:12px; color: var(--text);">
                <div class="card" style="border:1px solid #1f2937; background: rgba(255,255,255,0.02);">
                  <h5 class="tournaments-title" style="margin-bottom:6px;">📅 Programmation premium</h5>
                  <p style="margin-bottom:6px;">Planifiez vos rencontres librement (heures creuses, pleines, week-end) en respectant l’ordre officiel des matchs. Exemple : on joue la Journée 1 avant la Journée 3.</p>
                  <p style="margin-bottom:6px;">Réservation rapide : contactez-nous via le WhatsApp de la ligue ou par téléphone pour bloquer votre créneau.</p>
                </div>
                <div class="card" style="border:1px solid #1f2937; background: rgba(255,255,255,0.02);">
                  <h5 class="tournaments-title" style="margin-bottom:6px;">🎾 Format de jeu</h5>
                  <ul style="margin-left:16px; list-style: disc;">
                    <li>Match en <strong>2 sets gagnants</strong> (0 à 7 jeux par set, avantage classique).</li>
                    <li>En cas de 3eme set, vous jouez un super tie-break en 10 points (2pts d'écarts).</li>
                    <li>Avant de jouer : récupérez vos balles neuves et votre fiche de score au bar.</li>
                    <li>Après le match : remettez le score au staff pour validation.</li>
                  </ul>
                </div>
                <div class="card" style="border:1px solid #1f2937; background: rgba(255,255,255,0.02);">
                  <h5 class="tournaments-title" style="margin-bottom:6px;">🤝 Fair-play & confort</h5>
                  <p style="margin-bottom:6px;">Auto-arbitrage, respect et courtoisie sont de mise. Un différend ? On échange calmement ou on contacte le staff.</p>
                  <p style="margin-bottom:0;">Jouez sereinement, profitez du club, et que le meilleur duo l’emporte !</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="ligue-config-root" style="display:none;">
      <div class="card ligue-theme-shell app-block-interactive" id="ligue-config-shell">
        <header class="tournaments-header" style="margin-bottom:8px;">
          <div>
            <p class="tournaments-subtitle">Configuration</p>
            <h1 class="tournaments-title">Créer une ligue interne</h1>
          </div>
          <div class="tournaments-actions ligue-actions">
            <button class="btn btn-secondary" id="btn-ligue-config-back">← Retour</button>
            <button class="btn btn-secondary btn-ligue-player-view">📱 Vue joueur</button>
            <button class="btn" id="btn-ligue-config-generate">Générer le calendrier</button>
          </div>
        </header>

        <div class="ligue-form-grid ligue-section">
          <div class="ligue-field">
            <label for="ligue-config-name">Nom de la ligue</label>
            <input type="text" id="ligue-config-name" placeholder="Ex : Ligue 1 – Hiver" />
          </div>
          <div class="ligue-field">
            <label for="ligue-config-level">Ligue</label>
            <select id="ligue-config-level">
              <option value="Ligue 1">Ligue 1</option>
              <option value="Ligue 2">Ligue 2</option>
              <option value="Ligue 3">Ligue 3</option>
            </select>
          </div>
          <div class="ligue-field">
            <label for="ligue-config-nbteams">Nombre d’équipes (4 à 20)</label>
            <input type="number" id="ligue-config-nbteams" min="4" max="20" value="8" />
          </div>
          <div class="ligue-field">
            <label for="ligue-config-format">Format</label>
            <select id="ligue-config-format">
              <option value="aller">Aller simple</option>
              <option value="aller_retour">Aller / Retour</option>
            </select>
          </div>
          <div class="ligue-field">
            <label for="ligue-config-start">Date de début</label>
            <input type="date" id="ligue-config-start" />
          </div>
        </div>

        <div class="card ligue-section app-block-interactive" style="border:1px solid #111827;">
          <h3 class="tournaments-title" style="margin-bottom:6px;">Équipes</h3>
          <div class="ligue-inline" style="justify-content:space-between; align-items:center; margin-bottom:6px;">
            <div class="small-muted">Renseigne 4 à 20 équipes, 2 à 6 joueurs par équipe.</div>
            <button class="btn btn-secondary btn-small" id="btn-ligue-generate-teams">Générer des équipes auto</button>
          </div>
          <div id="ligue-config-teams" class="ligue-section"></div>
        </div>
      </div>
    </section>

    <section id="ligue-active-root" style="display:none;">
      <div class="card ligue-theme-shell app-block-interactive" id="ligue-active-shell">
        <header class="tournaments-header" style="margin-bottom:8px;">
          <div>
            <p class="tournaments-subtitle">Ligues actives</p>
            <h1 class="tournaments-title">Gestion des ligues en cours</h1>
          </div>
          <div class="tournaments-actions ligue-actions">
            <button class="btn btn-secondary" id="btn-ligue-active-back">← Retour</button>
            <button class="btn btn-secondary btn-ligue-player-view">📱 Vue joueur</button>
          </div>
        </header>

        <div class="ligue-grid-2 ligue-section">
          <div class="card" style="border:1px solid #111827;">
            <h3 class="tournaments-title" style="margin-bottom:6px;">Ligues</h3>
            <div class="ligue-list" id="ligue-active-list">
              <div class="empty">Aucune ligue active pour l’instant.</div>
            </div>
          </div>

          <div class="card" style="border:1px solid #111827;">
            <div class="ligue-inline" style="justify-content:space-between;">
              <div>
                <p class="tournaments-subtitle">Détails</p>
                <h3 class="tournaments-title" id="ligue-detail-title">Sélectionne une ligue</h3>
              </div>
              <div id="ligue-detail-level" class="ligue-chip" style="display:none;"></div>
            </div>
            <div class="small-muted" id="ligue-detail-meta">Aucune ligue sélectionnée.</div>

            <div class="ligue-section">
              <div>
                <div class="ligue-inline" style="justify-content:space-between;">
                  <h4 class="tournaments-title">Équipes</h4>
                  <div class="ligue-badge-accent" id="ligue-detail-manage-link" style="display:none; cursor:pointer;">📊 Gérer cette ligue</div>
                </div>
                <div id="ligue-detail-teams" class="ligue-list" style="margin-top:6px;"></div>
              </div>

              <div>
                <div class="ligue-inline" style="justify-content:space-between; align-items:center;">
                  <h4 class="tournaments-title">Matchs / calendrier</h4>
                  <div class="small-muted">Saisis les scores pour mettre à jour le classement.</div>
                </div>
                <div id="ligue-detail-matches" class="ligue-section"></div>
              </div>

              <div>
                <div class="ligue-inline" style="justify-content:space-between; align-items:center;">
                  <h4 class="tournaments-title">Classement</h4>
                  <div class="small-muted">3 pts victoire, 0 pt défaite</div>
                </div>
                <table class="ligue-standings" id="ligue-detail-standings"></table>
              </div>
            </div>

            <div class="ligue-actions" style="margin-top:10px;">
              <button class="btn" id="btn-ligue-close">Clôturer la ligue</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="ligue-manage-root" style="display:none;">
      <div class="card ligue-theme-shell app-block-interactive" id="ligue-manage-shell">
        <header class="tournaments-header" style="margin-bottom:8px;">
          <div>
            <p class="tournaments-subtitle">Gestion de ligue</p>
            <h1 class="tournaments-title" id="ligue-manage-title">Aucune ligue sélectionnée</h1>
            <div class="small-muted" id="ligue-manage-meta">Sélectionne une ligue active pour accéder aux onglets.</div>
          </div>
          <div class="tournaments-actions ligue-actions">
            <div id="ligue-manage-level" class="ligue-chip" style="display:none;"></div>
            <button class="btn btn-secondary" id="btn-ligue-manage-back">← Ligues</button>
            <button class="btn btn-secondary btn-ligue-player-view">📱 Vue joueur</button>
            <button class="btn" id="btn-ligue-manage-close">🏁 Clôturer</button>
          </div>
        </header>

        <div class="ligue-tabs" id="ligue-manage-tabs">
          <button class="ligue-tab active" data-tab="calendar" id="tab-ligue-calendar">📅 Calendrier</button>
          <button class="ligue-tab" data-tab="standings" id="tab-ligue-standings">📊 Classement</button>
          <button class="ligue-tab" data-tab="results" id="tab-ligue-results">🎾 Résultats</button>
          <button class="ligue-tab" data-tab="teams" id="tab-ligue-teams">👥 Équipes</button>
          <button class="ligue-tab" data-tab="rules" id="tab-ligue-rules">📜 Règlement</button>
        </div>

        <div class="ligue-panel" id="panel-ligue-calendar">
          <div class="ligue-inline" style="justify-content:space-between; align-items:center;">
            <h4 class="tournaments-title">📅 Prochains matchs</h4>
            <div class="ligue-inline" style="gap:8px; align-items:center;">
              <div class="ligue-badge-accent" id="ligue-calendar-note">Planification complète</div>
            </div>
          </div>
          <div class="card ligue-section app-block-interactive" style="margin:10px 0;">
            <div class="ligue-inline" style="justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
              <div>
                <h5 class="tournaments-title" style="margin-bottom:4px;">Exporter la liste des matchs</h5>
                <div class="small-muted">Choisis le périmètre et lance l’export sans pop-up.</div>
              </div>
              <div class="ligue-inline" style="gap:8px; align-items:center; flex-wrap:wrap;">
                <select id="ligue-export-matches-mode" class="btn-small" style="min-width:170px; border-radius:12px; background:#020617; color:var(--text); border:1px solid #1e293b;">
                  <option value="all">Tous les matchs (saison complète)</option>
                  <option value="day">Matchs par journée</option>
                </select>
                <select id="ligue-export-matches-day" class="btn-small" style="min-width:140px; border-radius:12px; background:#020617; color:var(--text); border:1px solid #1e293b; display:none;"></select>
                <select id="ligue-export-matches-format" class="btn-small" style="min-width:130px; border-radius:12px; background:#020617; color:var(--text); border:1px solid #1e293b;">
                  <option value="image">Image (PNG)</option>
                  <option value="pdf">PDF</option>
                </select>
                <button class="btn btn-secondary btn-small" id="btn-ligue-export-matches">Exporter</button>
              </div>
            </div>
          </div>
          <div id="ligue-manage-calendar" class="ligue-section"></div>
        </div>

        <div class="ligue-panel hidden" id="panel-ligue-standings">
          <div class="ligue-inline" style="justify-content:space-between; align-items:center;">
            <h4 class="tournaments-title">📊 Classement</h4>
            <div class="small-muted">🥇 3 pts victoire • 0 pt défaite</div>
          </div>
          <table class="ligue-standings" id="ligue-manage-standings"></table>
        </div>

        <div class="ligue-panel hidden" id="panel-ligue-results">
          <div class="ligue-inline" style="justify-content:space-between; align-items:center;">
            <h4 class="tournaments-title">🎾 Résultats</h4>
            <div class="small-muted">Saisie des scores (2 sets gagnants)</div>
          </div>
          <div class="card ligue-section app-block-interactive" style="margin:10px 0;">
            <div class="ligue-inline" style="justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
              <div>
                <h5 class="tournaments-title" style="margin-bottom:4px;">Exporter les résultats par journée</h5>
                <div class="small-muted">Sélectionne la journée puis génère l’image de résultats.</div>
              </div>
              <div class="ligue-inline" style="gap:8px; align-items:center;">
                <select id="ligue-day-export-select" class="btn-small" style="min-width:140px; border-radius:12px; background:#020617; color:var(--text); border:1px solid #1e293b;"></select>
                <button class="btn btn-secondary btn-small" id="btn-ligue-day-export">Exporter la journée</button>
              </div>
            </div>
          </div>
          <div id="ligue-manage-results" class="ligue-section"></div>
        </div>

        <div class="ligue-panel hidden" id="panel-ligue-teams">
          <div class="ligue-inline" style="justify-content:space-between; align-items:center;">
            <h4 class="tournaments-title">👥 Équipes</h4>
            <div class="small-muted">Roster actuel de la ligue</div>
          </div>
          <div id="ligue-manage-teams" class="ligue-section"></div>
        </div>

        <div class="ligue-panel hidden" id="panel-ligue-rules">
          <div class="ligue-inline" style="justify-content:space-between; align-items:center;">
            <h4 class="tournaments-title">📜 Règlement</h4>
            <div class="small-muted">Créneaux et consignes</div>
          </div>
          <div class="ligue-section" id="ligue-reglement-panel">
            <div class="card" style="border:1px solid #111827;">
              <div class="ligue-inline" style="gap:6px; flex-wrap:wrap; align-items:center; font-weight:600;">
                <span>Vous avez du</span>
                <input type="date" id="ligue-reglement-start" class="ligue-reglement-date" />
                <span>au</span>
                <input type="date" id="ligue-reglement-end" class="ligue-reglement-date" />
                <span>pour programmer vos matchs.</span>
              </div>
              <div class="ligue-section" style="margin-top:12px; color: var(--text);">
                <div class="card" style="border:1px solid #1f2937; background: rgba(255,255,255,0.02);">
                  <h5 class="tournaments-title" style="margin-bottom:6px;">📅 Programmation premium</h5>
                  <p style="margin-bottom:6px;">Planifiez vos rencontres librement (heures creuses, pleines, week-end) en respectant l’ordre officiel des matchs. Exemple : on joue la Journée 1 avant la Journée 3.</p>
                  <p style="margin-bottom:6px;">Réservation rapide : contactez-nous via le WhatsApp de la ligue ou par téléphone pour bloquer votre créneau.</p>
                </div>
                <div class="card" style="border:1px solid #1f2937; background: rgba(255,255,255,0.02);">
                  <h5 class="tournaments-title" style="margin-bottom:6px;">🎾 Format de jeu</h5>
                  <ul style="margin-left:16px; list-style: disc;">
                    <li>Match en <strong>2 sets gagnants</strong> (0 à 7 jeux par set, avantage classique).</li>
                    <li>En cas de 3eme set, vous jouez un super tie-break en 10 points (2pts d'écarts).</li>
                    <li>Avant de jouer : récupérez vos balles neuves et votre fiche de score au bar.</li>
                    <li>Après le match : remettez le score au staff pour validation.</li>
                  </ul>
                </div>
                <div class="card" style="border:1px solid #1f2937; background: rgba(255,255,255,0.02);">
                  <h5 class="tournaments-title" style="margin-bottom:6px;">🤝 Fair-play & confort</h5>
                  <p style="margin-bottom:6px;">Auto-arbitrage, respect et courtoisie sont de mise. Un différend ? On échange calmement ou on contacte le staff.</p>
                  <p style="margin-bottom:0;">Jouez sereinement, profitez du club, et que le meilleur duo l’emporte !</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- VUE TV M/D -->
    <section id="tv-root">
      <header class="tv-header">
        <div class="tv-header-left">
          <img id="tv-logo" alt="Logo club TV" />
          <div class="tv-title-block">
            <div id="tv-tournoi-name">Tournoi</div>
            <div id="tv-roulement-info">Roulement 1 / 8 • 0 équipes</div>
          </div>
        </div>
        <div class="tv-header-right">
          <div class="tv-tag-live">🔴 LIVE</div>
          <button id="btn-back-admin" class="btn btn-secondary btn-small">↩ Mode admin</button>
        </div>
      </header>

      <div id="tv-sponsor-banner" class="tv-sponsor">
        <img id="tv-sponsor-logo" alt="Sponsor" />
        <div class="tv-sponsor-name" id="tv-sponsor-name"></div>
      </div>

      <div id="pong-tv-widget-md" class="pong-tv-widget pong-draggable" style="display:none;">
        <div class="widget-head" id="pong-tv-drag-md">
          <div class="widget-title">🕹️ Padel Pong</div>
          <button class="widget-close" type="button" id="pong-tv-hide-md">Masquer</button>
        </div>
        <div class="widget-body">
          <div class="widget-qr" id="pong-tv-qr-md"></div>
          <div>
            <div class="widget-name" id="pong-tv-name-md">Scan & joue pendant la pause</div>
            <div class="widget-name" id="pong-tv-meta-md">Sponsor & IA du mini-jeu</div>
          </div>
        </div>
        <div class="resize-handle" aria-hidden="true"></div>
      </div>

      <main class="tv-main">
        <section class="tv-column">
          <div class="tv-block" data-tv-block="current_matches" style="display:none;">
            <div class="tv-block-title">
              <span>Matchs en cours</span>
              <span>Roulement <span id="tv-label-roulement">1</span></span>
            </div>
            <div id="tv-current-list" class="tv-current-list">
              <div class="tv-empty">Lance un tournoi en mode admin pour voir les matchs ici.</div>
            </div>
            <div class="tv-small-note">⚡ Terrain 1 = plus fort • Terrain 4 = terrain fun</div>
          </div>

          <div class="tv-block" data-tv-block="next_matches" style="display:none;">
            <div class="tv-block-title">
              <span>Matchs à venir</span>
              <span>Prochain roulement</span>
            </div>
            <div id="tv-next-list" class="tv-next-list">
              <div class="tv-empty">Les matchs du prochain roulement apparaîtront ici.</div>
            </div>
          </div>

          <div class="tv-block" data-tv-block="resting_teams" style="display:none;">
            <div class="tv-block-title">
              <span>Équipes au repos</span>
              <span>Ce roulement</span>
            </div>
            <div id="tv-rest-list" class="tv-current-list">
              <div class="tv-empty">Aucune équipe au repos.</div>
            </div>
          </div>

          <div class="tv-block" data-tv-block="stats" style="display:none;">
            <div class="tv-block-title">
              <span>Statistiques</span>
              <span>Performance globale</span>
            </div>
            <div id="tv-stats-content" class="tv-current-list">
              <div class="tv-empty">Les stats apparaîtront après plusieurs matchs.</div>
            </div>
          </div>
        </section>

        <section class="tv-column">
          <div class="tv-block" data-tv-block="ranking" style="display:none;">
            <div class="tv-block-title">
              <span>Classement</span>
              <span>Points cumulés</span>
            </div>
            <div id="tv-podium" class="tv-podium"></div>
            <div id="tv-ranking-grid" class="tv-ranking-grid"></div>
            <div class="tv-small-note">3 pts par victoire • Le moteur équilibre matchs et repos.</div>
          </div>

          <div class="tv-block" data-tv-block="podium" style="display:none;">
            <div class="tv-block-title">
              <span>Podium</span>
              <span>Top 3</span>
            </div>
            <div id="tv-podium-only" class="tv-podium"></div>
          </div>
        </section>
      </main>
  </section>

    <!-- Pop-up Timer M/D -->
    <div class="md-timer-pop" id="md-timer-pop">
      <div class="md-timer-shell" id="md-timer-shell">
        <header id="md-timer-drag">
          <h4>⏱️ Timer de manche M/D</h4>
          <button class="btn btn-secondary btn-small" id="md-timer-close">✖ Fermer</button>
        </header>
        <div class="md-timer-body">
          <div class="md-timer-remaining" id="md-timer-remaining">15:00</div>
          <div class="md-timer-status" id="md-timer-status">Montante/Descendante en cours</div>
        </div>
      </div>
    </div>
  </div>

  <div id="social-export-template" style="display:none;"></div>

  <div id="social-modal" class="social-modal">
    <div class="social-modal-overlay"></div>
    <div class="social-modal-panel">
      <div class="social-modal-header">
        <h3 class="tournaments-title" id="social-modal-title">Aperçu réseaux</h3>
        <button class="social-modal-close" id="social-modal-close">✕</button>
      </div>
      <div class="social-modal-body" id="social-modal-body"></div>
      <div class="social-modal-actions">
        <button class="btn btn-secondary btn-small" id="social-modal-cancel">Fermer</button>
        <button class="btn btn-small" id="social-modal-download">Télécharger PNG</button>
      </div>
    </div>
  </div>

  <!-- Générateur QR minimal pour Padel Pong -->
  <script>
    (function() {
      function QR8bitByte(data) { this.mode = QRMode.MODE_8BIT_BYTE; this.data = data; }
      QR8bitByte.prototype={getLength:function(){return this.data.length;},write:function(buffer){for(var i=0;i<this.data.length;i++)buffer.put(this.data.charCodeAt(i),8);}};
      var QRMode={MODE_8BIT_BYTE:1};
      function QRPolynomial(num,shift){var offset=0;while(offset<num.length&&0==num[offset])offset++;this.num=new Array(num.length-offset+shift);for(var i=0;i<num.length-offset;i++)this.num[i]=num[i+offset];}
      QRPolynomial.prototype={get:function(index){return this.num[index];},getLength:function(){return this.num.length;},multiply:function(e){for(var num=new Array(this.getLength()+e.getLength()-1),i=0;i<this.getLength();i++)for(var j=0;j<e.getLength();j++)num[i+j]^=QRMath.gexp(QRMath.glog(this.get(i))+QRMath.glog(e.get(j)));return new QRPolynomial(num,0)},mod:function(e){if(this.getLength()-e.getLength()<0)return this;var ratio=QRMath.glog(this.get(0))-QRMath.glog(e.get(0)),num=new Array(this.getLength());for(var i=0;i<this.getLength();i++)num[i]=this.get(i);for(i=0;i<e.getLength();i++)num[i]^=QRMath.gexp(QRMath.glog(e.get(i))+ratio);return new QRPolynomial(num,0).mod(e)}};
      var QRMath={glog:function(n){if(n<1)throw new Error("glog"+n);return QRMath.LOG_TABLE[n];},gexp:function(n){for(;n<0;)n+=255;for(;n>=256;)n-=255;return QRMath.EXP_TABLE[n]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)};for(var i=0;i<8;i++)QRMath.EXP_TABLE[i]=1<<i;for(i=8;i<256;i++)QRMath.EXP_TABLE[i]=QRMath.EXP_TABLE[i-4]^QRMath.EXP_TABLE[i-5]^QRMath.EXP_TABLE[i-6]^QRMath.EXP_TABLE[i-8];for(i=0;i<255;i++)QRMath.LOG_TABLE[QRMath.EXP_TABLE[i]]=i;
      function QRRSBlock(totalCount,dataCount){this.totalCount=totalCount;this.dataCount=dataCount;}QRRSBlock.getRSBlocks=function(typeNumber){var rsBlock=new QRRSBlock(26,19);return new Array(typeNumber).fill(rsBlock)};
      function QRBitBuffer(){this.buffer=[];this.length=0;}QRBitBuffer.prototype={get:function(index){return 1==(this.buffer[Math.floor(index/8)]>>>7-index%8&1)},put:function(num,length){for(var i=0;i<length;i++)this.putBit(1==(num>>>length-i-1&1));},getLengthInBits:function(){return this.length},putBit:function(bit){var bufIndex=Math.floor(this.length/8);this.buffer.length<=bufIndex&&this.buffer.push(0);bit&&(this.buffer[bufIndex]|=128>>>this.length%8);this.length++;}};
      function QRCode(typeNumber,errorCorrectLevel){this.typeNumber=typeNumber;this.errorCorrectLevel=errorCorrectLevel;this.modules=null;this.moduleCount=0;this.dataCache=null;this.dataList=[];}
      QRCode.prototype={addData:function(data){this.dataList.push(new QR8bitByte(data));this.dataCache=null;},isDark:function(row,col){return this.modules[row][col]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(test,maskPattern){this.moduleCount=4*this.typeNumber+17;this.modules=new Array(this.moduleCount);for(var row=0;row<this.moduleCount;row++){this.modules[row]=new Array(this.moduleCount);for(var col=0;col<this.moduleCount;col++)this.modules[row][col]=null}this.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.setupTimingPattern();this.mapData(this.createData(),maskPattern);},createData:function(){for(var buffer=new QRBitBuffer(),i=0;i<this.dataList.length;i++){var data=this.dataList[i];buffer.put(data.mode,4);buffer.put(data.getLength(),8);data.write(buffer)}for(i=0;i<buffer.buffer.length&&buffer.getLengthInBits()<=8*this.typeNumber*26;i++);for(;0!=buffer.getLengthInBits()%8;)buffer.putBit(!1);for(;buffer.getLengthInBits()<8*this.typeNumber*26;)buffer.put(0,8);return QRCode.createBytes(buffer,QRRSBlock.getRSBlocks(this.typeNumber))},setupPositionProbePattern:function(row,col){for(var r=-1;7>=r;r++)if(!(-1>=row+r||this.moduleCount<=row+r))for(var c=-1;7>=c;c++)-1>=col+c||this.moduleCount<=col+c||(this.modules[row+r][col+c]=0<=r&&r<=6&&(0==c||6==c)||0<=c&&c<=6&&(0==r||6==r)||2<=r&&r<=4&&2<=c&&c<=4)},setupTimingPattern:function(){for(var r=8;r<this.moduleCount-8;r++)null==this.modules[r][6]&&(this.modules[r][6]=0==r%2),null==this.modules[6][r]&&(this.modules[6][r]=0==r%2)},mapData:function(data,maskPattern){for(var inc=-1,row=this.moduleCount-1,bitIndex=7,byteIndex=0,col=this.moduleCount-1;0<col;col-=2){6==col&&col--;for(;;){for(var c=0;2>c;c++)if(null==this.modules[row][col-c]){var dark=!1;byteIndex<data.length&&(dark=1==(data[byteIndex]>>>bitIndex&1));maskPattern=maskPattern;dark=this.getMask(maskPattern,row,col-c)?!dark:dark;this.modules[row][col-c]=dark;bitIndex--;0>bitIndex&&(byteIndex++,bitIndex=7)}row+=inc;if(0>row||this.moduleCount<=row){row-=inc;inc=-inc;break}}}},getBestMaskPattern:function(){return 0},getMask:function(pattern,row,col){switch(pattern){case 0:return 0==(row+col)%2;default:return !1}},setupPositionAdjustPattern:function(){},setupTypeNumber:function(){},setupTypeInfo:function(){}};
      QRCode.createBytes=function(buffer,rsBlocks){for(var offset=0,maxDcCount=0,maxEcCount=0,dcdata=new Array(rsBlocks.length),ecdata=new Array(rsBlocks.length),i=0;i<rsBlocks.length;i++){var dcCount=rsBlocks[i].dataCount,ecCount=rsBlocks[i].totalCount-dcCount;maxDcCount=Math.max(maxDcCount,dcCount);maxEcCount=Math.max(maxEcCount,ecCount);dcdata[i]=new Array(dcCount);for(var j=0;j<dcdata[i].length;j++)dcdata[i][j]=255&buffer.buffer[j+offset];offset+=dcCount;var rsPoly=QRCode.getErrorCorrectPolynomial(ecCount),rawPoly=new QRPolynomial(dcdata[i],0),modPoly=rawPoly.mod(rsPoly);ecdata[i]=new Array(rsPoly.getLength()-1);for(j=0;j<ecdata[i].length;j++){var modIndex=j+modPoly.getLength()-ecdata[i].length;ecdata[i][j]=0<=modIndex?modPoly.get(modIndex):0}}for(var totalCodeCount=0,i=0;i<rsBlocks.length;i++)totalCodeCount+=rsBlocks[i].totalCount;var data=new Array(totalCodeCount),index=0;for(j=0;j<maxDcCount;j++)for(i=0;i<rsBlocks.length;i++)j<dcdata[i].length&&(data[index++]=dcdata[i][j]);for(j=0;j<maxEcCount;j++)for(i=0;i<rsBlocks.length;i++)j<ecdata[i].length&&(data[index++]=ecdata[i][j]);return data};
      QRCode.getErrorCorrectPolynomial=function(errorCorrectLength){for(var a=new QRPolynomial([1],0),i=0;i<errorCorrectLength;i++)a=a.multiply(new QRPolynomial([1,QRMath.gexp(i)],0));return a};
      QRCode.stringToBytes=function(s){return QRMath.stringToBytes(s)};QRMath.stringToBytes=function(s){for(var bytes=[],i=0;i<s.length;i++)bytes.push(s.charCodeAt(i));return bytes};
      window.QRCode=QRCode;
    })();
  </script>

  <!-- Début génération image réseaux ligue -->
  <script>
    (function() {
      var LOGO_KEY = 'padel_app_logo_v1';
      var LEVEL_COLORS = { 'ligue 1': '#004B9B', 'ligue 2': '#4D81B9', 'ligue 3': '#99B7D7', 'niveau 1': '#004B9B', 'niveau 2': '#4D81B9', 'niveau 3': '#99B7D7' };
      var templateRoot = document.getElementById('social-export-template');
      var modalRefs = {
        container: document.getElementById('social-modal'),
        title: document.getElementById('social-modal-title'),
        body: document.getElementById('social-modal-body'),
        download: document.getElementById('social-modal-download'),
        close: document.getElementById('social-modal-close'),
        cancel: document.getElementById('social-modal-cancel'),
        overlay: null
      };
      modalRefs.overlay = modalRefs.container ? modalRefs.container.querySelector('.social-modal-overlay') : null;
      var modalState = { download: null };

      function slugify(txt) {
        return (txt || 'ligue').toString().toLowerCase().replace(/[^a-z0-9]+/g, '_').replace(/_+/g, '_').replace(/^_|_$/g, '');
      }

      function getStoredLogo() {
        try { return localStorage.getItem(LOGO_KEY) || ''; } catch (e) { return ''; }
      }

      function prepareRoot() {
        if (!templateRoot) return null;
        var prev = templateRoot.getAttribute('style') || '';
        templateRoot.setAttribute('data-prev-style', prev);
        templateRoot.style.display = 'block';
        templateRoot.style.position = 'fixed';
        templateRoot.style.left = '-9999px';
        templateRoot.style.top = '-9999px';
        templateRoot.innerHTML = '';
        return templateRoot;
      }

      function cleanupRoot(root) {
        if (!root) return;
        root.innerHTML = '';
        var prev = root.getAttribute('data-prev-style');
        if (prev !== null) root.setAttribute('style', prev); else root.removeAttribute('style');
      }

      function levelColor(level) {
        var key = (level || '').toLowerCase();
        return LEVEL_COLORS[key] || '#4D81B9';
      }

      function teamNameFromLeague(league, id) {
        if (!league || !league.teams) return id;
        var t = league.teams.find(function(team) { return team.id === id; });
        return (t && (t.name || t.id)) || id;
      }

      function formatSetsSocial(match) {
        if (!match || !match.sets) return 'À jouer';
        var parts = (match.sets || [])
          .filter(function(s) { return s && s.home !== null && s.home !== undefined && s.away !== null && s.away !== undefined; })
          .map(function(s) { return s.home + ' - ' + s.away; });
        return parts.length ? parts.join(' / ') : 'À jouer';
      }

      function resolveWinnerId(match) {
        if (!match) return null;
        if (match.winnerTeamId) return match.winnerTeamId;
        var sets = match.sets || [];
        var wins = [0, 0];
        sets.forEach(function(s) {
          if (!s || s.home === null || s.away === null) return;
          if (s.home > s.away) wins[0] += 1; else if (s.away > s.home) wins[1] += 1;
        });
        if (wins[0] === wins[1]) return null;
        return wins[0] > wins[1] ? match.home : match.away;
      }

      function addLevelBand(container, level) {
        var band = document.createElement('div');
        band.className = 'social-level-band';
        var color = levelColor(level);
        band.style.background = color;
        band.textContent = level || 'Ligue';
        container.appendChild(band);
      }

      function buildRankingTable(standings) {
        var wrapper = document.createElement('div');
        wrapper.className = 'social-ranking';
        var table = document.createElement('table');
        var thead = document.createElement('thead');
        thead.innerHTML = '<tr><th>#</th><th>Équipe</th><th>J</th><th>V</th><th>D</th><th>Pts</th></tr>';
        table.appendChild(thead);
        var tbody = document.createElement('tbody');
        (standings || []).forEach(function(s, idx) {
          var row = document.createElement('tr');
          row.innerHTML = '<td>' + (idx + 1) + '</td><td>' + (s.name || s.id) + '</td><td>' + (s.played || 0) + '</td><td>' + (s.wins || 0) + '</td><td>' + (s.losses || 0) + '</td><td>' + (s.points || 0) + '</td>';
          tbody.appendChild(row);
        });
        table.appendChild(tbody);
        wrapper.appendChild(table);
        return wrapper;
      }

      function buildPodium(standings) {
        var podium = document.createElement('div');
        podium.className = 'social-podium';
        var top = (standings || []).slice(0, 3);
        top.forEach(function(s, idx) {
          var item = document.createElement('div');
          item.className = 'social-podium-item';
          item.innerHTML = '<div style="font-size:1.6rem;">' + ['🥇','🥈','🥉'][idx] + '</div><strong>' + (s.name || s.id || 'Équipe') + '</strong><div style="font-weight:600; opacity:0.8;">' + (s.points || 0) + ' pts</div>';
          podium.appendChild(item);
        });
        return podium;
      }

      function buildSocialLeagueImage(league) {
        return new Promise(function(resolve, reject) {
          if (!league) return reject(new Error('Aucune ligue fournie'));
          var root = prepareRoot();
          if (!root) return reject(new Error('Template introuvable'));
          var bg = document.createElement('div');
          // Nouveau : fond d'export de journée basé sur l'image fournie
          bg.className = 'social-bg social-day-bg';
          var card = document.createElement('div');
          card.className = 'social-card';
          var header = document.createElement('div');
          header.className = 'social-header';
          var logoSrc = getStoredLogo();
          if (logoSrc) { var logo = document.createElement('img'); logo.className = 'social-logo'; logo.src = logoSrc; header.appendChild(logo); }
          var title = document.createElement('div');
          title.className = 'social-title';
          title.textContent = league.name || 'Ligue interne';
          header.appendChild(title);
          if (league.level) { var levelText = document.createElement('div'); levelText.style.opacity = '0.8'; levelText.textContent = league.level; header.appendChild(levelText); }
          card.appendChild(header);
          addLevelBand(card, league.level || 'Ligue');

          if (league.finishedAt) {
            var dateLine = document.createElement('div');
            dateLine.className = 'small-muted';
            dateLine.style.textAlign = 'center';
            dateLine.textContent = 'Clôturée le ' + league.finishedAt.slice(0, 10);
            card.appendChild(dateLine);
          }

          card.appendChild(buildPodium(league.standings || []));
          var ranking = buildRankingTable(league.standings || []);
          card.appendChild(ranking);

          var footer = document.createElement('div');
          footer.className = 'social-footer';
          footer.innerHTML = '🏆 Powered by Padel App';
          card.appendChild(footer);

          bg.appendChild(card);
          root.appendChild(bg);

          html2canvas(bg, { backgroundColor: null, useCORS: true, width: 1080, height: 1080, scale: 2 }).then(function(canvas) {
            cleanupRoot(root);
            resolve(canvas);
          }).catch(function(err) { cleanupRoot(root); reject(err); });
        });
      }

      function buildSocialDayImage(league, roundNumber, bgOverride) {
        // Export journée avec fond utilisateur : mise en page proportionnelle sportive
        return new Promise(function(resolve, reject) {
          if (!league) return reject(new Error('Aucune ligue fournie'));
          var bgSrc = bgOverride || window.leagueExportBackgroundDataUrl || null;
          if (!bgSrc) return reject(new Error('Aucun fond fourni'));

          var matches = (league.matches || []).filter(function(m) { return parseInt(m.round, 10) === parseInt(roundNumber, 10); });
          var img = new Image();
          img.onload = function() {
            var W = img.naturalWidth || 1080;
            var H = img.naturalHeight || 1920;
            var canvas = document.createElement('canvas');
            canvas.width = W;
            canvas.height = H;
            var ctx = canvas.getContext('2d');

            // Fond plein écran
            ctx.drawImage(img, 0, 0, W, H);

            // Palette et police
            var accent = '#e5e339';
            var softBlue = '#9fbff2';
            var whiteBlue = '#f9fafb';
            var darkBand = 'rgba(2, 6, 23, 0.85)';
            var rowOdd = 'rgba(15, 23, 42, 0.85)';
            var rowEven = 'rgba(30, 64, 175, 0.75)';
            var fontFamily = (getComputedStyle(document.documentElement).getPropertyValue('--app-font-family') || '').trim() || "Poppins, Montserrat, system-ui, sans-serif";

            // Constantes de layout proportionnelles
            var marginX = W * 0.12;
            var tableWidth = W - marginX * 2;
            var titleY = H * 0.17;
            var subtitleY = titleY + H * 0.04;
            var headerY = H * 0.30;
            var rowHeight = H * 0.065;
            var footerY = H * 0.88;
            var colA = marginX + tableWidth * 0.03;
            var colScore = W / 2;
            var colB = marginX + tableWidth * 0.97;

            function px(percent) { return percent * H; }
            function drawText(txt, size, color, x, y, align, weight) {
              ctx.save();
              ctx.font = (weight || '600') + ' ' + size + 'px ' + fontFamily;
              ctx.fillStyle = color;
              ctx.textAlign = align || 'center';
              ctx.textBaseline = 'middle';
              ctx.fillText(txt, x, y);
              ctx.restore();
            }
            function fitText(ctx2, text, maxWidth, baseSize, minSize) {
              var size = baseSize;
              while (size > minSize) {
                ctx2.font = '600 ' + size + 'px ' + fontFamily;
                if (ctx2.measureText(text).width <= maxWidth) break;
                size -= 1;
              }
              return size;
            }
            function drawRoundedRect(x, y, w, h, r, fill) {
              ctx.save();
              ctx.beginPath();
              if (ctx.roundRect) { ctx.roundRect(x, y, w, h, r); }
              else {
                ctx.moveTo(x + r, y);
                ctx.lineTo(x + w - r, y);
                ctx.quadraticCurveTo(x + w, y, x + w, y + r);
                ctx.lineTo(x + w, y + h - r);
                ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
                ctx.lineTo(x + r, y + h);
                ctx.quadraticCurveTo(x, y + h, x, y + h - r);
                ctx.lineTo(x, y + r);
                ctx.quadraticCurveTo(x, y, x + r, y);
              }
              ctx.closePath();
              ctx.fillStyle = fill;
              ctx.fill();
              ctx.restore();
            }

            // Titre et sous-titre
            drawText('Ligue Interne Journée ' + roundNumber, H * 0.038, accent, W / 2, titleY, 'center', '600');
            drawText('Résultats officiels', H * 0.022, '#ffffff', W / 2, subtitleY, 'center', '700');

            // En-tête tableau
            var headerTop = headerY - rowHeight * 0.5;
            var headerH = rowHeight * 0.85;
            drawRoundedRect(marginX, headerTop, tableWidth, headerH, rowHeight * 0.2, darkBand);

            ctx.textBaseline = 'middle';
            drawText('Équipe A', H * 0.026, whiteBlue, colA, headerY, 'left', '700');
            drawText('Score', H * 0.026, softBlue, colScore, headerY, 'center', '700');
            drawText('Équipe B', H * 0.026, whiteBlue, colB, headerY, 'right', '700');

            // Séparateur
            ctx.save();
            ctx.strokeStyle = 'rgba(180,210,250,0.8)';
            ctx.lineWidth = px(0.003);
            ctx.beginPath();
            ctx.moveTo(marginX, headerY + px(0.018));
            ctx.lineTo(marginX + tableWidth, headerY + px(0.018));
            ctx.stroke();
            ctx.restore();

            // Lignes de matchs
            var rows = matches.slice(0, 8);
            var firstRowY = headerY + rowHeight;
            if (!rows.length) {
              drawText('Aucun match pour cette journée.', px(0.03), whiteBlue, W / 2, firstRowY, 'center', '600');
            } else {
              rows.forEach(function(m, idx) {
                var rowY = firstRowY + rowHeight * idx;
                var blockY = rowY - rowHeight * 0.5;
                var blockHeight = rowHeight * 0.85;
                var bgRow = (idx % 2 === 0) ? rowOdd : rowEven;
                drawRoundedRect(marginX, blockY, tableWidth, blockHeight, rowHeight * 0.18, bgRow);

                var textY = blockY + blockHeight / 2;
                var maxTeamWidth = tableWidth * 0.40;
                var teamAName = teamNameFromLeague(league, m.home);
                var teamBName = teamNameFromLeague(league, m.away);
                var scoreLabel = formatSetsSocial(m) || '–';

                var teamFontSizeA = fitText(ctx, teamAName, maxTeamWidth, H * 0.028, H * 0.020);
                var teamFontSizeB = fitText(ctx, teamBName, maxTeamWidth, H * 0.028, H * 0.020);

                ctx.textAlign = 'left';
                ctx.font = '600 ' + teamFontSizeA + 'px ' + fontFamily;
                ctx.fillStyle = whiteBlue;
                ctx.textBaseline = 'middle';
                ctx.fillText(teamAName, colA, textY);

                ctx.textAlign = 'center';
                ctx.font = '700 ' + (H * 0.024) + 'px ' + fontFamily;
                ctx.fillStyle = accent;
                ctx.fillText(scoreLabel, colScore, textY);

                ctx.textAlign = 'right';
                ctx.font = '600 ' + teamFontSizeB + 'px ' + fontFamily;
                ctx.fillStyle = whiteBlue;
                ctx.fillText(teamBName, colB, textY);
              });
            }

            // Footer
            drawText('Merci à tous les joueurs – Padel Parc', H * 0.022, softBlue, W / 2, footerY, 'center', '600');

            resolve(canvas);
          };
          img.onerror = function() { reject(new Error('Fond journée introuvable')); };
          img.src = bgSrc;
        });
      }

      function exportSocialImage(canvas, filename) {
        if (!canvas) return;
        var link = document.createElement('a');
        link.href = canvas.toDataURL('image/png');
        link.download = filename || 'export.png';
        link.click();
      }

      function closeSocialModal() {
        if (!modalRefs.container) return;
        modalState.download = null;
        if (modalRefs.container.classList.contains('open')) modalRefs.container.classList.remove('open');
      }

      function openSocialModal(options) {
        if (!modalRefs.container || !modalRefs.body) return;
        modalRefs.title.textContent = (options && options.title) || 'Aperçu réseaux';
        modalRefs.body.innerHTML = '';
        if (options && options.content) modalRefs.body.appendChild(options.content);
        if (modalRefs.download) {
          modalRefs.download.textContent = (options && options.downloadLabel) || 'Télécharger PNG';
          modalRefs.download.style.display = options && options.onDownload ? 'inline-flex' : 'none';
        }
        modalState.download = options && options.onDownload ? options.onDownload : null;
        modalRefs.container.classList.add('open');
      }

      function showSocialPreview(canvas, title, filename) {
        var imgWrap = document.createElement('div');
        imgWrap.className = 'social-preview-img';
        var img = document.createElement('img');
        img.src = canvas.toDataURL('image/png');
        img.alt = title || 'Aperçu';
        imgWrap.appendChild(img);
        openSocialModal({
          title: title || 'Aperçu réseaux',
          content: imgWrap,
          downloadLabel: 'Télécharger PNG',
          onDownload: function() { exportSocialImage(canvas, filename || 'export.png'); }
        });
      }

      if (modalRefs.close) modalRefs.close.addEventListener('click', closeSocialModal);
      if (modalRefs.cancel) modalRefs.cancel.addEventListener('click', closeSocialModal);
      if (modalRefs.overlay) modalRefs.overlay.addEventListener('click', closeSocialModal);
      if (modalRefs.download) modalRefs.download.addEventListener('click', function() { if (modalState.download) modalState.download(); });

      window.buildSocialLeagueImage = buildSocialLeagueImage;
      window.buildSocialDayImage = buildSocialDayImage;
      window.exportSocialImage = exportSocialImage;
      window.socialModal = { open: openSocialModal, close: closeSocialModal, preview: showSocialPreview };
    })();
  </script>
  <!-- Fin génération image réseaux ligue -->

  <!-- Début système de thème club -->
  <script>
    (function() {
      var THEME_STORAGE_KEY = 'padel_theme_profile_v1';
      var DEFAULT_PROFILE = {
        id: 'default_club',
        name: 'Padel Parc',
        shortName: 'Padel Parc',
        primaryColor: '#004b9b',
        secondaryColor: '#4d81b9',
        accentColor: '#e5e339',
        backgroundColor: '#020617',
        cardBackground: '#0b1220',
        textColor: '#ffffff',
        titleColor: '#e5e339',
        logoDataUrl: null,
        fontFamily: 'system',
        sponsorName: '',
        sponsorLogoDataUrl: null,
        sponsors: [],
        activeSponsorId: null,
        buttonStyle: 'solid',
        cardShape: 'rounded',
        backgroundStyle: 'gradient',
        backgroundImageDataUrl: null,
        tvSponsorMd: true,
        tvSponsorClassic: true,
        tvSponsorAmericano: true,
        tvSponsorMdPos: null,
        tvSponsorClassicPos: null,
        tvSponsorAmericanoPos: null
      };

      var currentClubProfile = null;
      var formInputs = {};
      var fontLinkEl = null;

      var AVAILABLE_FONTS = [
        { key: 'system', google: null, family: 'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif' },
        { key: 'Inter', google: 'Inter:wght@400;600;700', family: "'Inter', system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\", sans-serif" },
        { key: 'Poppins', google: 'Poppins:wght@400;600;700', family: "'Poppins', system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\", sans-serif" },
        { key: 'Montserrat', google: 'Montserrat:wght@400;600;700', family: "'Montserrat', system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\", sans-serif" },
        { key: 'Roboto', google: 'Roboto:wght@400;500;700', family: "'Roboto', system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\", sans-serif" },
        { key: 'Nunito', google: 'Nunito:wght@400;600;800', family: "'Nunito', system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\", sans-serif" }
      ];

      function normalizeFontKey(key) {
        var val = (key || 'system').toString().toLowerCase();
        if (val === 'inter') return 'Inter';
        if (val === 'poppins') return 'Poppins';
        if (val === 'montserrat') return 'Montserrat';
        if (val === 'roboto') return 'Roboto';
        if (val === 'nunito') return 'Nunito';
        return 'system';
      }

      function cloneProfile(data) {
        var merged = Object.assign({}, DEFAULT_PROFILE, data || {});
        merged.sponsors = (data && data.sponsors ? data.sponsors : merged.sponsors || []).map(function(s, idx) {
          return {
            id: s && s.id ? s.id : 's' + idx,
            name: (s && s.name) || '',
            logoDataUrl: (s && s.logoDataUrl) || null,
            enabledTv: s && typeof s.enabledTv === 'boolean' ? s.enabledTv : true
          };
        });
        // Migration sponsor V1 → V2 : transformer l'ancien sponsor unique en entrée de liste
        if (!merged.sponsors.length && (merged.sponsorName || merged.sponsorLogoDataUrl)) {
          merged.sponsors.push({ id: 'legacy', name: merged.sponsorName || '', logoDataUrl: merged.sponsorLogoDataUrl || null, enabledTv: true });
        }
        if (!merged.activeSponsorId && merged.sponsors.length) merged.activeSponsorId = merged.sponsors[0].id;
        if (merged.activeSponsorId) {
          var active = merged.sponsors.find(function(s) { return s.id === merged.activeSponsorId && s.enabledTv !== false; }) || merged.sponsors.find(function(s) { return s.enabledTv !== false; }) || merged.sponsors[0];
          if (active) {
            merged.sponsorName = active.name || '';
            merged.sponsorLogoDataUrl = active.logoDataUrl || null;
          }
        }
        return merged;
      }

      var FONT_CLASS_MAP = {
        system: 'app-font-system',
        inter: 'app-font-inter',
        poppins: 'app-font-poppins',
        montserrat: 'app-font-montserrat'
      };

      var BUTTON_CLASS_MAP = {
        solid: 'app-buttons-solid',
        outline: 'app-buttons-outline',
        ghost: 'app-buttons-ghost'
      };

      var CARD_CLASS_MAP = {
        square: 'app-cards-square',
        rounded: 'app-cards-rounded',
        pill: 'app-cards-pill'
      };

      var BG_CLASS_MAP = {
        solid: 'app-bg-solid',
        gradient: 'app-bg-gradient',
        pattern: 'app-bg-pattern',
        image: 'app-bg-image'
      };

      function hexToRgba(hex, alpha) {
        if (!hex) return '';
        var raw = hex.replace('#', '');
        if (raw.length === 3) raw = raw.split('').map(function(c) { return c + c; }).join('');
        var intVal = parseInt(raw, 16);
        if (isNaN(intVal)) return '';
        var r = (intVal >> 16) & 255;
        var g = (intVal >> 8) & 255;
        var b = intVal & 255;
        return 'rgba(' + r + ',' + g + ',' + b + ',' + (alpha != null ? alpha : 1) + ')';
      }

      function applyClassGroup(target, map, activeKey) {
        if (!target) return;
        Object.keys(map).forEach(function(key) { target.classList.remove(map[key]); });
        var cls = map[activeKey];
        if (cls) target.classList.add(cls);
      }

      function applyLogoVisual(src) {
        var logoSrc = src || '';
        var baseTargets = ['app-logo', 'home-logo-preview', 'logo-preview', 'settings-logo-preview'];
        baseTargets.forEach(function(id) {
          var el = document.getElementById(id);
          if (!el) return;
          if (logoSrc) {
            el.src = logoSrc;
            el.style.display = 'block';
          } else {
            el.removeAttribute('src');
            el.style.display = 'none';
          }
        });

        var tvTargets = document.querySelectorAll('#tv-logo');
        tvTargets.forEach(function(img) {
          if (logoSrc) {
            img.src = logoSrc;
            img.style.display = 'block';
            img.style.width = '72px';
            img.style.height = '72px';
          } else {
            img.removeAttribute('src');
            img.style.display = 'none';
          }
        });

        var helperTargets = ['settings-logo-helper'];
        helperTargets.forEach(function(id) {
          var el = document.getElementById(id);
          if (!el) return;
          el.style.display = logoSrc ? 'none' : 'block';
        });
      }

      function saveProfile() {
        try {
          localStorage.setItem(THEME_STORAGE_KEY, JSON.stringify(currentClubProfile));
        } catch (e) {
          console.warn('Impossible de sauvegarder le thème', e);
        }
      }

      function loadProfile() {
        var stored = null;
        try {
          stored = localStorage.getItem(THEME_STORAGE_KEY);
        } catch (e) {
          stored = null;
        }
        if (stored) {
          try { return cloneProfile(JSON.parse(stored)); } catch (e) { /* fallback default */ }
        }
        return cloneProfile();
      }

      function applyBackgroundStyles(profile) {
        var body = document.body;
        applyClassGroup(body, BG_CLASS_MAP, (profile && profile.backgroundStyle) || 'gradient');
        if (profile && profile.backgroundStyle === 'image' && profile.backgroundImageDataUrl) {
          body.style.backgroundImage = 'url(' + profile.backgroundImageDataUrl + ')';
          body.style.backgroundSize = 'cover';
          body.style.backgroundPosition = 'center';
          body.style.backgroundRepeat = 'no-repeat';
        } else {
          body.style.backgroundImage = '';
          body.style.backgroundSize = '';
          body.style.backgroundPosition = '';
          body.style.backgroundRepeat = '';
        }
      }

      // Nouveau : chargement dynamique des Google Fonts sélectionnées
      function ensureFontLink() {
        if (!fontLinkEl) {
          fontLinkEl = document.getElementById('dynamic-font-link');
          if (!fontLinkEl) {
            fontLinkEl = document.createElement('link');
            fontLinkEl.id = 'dynamic-font-link';
            fontLinkEl.rel = 'stylesheet';
            document.head.appendChild(fontLinkEl);
          }
        }
        return fontLinkEl;
      }

      function ensureSponsorState(profile) {
        if (!profile) return;
        if (!profile.sponsors) profile.sponsors = [];
        if (!profile.sponsors.length && (profile.sponsorName || profile.sponsorLogoDataUrl)) {
          profile.sponsors.push({ id: 'legacy', name: profile.sponsorName || '', logoDataUrl: profile.sponsorLogoDataUrl || null, enabledTv: true });
        }
        profile.sponsors = profile.sponsors.map(function(s, idx) {
          return {
            id: s && s.id ? s.id : 's' + idx,
            name: (s && s.name) || '',
            logoDataUrl: (s && s.logoDataUrl) || null,
            enabledTv: s && typeof s.enabledTv === 'boolean' ? s.enabledTv : true
          };
        });
        if (!profile.activeSponsorId && profile.sponsors.length) {
          var firstEnabled = profile.sponsors.find(function(s) { return s.enabledTv !== false; });
          profile.activeSponsorId = (firstEnabled || profile.sponsors[0]).id;
        }
      }

      function getActiveSponsor(profile) {
        if (!profile) return null;
        ensureSponsorState(profile);
        var active = profile.sponsors.find(function(s) { return s.id === profile.activeSponsorId && s.enabledTv !== false; });
        if (!active) {
          active = profile.sponsors.find(function(s) { return s.enabledTv !== false; }) || profile.sponsors[0];
          if (active) profile.activeSponsorId = active.id;
        }
        return active || null;
      }

      function applyAppFont(fontKey) {
        var key = normalizeFontKey(fontKey);
        var cfg = AVAILABLE_FONTS.find(function(f) { return f.key.toLowerCase() === key.toLowerCase(); }) || AVAILABLE_FONTS[0];
        var family = cfg.family || AVAILABLE_FONTS[0].family;
        document.documentElement.style.setProperty('--app-font-family', family);
        var link = ensureFontLink();
        if (cfg && cfg.google) {
          var baseUrl = 'https://fonts.googleapis.com/css2?family=';
          link.href = baseUrl + encodeURIComponent(cfg.google) + '&display=swap';
        } else {
          link.href = '';
        }
      }

      // Nouveau : bloc sponsor déplaçable en vue TV
      function applySponsorPosition(el, pos) {
        if (!el || !pos) return;
        el.style.right = 'auto';
        el.style.bottom = 'auto';
        el.style.left = (typeof pos.x === 'number' ? pos.x : 0) + '%';
        el.style.top = (typeof pos.y === 'number' ? pos.y : 0) + '%';
      }

      function makeSponsorDraggable(bannerId, posKey, containerId) {
        var banner = document.getElementById(bannerId);
        if (!banner) return;
        var activeProfile = currentClubProfile || DEFAULT_PROFILE;
        if (activeProfile && activeProfile[posKey]) applySponsorPosition(banner, activeProfile[posKey]);

        function onDragStart(e) {
          e.preventDefault();
          var rect = { left: 0, top: 0, width: window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth || 0, height: window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight || 0 };
          var start = { x: e.clientX, y: e.clientY };
          var box = banner.getBoundingClientRect();
          var offsetX = box.left - rect.left;
          var offsetY = box.top - rect.top;
          var currentPos = null;

          function clampPercent(val, size, total) {
            var maxPct = 100 - ((size / total) * 100);
            var pct = (val / total) * 100;
            if (maxPct < 0) maxPct = 0;
            if (pct < 0) pct = 0;
            if (pct > maxPct) pct = maxPct;
            return pct;
          }

          function onMove(ev) {
            ev.preventDefault();
            var deltaX = ev.clientX - start.x;
            var deltaY = ev.clientY - start.y;
            var newLeft = offsetX + deltaX;
            var newTop = offsetY + deltaY;
            var width = rect.width || window.innerWidth;
            var height = rect.height || window.innerHeight;
            var xPct = clampPercent(newLeft, banner.offsetWidth, width);
            var yPct = clampPercent(newTop, banner.offsetHeight, height);
            banner.style.left = xPct + '%';
            banner.style.top = yPct + '%';
            banner.style.right = 'auto';
            banner.style.bottom = 'auto';
            currentPos = { x: xPct, y: yPct };
          }

          function onEnd() {
            document.removeEventListener('mousemove', onMove);
            document.removeEventListener('mouseup', onEnd);
            if (currentPos && currentClubProfile) {
              currentClubProfile[posKey] = currentPos;
              saveProfile();
            }
          }

          document.addEventListener('mousemove', onMove);
          document.addEventListener('mouseup', onEnd);
        }

        banner.addEventListener('mousedown', onDragStart);
      }

      function renderSponsorBanner(ids, profile, enabled) {
        if (!ids || !ids.banner) return;
        var banner = document.getElementById(ids.banner);
        if (!banner) return;
        var logo = ids.logo ? document.getElementById(ids.logo) : null;
        var nameEl = ids.name ? document.getElementById(ids.name) : null;
        var activeSponsor = getActiveSponsor(profile);
        var hasContent = !!(enabled && activeSponsor && (activeSponsor.logoDataUrl || activeSponsor.name));
        if (!hasContent) {
          banner.style.display = 'none';
          if (logo) { logo.removeAttribute('src'); logo.style.display = 'none'; }
          if (nameEl) nameEl.textContent = '';
          return;
        }
        banner.style.display = 'inline-flex';
        if (logo) {
          if (activeSponsor && activeSponsor.logoDataUrl) {
            logo.src = activeSponsor.logoDataUrl;
            logo.style.display = 'block';
          } else {
            logo.removeAttribute('src');
            logo.style.display = 'none';
          }
        }
        if (nameEl) nameEl.textContent = (activeSponsor && activeSponsor.name) || '';
        if (ids.posKey && (!profile || !profile[ids.posKey])) {
          banner.style.left = '';
          banner.style.top = '';
          banner.style.right = '';
          banner.style.bottom = '';
        }
        if (ids.posKey && profile && profile[ids.posKey]) applySponsorPosition(banner, profile[ids.posKey]);
      }

      function updateSponsorPreview(src) {
        var preview = document.getElementById('app-sponsor-preview');
        if (!preview) return;
        if (src) {
          preview.src = src;
          preview.style.display = 'block';
        } else {
          preview.removeAttribute('src');
          preview.style.display = 'none';
        }
      }

      // Nouveau : gestion multi-sponsors (ajout/suppression/toggle TV)
      var pendingSponsorLogo = null;
      var editingSponsorId = null;

      function setActiveSponsorById(id) {
        ensureSponsorState(currentClubProfile);
        var entry = (currentClubProfile.sponsors || []).find(function(s) { return s.id === id && s.enabledTv !== false; });
        if (!entry) return;
        currentClubProfile.activeSponsorId = entry.id;
        currentClubProfile.sponsorName = entry.name || '';
        currentClubProfile.sponsorLogoDataUrl = entry.logoDataUrl || null;
        updateSponsorPreview(entry.logoDataUrl || null);
        persistAndApply();
      }

      function toggleSponsorTv(id, enabled) {
        ensureSponsorState(currentClubProfile);
        var entry = (currentClubProfile.sponsors || []).find(function(s) { return s.id === id; });
        if (!entry) return;
        entry.enabledTv = !!enabled;
        // Si le sponsor actif est désactivé, basculer sur le premier sponsor autorisé
        var active = getActiveSponsor(currentClubProfile);
        if (active) {
          currentClubProfile.activeSponsorId = active.id;
          currentClubProfile.sponsorName = active.name || '';
          currentClubProfile.sponsorLogoDataUrl = active.logoDataUrl || null;
        } else {
          currentClubProfile.activeSponsorId = null;
          currentClubProfile.sponsorName = '';
          currentClubProfile.sponsorLogoDataUrl = null;
        }
        persistAndApply();
        renderSponsorsList();
      }

      function deleteSponsor(id) {
        ensureSponsorState(currentClubProfile);
        var before = (currentClubProfile.sponsors || []).length;
        currentClubProfile.sponsors = (currentClubProfile.sponsors || []).filter(function(s) { return s.id !== id; });
        if (currentClubProfile.activeSponsorId === id) {
          var next = getActiveSponsor(currentClubProfile);
          currentClubProfile.activeSponsorId = next ? next.id : null;
          currentClubProfile.sponsorName = next ? next.name : '';
          currentClubProfile.sponsorLogoDataUrl = next ? next.logoDataUrl : null;
        }
        if ((currentClubProfile.sponsors || []).length !== before) {
          persistAndApply();
          renderSponsorsList();
        }
      }

      function addSponsorFromForm() {
        if (!formInputs || !formInputs.sponsorName) return;
        var nameVal = (formInputs.sponsorName.value || '').trim();
        if (!nameVal) {
          alert('Merci de saisir un nom de sponsor');
          return;
        }
        ensureSponsorState(currentClubProfile);
        var targetId = editingSponsorId || null;
        var existing = targetId ? currentClubProfile.sponsors.find(function(s) { return s.id === targetId; }) : null;
        var logoVal = pendingSponsorLogo;
        if (!logoVal) {
          logoVal = existing ? existing.logoDataUrl : currentClubProfile.sponsorLogoDataUrl;
        }
        logoVal = logoVal || null;
        if (existing) {
          existing.name = nameVal;
          if (pendingSponsorLogo !== null) existing.logoDataUrl = logoVal;
          existing.enabledTv = existing.enabledTv !== false;
          currentClubProfile.activeSponsorId = existing.id;
          currentClubProfile.sponsorName = existing.name;
          currentClubProfile.sponsorLogoDataUrl = existing.logoDataUrl;
        } else {
          var newId = 's' + Date.now();
          var entry = { id: newId, name: nameVal, logoDataUrl: logoVal, enabledTv: true };
          currentClubProfile.sponsors.push(entry);
          currentClubProfile.activeSponsorId = entry.id;
          currentClubProfile.sponsorName = entry.name;
          currentClubProfile.sponsorLogoDataUrl = entry.logoDataUrl;
        }
        pendingSponsorLogo = null;
        editingSponsorId = null;
        if (formInputs.sponsorLogo) formInputs.sponsorLogo.value = '';
        if (formInputs.sponsorName) formInputs.sponsorName.value = '';
        updateSponsorPreview(currentClubProfile.sponsorLogoDataUrl);
        persistAndApply();
        renderSponsorsList();
      }

      function renderSponsorsList() {
        var list = document.getElementById('app-sponsor-list');
        var empty = document.getElementById('app-sponsor-empty');
        if (!list) return;
        while (list.firstChild) list.removeChild(list.firstChild);
        ensureSponsorState(currentClubProfile);
        var sponsors = currentClubProfile.sponsors || [];
        if (!sponsors.length) {
          if (empty) empty.style.display = 'block';
          return;
        }
        if (empty) empty.style.display = 'none';
        sponsors.forEach(function(s) {
          var row = document.createElement('div');
          row.className = 'settings-inline';
          row.style.justifyContent = 'space-between';
          row.style.alignItems = 'center';

          var left = document.createElement('div');
          left.style.display = 'flex';
          left.style.alignItems = 'center';
          left.style.gap = '10px';

          var img = document.createElement('img');
          img.style.width = '40px';
          img.style.height = '40px';
          img.style.objectFit = 'contain';
          img.style.background = 'rgba(255,255,255,0.04)';
          img.style.borderRadius = '10px';
          img.style.border = '1px solid rgba(255,255,255,0.08)';
          if (s.logoDataUrl) {
            img.src = s.logoDataUrl;
          } else {
            img.style.display = 'none';
          }
          left.appendChild(img);

          var name = document.createElement('div');
          name.textContent = s.name || 'Sponsor';
          name.style.fontWeight = '600';
          name.style.cursor = 'pointer';
          if (s.id === currentClubProfile.activeSponsorId) {
            var badge = document.createElement('span');
            badge.textContent = 'Actif';
            badge.style.marginLeft = '8px';
            badge.style.fontSize = '0.8rem';
            badge.style.color = 'var(--brand-accent, #e5e339)';
            name.appendChild(badge);
          }
          name.addEventListener('click', function() {
            editingSponsorId = s.id;
            setActiveSponsorById(s.id);
            if (formInputs.sponsorName) formInputs.sponsorName.value = s.name || '';
            pendingSponsorLogo = s.logoDataUrl || null;
            updateSponsorPreview(s.logoDataUrl || null);
          });
          left.appendChild(name);

          var right = document.createElement('div');
          right.style.display = 'flex';
          right.style.alignItems = 'center';
          right.style.gap = '10px';

          var checkboxLabel = document.createElement('label');
          checkboxLabel.className = 'small-muted';
          checkboxLabel.style.display = 'flex';
          checkboxLabel.style.alignItems = 'center';
          checkboxLabel.style.gap = '6px';
          var cb = document.createElement('input');
          cb.type = 'checkbox';
          cb.checked = s.enabledTv !== false;
          cb.addEventListener('change', function() { toggleSponsorTv(s.id, this.checked); });
          checkboxLabel.appendChild(cb);
          var lblText = document.createElement('span');
          lblText.textContent = 'Afficher en TV';
          checkboxLabel.appendChild(lblText);
          right.appendChild(checkboxLabel);

          var deleteBtn = document.createElement('button');
          deleteBtn.type = 'button';
          deleteBtn.className = 'btn btn-secondary btn-small';
          deleteBtn.textContent = 'Supprimer';
          deleteBtn.addEventListener('click', function() {
            var ok = confirm('Supprimer ce sponsor ?');
            if (ok) deleteSponsor(s.id);
          });
          right.appendChild(deleteBtn);

          row.appendChild(left);
          row.appendChild(right);
          list.appendChild(row);
        });
      }

      function toggleBgImageField() {
        var field = document.getElementById('app-bg-image-field');
        if (!field || !formInputs.bgStyle) return;
        var useImage = (formInputs.bgStyle.value || '').toLowerCase() === 'image';
        field.style.display = useImage ? 'block' : 'none';
      }

      function applyClubTheme(profile) {
        currentClubProfile = cloneProfile(profile);
        currentClubProfile.fontFamily = normalizeFontKey(currentClubProfile.fontFamily);
        var root = document.documentElement;
        var accentSoft = hexToRgba(currentClubProfile.accentColor, 0.25) || 'rgba(229,227,57,0.25)';
        var primaryGlow = hexToRgba(currentClubProfile.primaryColor, 0.55) || 'rgba(0,75,155,0.55)';

        root.style.setProperty('--brand-primary', currentClubProfile.primaryColor);
        root.style.setProperty('--brand-secondary', currentClubProfile.secondaryColor);
        root.style.setProperty('--brand-accent', currentClubProfile.accentColor);
        root.style.setProperty('--brand-bg', currentClubProfile.backgroundColor);
        root.style.setProperty('--brand-card-bg', currentClubProfile.cardBackground);
        root.style.setProperty('--brand-text', currentClubProfile.textColor);
        root.style.setProperty('--brand-accent-soft', accentSoft);
        root.style.setProperty('--brand-primary-glow', primaryGlow);
        root.style.setProperty('--brand-title', currentClubProfile.titleColor || currentClubProfile.accentColor);

        root.style.setProperty('--blue-strong', currentClubProfile.primaryColor);
        root.style.setProperty('--blue-mid', currentClubProfile.secondaryColor);
        root.style.setProperty('--blue-soft', currentClubProfile.secondaryColor);
        root.style.setProperty('--accent', currentClubProfile.accentColor);
        root.style.setProperty('--bg-dark', currentClubProfile.backgroundColor);
        root.style.setProperty('--card', currentClubProfile.cardBackground);
        root.style.setProperty('--text', currentClubProfile.textColor);

        var body = document.body;
        applyAppFont(currentClubProfile.fontFamily || 'system');
        applyClassGroup(body, BUTTON_CLASS_MAP, currentClubProfile.buttonStyle || 'solid');
        applyClassGroup(body, CARD_CLASS_MAP, currentClubProfile.cardShape || 'rounded');
        applyBackgroundStyles(currentClubProfile);

        var nameTargets = document.querySelectorAll('[data-club-name]');
        nameTargets.forEach(function(el) { el.textContent = currentClubProfile.name || DEFAULT_PROFILE.name; });
        var shortTargets = document.querySelectorAll('[data-club-shortname]');
        shortTargets.forEach(function(el) { el.textContent = currentClubProfile.shortName || currentClubProfile.name || DEFAULT_PROFILE.shortName; });
        document.title = 'Moteur Tournois & M/D – ' + (currentClubProfile.shortName || currentClubProfile.name || DEFAULT_PROFILE.shortName);

        if (currentClubProfile.logoDataUrl) applyLogoVisual(currentClubProfile.logoDataUrl);
        var activeSponsor = getActiveSponsor(currentClubProfile);
        if (activeSponsor) {
          currentClubProfile.sponsorName = activeSponsor.name || '';
          currentClubProfile.sponsorLogoDataUrl = activeSponsor.logoDataUrl || null;
        }
        renderSponsorBanner({ banner: 'tv-sponsor-banner', logo: 'tv-sponsor-logo', name: 'tv-sponsor-name', posKey: 'tvSponsorMdPos' }, currentClubProfile, currentClubProfile.tvSponsorMd !== false);
        renderSponsorBanner({ banner: 'classic-tv-sponsor-banner', logo: 'classic-tv-sponsor-logo', name: 'classic-tv-sponsor-name', posKey: 'tvSponsorClassicPos' }, currentClubProfile, currentClubProfile.tvSponsorClassic !== false);
        renderSponsorBanner({ banner: 'americano-tv-sponsor-banner', logo: 'americano-tv-sponsor-logo', name: 'americano-tv-sponsor-name', posKey: 'tvSponsorAmericanoPos' }, currentClubProfile, currentClubProfile.tvSponsorAmericano !== false);
        updateSponsorPreview(currentClubProfile.sponsorLogoDataUrl);
      }

      function initSponsorDragBlocks() {
        makeSponsorDraggable('tv-sponsor-banner', 'tvSponsorMdPos', 'tv-root');
        makeSponsorDraggable('classic-tv-sponsor-banner', 'tvSponsorClassicPos', 'tv-overlay');
        makeSponsorDraggable('americano-tv-sponsor-banner', 'tvSponsorAmericanoPos', 'americano-tv-root');
      }

      function syncThemeForm() {
        if (!formInputs.name) return;
        formInputs.name.value = currentClubProfile.name || '';
        formInputs.shortName.value = currentClubProfile.shortName || '';
        formInputs.primary.value = currentClubProfile.primaryColor || DEFAULT_PROFILE.primaryColor;
        formInputs.secondary.value = currentClubProfile.secondaryColor || DEFAULT_PROFILE.secondaryColor;
        formInputs.accent.value = currentClubProfile.accentColor || DEFAULT_PROFILE.accentColor;
        formInputs.bg.value = currentClubProfile.backgroundColor || DEFAULT_PROFILE.backgroundColor;
        formInputs.card.value = currentClubProfile.cardBackground || DEFAULT_PROFILE.cardBackground;
        formInputs.text.value = currentClubProfile.textColor || DEFAULT_PROFILE.textColor;
        formInputs.title.value = currentClubProfile.titleColor || DEFAULT_PROFILE.titleColor;
        if (formInputs.font) {
          var fontVal = normalizeFontKey(currentClubProfile.fontFamily);
          var exists = AVAILABLE_FONTS.some(function(f) { return f.key === fontVal; });
          formInputs.font.value = exists ? fontVal : 'system';
        }
        if (formInputs.sponsorName) formInputs.sponsorName.value = currentClubProfile.sponsorName || '';
        if (formInputs.buttonStyle) formInputs.buttonStyle.value = currentClubProfile.buttonStyle || 'solid';
        if (formInputs.cardShape) formInputs.cardShape.value = currentClubProfile.cardShape || 'rounded';
        if (formInputs.bgStyle) formInputs.bgStyle.value = currentClubProfile.backgroundStyle || 'gradient';
        ensureSponsorState(currentClubProfile);
        if (formInputs.sponsorMdToggle) formInputs.sponsorMdToggle.checked = currentClubProfile.tvSponsorMd !== false;
        if (formInputs.sponsorClassicToggle) formInputs.sponsorClassicToggle.checked = currentClubProfile.tvSponsorClassic !== false;
        toggleBgImageField();
        updateSponsorPreview(currentClubProfile.sponsorLogoDataUrl);
        pendingSponsorLogo = null;
        renderSponsorsList();
      }

      function persistAndApply() {
        saveProfile();
        applyClubTheme(currentClubProfile);
        syncThemeForm();
      }

      function bindThemeForm() {
        formInputs = {
          name: document.getElementById('club-theme-name'),
          shortName: document.getElementById('club-theme-shortname'),
          primary: document.getElementById('club-theme-primary'),
          secondary: document.getElementById('club-theme-secondary'),
          accent: document.getElementById('club-theme-accent'),
          bg: document.getElementById('club-theme-bg'),
          card: document.getElementById('club-theme-card'),
          text: document.getElementById('club-theme-text'),
          title: document.getElementById('club-theme-title'),
          font: document.getElementById('club-theme-font'),
          sponsorName: document.getElementById('app-sponsor-name'),
          sponsorLogo: document.getElementById('app-sponsor-logo'),
          sponsorMdToggle: document.getElementById('app-sponsor-md-toggle'),
          sponsorClassicToggle: document.getElementById('app-sponsor-classic-toggle'),
          buttonStyle: document.getElementById('app-button-style'),
          cardShape: document.getElementById('app-card-shape'),
          bgStyle: document.getElementById('app-bg-style'),
          bgImage: document.getElementById('app-bg-image')
        };

        syncThemeForm();

        if (formInputs.font) {
          formInputs.font.addEventListener('change', function() {
            currentClubProfile.fontFamily = normalizeFontKey(this.value || 'system');
            persistAndApply();
          });
        }

        if (formInputs.title) {
          formInputs.title.addEventListener('change', function() {
            currentClubProfile.titleColor = this.value || DEFAULT_PROFILE.titleColor;
            persistAndApply();
          });
        }

        if (formInputs.buttonStyle) {
          formInputs.buttonStyle.addEventListener('change', function() {
            currentClubProfile.buttonStyle = this.value || 'solid';
            persistAndApply();
          });
        }

        if (formInputs.cardShape) {
          formInputs.cardShape.addEventListener('change', function() {
            currentClubProfile.cardShape = this.value || 'rounded';
            persistAndApply();
          });
        }

        if (formInputs.bgStyle) {
          formInputs.bgStyle.addEventListener('change', function() {
            currentClubProfile.backgroundStyle = this.value || 'gradient';
            toggleBgImageField();
            persistAndApply();
          });
        }

        if (formInputs.bgImage) {
          formInputs.bgImage.addEventListener('change', function(e) {
            var file = e.target.files && e.target.files[0];
            if (!file) return;
            var reader = new FileReader();
            reader.onload = function(evt) {
              currentClubProfile.backgroundImageDataUrl = evt.target.result;
              persistAndApply();
            };
            reader.readAsDataURL(file);
          });
        }

        var addSponsorBtn = document.getElementById('btn-add-sponsor');
        if (addSponsorBtn) {
          addSponsorBtn.addEventListener('click', function() { addSponsorFromForm(); });
        }

        if (formInputs.sponsorLogo) {
          formInputs.sponsorLogo.addEventListener('change', function(e) {
            var file = e.target.files && e.target.files[0];
            if (!file) return;
            var reader = new FileReader();
            reader.onload = function(evt) {
              pendingSponsorLogo = evt.target.result;
              updateSponsorPreview(pendingSponsorLogo);
            };
            reader.readAsDataURL(file);
          });
        }

        if (formInputs.sponsorSelect) {
          formInputs.sponsorSelect.addEventListener('change', function() {
            var sel = this.value;
            ensureSponsorState(currentClubProfile);
            var entry = (currentClubProfile.sponsors || []).find(function(s) { return s.id === sel; });
            if (entry) {
              currentClubProfile.activeSponsorId = entry.id;
              currentClubProfile.sponsorName = entry.name || '';
              currentClubProfile.sponsorLogoDataUrl = entry.logoDataUrl || null;
              if (formInputs.sponsorName) formInputs.sponsorName.value = entry.name || '';
              updateSponsorPreview(entry.logoDataUrl || null);
              persistAndApply();
            }
          });
        }

        if (formInputs.sponsorMdToggle) {
          formInputs.sponsorMdToggle.addEventListener('change', function() {
            currentClubProfile.tvSponsorMd = !!this.checked;
            persistAndApply();
          });
        }

        if (formInputs.sponsorClassicToggle) {
          formInputs.sponsorClassicToggle.addEventListener('change', function() {
            currentClubProfile.tvSponsorClassic = !!this.checked;
            persistAndApply();
          });
        }

        var saveBtn = document.getElementById('btn-save-club-theme');
          if (saveBtn) {
            saveBtn.addEventListener('click', function() {
              currentClubProfile = cloneProfile({
                name: formInputs.name.value || DEFAULT_PROFILE.name,
                shortName: formInputs.shortName.value || formInputs.name.value || DEFAULT_PROFILE.shortName,
              primaryColor: formInputs.primary.value || DEFAULT_PROFILE.primaryColor,
              secondaryColor: formInputs.secondary.value || DEFAULT_PROFILE.secondaryColor,
              accentColor: formInputs.accent.value || DEFAULT_PROFILE.accentColor,
              backgroundColor: formInputs.bg.value || DEFAULT_PROFILE.backgroundColor,
              cardBackground: formInputs.card.value || DEFAULT_PROFILE.cardBackground,
              textColor: formInputs.text.value || DEFAULT_PROFILE.textColor,
              titleColor: formInputs.title.value || DEFAULT_PROFILE.titleColor,
              logoDataUrl: currentClubProfile.logoDataUrl,
              fontFamily: normalizeFontKey((formInputs.font && formInputs.font.value) || 'system'),
              sponsorName: (getActiveSponsor(currentClubProfile) && getActiveSponsor(currentClubProfile).name) || (formInputs.sponsorName && formInputs.sponsorName.value) || '',
              sponsorLogoDataUrl: (getActiveSponsor(currentClubProfile) && getActiveSponsor(currentClubProfile).logoDataUrl) || currentClubProfile.sponsorLogoDataUrl,
              buttonStyle: (formInputs.buttonStyle && formInputs.buttonStyle.value) || 'solid',
              cardShape: (formInputs.cardShape && formInputs.cardShape.value) || 'rounded',
                backgroundStyle: (formInputs.bgStyle && formInputs.bgStyle.value) || 'gradient',
                backgroundImageDataUrl: currentClubProfile.backgroundImageDataUrl,
                sponsors: currentClubProfile.sponsors || [],
                activeSponsorId: currentClubProfile.activeSponsorId,
                tvSponsorMd: formInputs.sponsorMdToggle ? !!formInputs.sponsorMdToggle.checked : true,
                tvSponsorClassic: formInputs.sponsorClassicToggle ? !!formInputs.sponsorClassicToggle.checked : true,
                tvSponsorAmericano: currentClubProfile.tvSponsorAmericano !== false,
                tvSponsorMdPos: currentClubProfile.tvSponsorMdPos,
                tvSponsorClassicPos: currentClubProfile.tvSponsorClassicPos,
                tvSponsorAmericanoPos: currentClubProfile.tvSponsorAmericanoPos
              });
            persistAndApply();
          });
        }

        var resetBtn = document.getElementById('btn-reset-club-theme');
        if (resetBtn) {
            resetBtn.addEventListener('click', function() {
              var preservedLogo = currentClubProfile && currentClubProfile.logoDataUrl;
              var preservedSponsor = currentClubProfile && currentClubProfile.sponsorLogoDataUrl;
              var preservedMdPos = currentClubProfile && currentClubProfile.tvSponsorMdPos;
              var preservedClassicPos = currentClubProfile && currentClubProfile.tvSponsorClassicPos;
              var preservedAmericanoPos = currentClubProfile && currentClubProfile.tvSponsorAmericanoPos;
            currentClubProfile = cloneProfile({ logoDataUrl: preservedLogo, sponsorLogoDataUrl: preservedSponsor, sponsors: currentClubProfile ? currentClubProfile.sponsors : [], activeSponsorId: currentClubProfile ? currentClubProfile.activeSponsorId : null, tvSponsorMdPos: preservedMdPos, tvSponsorClassicPos: preservedClassicPos, tvSponsorAmericanoPos: preservedAmericanoPos, tvSponsorAmericano: currentClubProfile ? currentClubProfile.tvSponsorAmericano !== false : true });
              persistAndApply();
            });
          }
      }

      function updateLogo(dataUrl) {
        if (!currentClubProfile) currentClubProfile = loadProfile();
        currentClubProfile.logoDataUrl = dataUrl || null;
        persistAndApply();
      }

      function initTheme() {
        currentClubProfile = loadProfile();
        applyClubTheme(currentClubProfile);
        bindThemeForm();
        initSponsorDragBlocks();
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initTheme);
      } else {
        initTheme();
      }

        window.clubTheme = {
          getProfile: function() { return currentClubProfile; },
          apply: applyClubTheme,
          updateLogo: updateLogo,
          reset: function() {
            var preservedLogo = currentClubProfile && currentClubProfile.logoDataUrl;
            var preservedSponsor = currentClubProfile && currentClubProfile.sponsorLogoDataUrl;
            currentClubProfile = cloneProfile({ logoDataUrl: preservedLogo, sponsorLogoDataUrl: preservedSponsor });
            persistAndApply();
          },
          syncForm: syncThemeForm
        };

      window.applyThemeLogo = applyLogoVisual;
    })();
  </script>
  <!-- Fin système de thème club -->

  <!-- Début fond export journée (Ligue interne) -->
  <script>
    (function() {
      var BG_KEY = 'league_export_background';
      window.leagueExportBackgroundDataUrl = null;

      function applyPreview(src) {
        var preview = document.getElementById('league-export-bg-preview');
        if (!preview) return;
        if (src) {
          preview.src = src;
          preview.style.display = 'block';
        } else {
          preview.removeAttribute('src');
          preview.style.display = 'none';
        }
      }

      function loadBg() {
        try {
          var saved = localStorage.getItem(BG_KEY);
          if (saved) {
            window.leagueExportBackgroundDataUrl = saved;
            applyPreview(saved);
          }
        } catch (err) {
          console.warn('Impossible de relire le fond de journée', err);
        }
      }

      function bindUpload() {
        var input = document.getElementById('league-export-bg-upload');
        if (!input) return;
        input.addEventListener('change', function() {
          var file = this.files && this.files[0];
          if (!file) return;
          var reader = new FileReader();
          reader.onload = function(e) {
            window.leagueExportBackgroundDataUrl = e.target.result;
            applyPreview(window.leagueExportBackgroundDataUrl);
            try {
              localStorage.setItem(BG_KEY, window.leagueExportBackgroundDataUrl);
            } catch (err) {
              console.warn('Impossible de sauvegarder le fond de journée dans localStorage', err);
            }
          };
          reader.readAsDataURL(file);
        });
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() { loadBg(); bindUpload(); });
      } else {
        loadBg();
        bindUpload();
      }
    })();
  </script>
  <!-- Fin fond export journée (Ligue interne) -->

  <!-- Début logique persistance logo -->
  <script>
    (function() {
      var LOGO_STORAGE_KEY = 'padel_app_logo_v1';

      function applyLogoToElements(src) {
        var logoSrc = src || '';
        var baseTargets = ['app-logo', 'home-logo-preview', 'logo-preview', 'settings-logo-preview'];
        baseTargets.forEach(function(id) {
          var el = document.getElementById(id);
          if (!el) return;
          if (logoSrc) {
            el.src = logoSrc;
            el.style.display = 'block';
          } else {
            el.removeAttribute('src');
            el.style.display = 'none';
          }
        });

        var tvTargets = document.querySelectorAll('#tv-logo');
        tvTargets.forEach(function(img) {
          if (logoSrc) {
            img.src = logoSrc;
            img.style.display = 'block';
            img.style.width = '72px';
            img.style.height = '72px';
          } else {
            img.removeAttribute('src');
            img.style.display = 'none';
          }
        });

        var helperTargets = ['settings-logo-helper'];
        helperTargets.forEach(function(id) {
          var el = document.getElementById(id);
          if (!el) return;
          el.style.display = logoSrc ? 'none' : 'block';
        });
      }

      window.applyLogoToElements = applyLogoToElements;

      function savePersistedLogo(dataUrl) {
        try {
          localStorage.setItem(LOGO_STORAGE_KEY, dataUrl || '');
        } catch (e) {
          console.warn('Impossible de sauvegarder le logo localement', e);
        }
      }

      function loadPersistedLogo() {
        var stored = null;
        try {
          stored = localStorage.getItem(LOGO_STORAGE_KEY);
        } catch (e) {
          console.warn('Impossible de charger le logo persistant', e);
        }
        if (stored) applyLogoToElements(stored);
        if (stored && window.clubTheme && typeof window.clubTheme.updateLogo === 'function') {
          window.clubTheme.updateLogo(stored);
        }
      }

      function bindLogoPersistence(input) {
        if (!input) return;
        input.addEventListener('change', function(e) {
          var file = e.target.files && e.target.files[0];
          if (!file) return;
          var reader = new FileReader();
          reader.onload = function(ev) {
            var dataUrl = ev.target && ev.target.result ? ev.target.result : '';
            applyLogoToElements(dataUrl);
            savePersistedLogo(dataUrl);
            if (window.clubTheme && typeof window.clubTheme.updateLogo === 'function') {
              window.clubTheme.updateLogo(dataUrl);
            }
          };
          reader.readAsDataURL(file);
        });
      }

      bindLogoPersistence(document.getElementById('settings-logo-upload'));

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadPersistedLogo);
      } else {
        loadPersistedLogo();
      }
    })();
  </script>
  <!-- Fin logique persistance logo -->

  <!-- Début logique timer M/D -->
  <script>
    (function() {
      var refs = {
        toggle: document.getElementById('btn-toggle-md-timer'),
        panel: document.getElementById('md-timer-panel'),
        select: document.getElementById('md-timer-select'),
        custom: document.getElementById('md-timer-custom'),
        display: document.getElementById('md-timer-display'),
        start: document.getElementById('md-timer-start'),
        pause: document.getElementById('md-timer-pause'),
        reset: document.getElementById('md-timer-reset'),
        pop: document.getElementById('md-timer-pop'),
        shell: document.getElementById('md-timer-shell'),
        drag: document.getElementById('md-timer-drag'),
        close: document.getElementById('md-timer-close'),
        remaining: document.getElementById('md-timer-remaining'),
        status: document.getElementById('md-timer-status')
      };

      if (!refs.toggle || !refs.panel) return;

      var state = {
        baseDuration: 15 * 60,
        remaining: 15 * 60,
        interval: null,
        paused: true
      };

      // Début bips timer M/D
      var audioCtx = null;
      function ensureAudioCtx() {
        if (!audioCtx) {
          var Ctor = window.AudioContext || window.webkitAudioContext;
          if (Ctor) audioCtx = new Ctor();
        }
        return audioCtx;
      }

      function playBeep(pitch, duration) {
        try {
          var ctx = ensureAudioCtx();
          if (!ctx) return;
          var osc = ctx.createOscillator();
          var gain = ctx.createGain();
          osc.type = 'sine';
          osc.frequency.value = pitch || 600;
          gain.gain.value = 0.08;
          osc.connect(gain);
          gain.connect(ctx.destination);
          var now = ctx.currentTime;
          osc.start(now);
          gain.gain.setValueAtTime(gain.gain.value, now);
          gain.gain.exponentialRampToValueAtTime(0.001, now + (duration || 0.2));
          osc.stop(now + (duration || 0.2));
        } catch (e) {
          /* audio best-effort */
        }
      }

      function playFinalBeep() {
        playBeep(400, 0.5);
      }
      // Fin bips timer M/D

      function format(seconds) {
        var m = Math.floor(seconds / 60);
        var s = seconds % 60;
        return String(m).padStart(2, '0') + ':' + String(s).padStart(2, '0');
      }

      function updateDisplay() {
        refs.display.textContent = format(state.remaining);
        refs.remaining.textContent = format(state.remaining);
      }

      function stopTimer(message) {
        if (state.interval) {
          clearInterval(state.interval);
          state.interval = null;
        }
        state.paused = true;
        if (message) refs.status.textContent = message;
      }

      function startInterval() {
        stopTimer();
        state.paused = false;
        refs.status.textContent = 'Montante/Descendante en cours';
        state.interval = setInterval(function() {
          state.remaining -= 1;
          updateDisplay();
          if (state.remaining <= 0) {
            playFinalBeep();
            stopTimer('Temps écoulé !');
            refs.shell.classList.add('pulse');
          } else if (state.remaining <= 5 && state.remaining >= 1) {
            playBeep();
          }
        }, 1000);
      }

      function applyDurationFromInputs() {
        var custom = parseInt(refs.custom.value, 10);
        var minutes = !isNaN(custom) && custom > 0 ? custom : parseInt(refs.select.value, 10) || 15;
        state.baseDuration = minutes * 60;
        state.remaining = state.baseDuration;
        refs.shell.classList.remove('pulse');
        updateDisplay();
      }

      refs.toggle.addEventListener('click', function() {
        var visible = refs.panel.style.display !== 'none';
        refs.panel.style.display = visible ? 'none' : 'block';
      });

      refs.start.addEventListener('click', function() {
        applyDurationFromInputs();
        state.remaining = state.baseDuration;
        updateDisplay();
        refs.pop.style.display = 'block';
        refs.pop.style.left = '50%';
        refs.pop.style.top = '16px';
        refs.pop.style.transform = 'translateX(-50%)';
        startInterval();
      });

      refs.pause.addEventListener('click', function() {
        if (state.paused) {
          refs.shell.classList.remove('pulse');
          startInterval();
          refs.pause.textContent = 'Mettre en pause';
        } else {
          stopTimer('Timer en pause');
          refs.pause.textContent = 'Reprendre';
        }
      });

      refs.reset.addEventListener('click', function() {
        stopTimer('Timer réinitialisé');
        state.remaining = state.baseDuration;
        updateDisplay();
        refs.pause.textContent = 'Mettre en pause';
      });

      refs.close.addEventListener('click', function() {
        stopTimer('Timer arrêté');
        refs.pop.style.display = 'none';
        refs.pause.textContent = 'Mettre en pause';
        refs.shell.classList.remove('pulse');
      });

      // Drag & drop du pop-up
      var dragState = { active: false, offsetX: 0, offsetY: 0 };
      refs.drag.addEventListener('mousedown', function(e) {
        dragState.active = true;
        var rect = refs.pop.getBoundingClientRect();
        dragState.offsetX = e.clientX - rect.left;
        dragState.offsetY = e.clientY - rect.top;
        refs.pop.style.transform = 'none';
        document.addEventListener('mousemove', onDragMove);
        document.addEventListener('mouseup', onDragEnd);
      });

      function onDragMove(e) {
        if (!dragState.active) return;
        refs.pop.style.left = (e.clientX - dragState.offsetX) + 'px';
        refs.pop.style.top = (e.clientY - dragState.offsetY) + 'px';
      }

      function onDragEnd() {
        dragState.active = false;
        document.removeEventListener('mousemove', onDragMove);
        document.removeEventListener('mouseup', onDragEnd);
      }

      updateDisplay();
    })();
  </script>
  <!-- Fin logique timer M/D -->

  <script src="mode-americano.js"></script>
  <script src="core.js"></script>
  <script src="mode_classic.js"></script>
  <script src="mode_md.js"></script>
  <script src="mode_ligue.js"></script>
  <script src="sidebar.js"></script>
  <script src="tv-rotation.js"></script>
  <script src="tv-animations.js"></script>
  <script src="settings.js"></script>
</body>
</html>
